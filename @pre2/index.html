<!DOCTYPE html><html lang="ru"><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0">
    <meta name="description" content>
    <meta name="keywords" content>
    <title class="lt4">Hondrostrong ízületi fájdalamak, artritis és artrosis elleni krém</title>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/style.min.css">
    <link rel="icon" href="images/favicon.png" type="image/x-icon">
    <link rel="shortcut icon" href="images/favicon.png" type="image/x-icon">
    <link href="css/custom-styles2.min.css" type="text/css" rel="stylesheet">
    <script type="text/javascript" src="js/hu1.js"></script>
    <script type="text/javascript" src="js/countries.js"></script>
    <script type="text/javascript" src="js/jquery.js"></script>
    <!-- <script type="text/javascript" src="./cdn/js/ld.js"></script> -->
    <script type="text/javascript" src="js/main.js"></script>
    <script type="text/javascript" src="js/translater.js"></script>
  </head>
  <body>
    <header class="wrapper" style="position: fixed;">
      <div class="container">
        <div class="row top-bar">
          <div class="col-md-3 col-sm-2 col-xs-4 logo">
            <div></div>
          </div>
          <div class="menu col-md-6 col-xs-7 hidden-xs">
            <ul>
              <li class="iconed lt0">100% -ban természetes</li>
              <li class="iconed lt1">Eladva több, mint 5000 csomag </li>
              <li class="iconed lt2">Több, mint 4 000 visszajelzés</li>
            </ul>
          </div>
          <div class="col-sm-3 col-xs-7 call_back">
            <a class="button custom-popup lt3" data-target data-toggle="modal" href="#last_form" style="color: white;">megrendelni a visszahívást </a>
          </div>
        </div>
      </div>
    </header>
    <section class="wrapper block-1 covered">
      <div class="container">
        <div class="row">
          <div class="col-sm-7 col-xs-12 left">
            <div class="wrap">
              <div class="desc gold lt4">Hondrostrong ízületi fájdalamak, artritis és artrosis elleni krém </div>
              <div class="price old">
                <span class="price_land_s4 price_old" style="font-size:inherit;"></span>
              </div>
              <div class="price new">
                <span class="price_land_s1 price_main" style="font-size:inherit;"></span>
              </div>
              <form action="../~@replacingTheContentsThis_successful" class="order_form" method="post">
                <label>
                  <select class="country_select" id="country" name="country" style="display: none"></select>
                </label>
                <label>
                  <input name="name" placeholder="Név" type="text">
                </label>
                <label>
                  <input name="phone" placeholder="Phone" type="text">
                </label>
                <button class="button lt5" type="submit">megrendelni</button>
              </form>
              <div class="desc purp lt6">* Csomagok mennyisége <span style="white-space: nowrap;">kedvezménnyel - <span class="pack_count"></span>
                </span>
              </div>
            </div>
          </div>
          <div class="col-sm-5 col-xs-12 product">
            <img alt="Продукт" src="images/product.png">
          </div>
        </div>
      </div>
    </section>
    <section class="wrapper">
      <div class="container block-2">
        <div class="row">
          <div class="col-sm-2 col-xs-6">
            <div class="icon-box lt7">
              <span class="before"></span> Készült <br>egyedi <br>zöld kagylóból
            </div>
          </div>
          <div class="col-sm-2 col-xs-6">
            <div class="icon-box n2th lt8">
              <span class="before"></span> Gyártás <br>mindössze 1500 <br>csomag évente
            </div>
          </div>
          <div class="col-sm-2 col-xs-6">
            <div class="icon-box n3th lt9">
              <span class="before"></span> Megszabadít a <br>fájdalomtól és ödémától <br>az ízületekben
            </div>
          </div>
          <div class="col-sm-2 col-xs-6">
            <div class="icon-box n4th lt10">
              <span class="before"></span> Visszaállítja <br>az ízületeket <br>és szöveteket
            </div>
          </div>
          <div class="col-sm-2 hidden-xs">
            <div class="icon-box n5th lt11">
              <span class="before"></span> Segít <br>az artritis <br>és artrosis ellen
            </div>
          </div>
          <div class="col-sm-2 hidden-xs">
            <div class="icon-box n6th lt12">
              <span class="before"></span> Hatékony <br>az <br>osteochondrosisnál
            </div>
          </div>
        </div>
      </div>
    </section>
    <section class="wrapper block-3 covered">
      <div class="container">
        <div class="row">
          <div class="col-sm-8 col-sm-offset-2 col-xs-12">
            <h2 class="title lt13">Mi a zöld kagyló?</h2>
            <div class="desc">
              <p class="lt14">
                <span class="iconed gold">Zöld kagyló</span> - ezek a kagylók az Új Zéland partjain él. Kagyló maori lakosok hagyományos étele. Maori lakosságánál gyakorlatilag nem találhatóak az ízületi megbetegedések és gerinc problémák még az idős korban sem. Lefolytatott kutatások kimutatták, hogy ez a tény kagylókhoz kapcsolható, melyekből a bennszülöttek elég sokat fogyasztanak.
              </p>
            </div>
            <div class="desc">
              <p class="lt15">Kagylók tartalmazzák nagy mennyiségű mukopolisacharidből, mely az emberi szervezetben kötőszövet sejtek között lévő anyagjának összetevőjeként szerepel (ide értve a porcszövetet is), ennek köszönhetően jótékony hatással bírnak az ízületekre. Kivonat kinyerésének a folyamata – elég sok munkát igénylő folyamat, mivel az elkészítésénél nem használható a hőmérséklet növelése és a kémiai összetevők.</p>
            </div>
            <div class="desc">
              <p class="purp bold lt16">Hamar ki lett fejlesztve gyártási technológia a kagylók kivonatának elkészítésére, mely megtartja a kagylók gyógyhatását. Kivonat kinyerési folyamata – meglehetősen munkaigényes folyamat és nem kevés időt vesz igénybe, mivel elkészítésénél nem lehet alkalmazni a hőmérséklet növelését és a kémiai összetevőket. </p>
            </div>
            <div class="desc lt17">Hondrostrong krém formulája el van látva erőteljes összetevőkkel: </div>
            <div class="desc">
              <p class="lt18">
                <span class="iconed n2th gold">Apitoxin (méh méreg)</span> - Rendelkezik erős fájdalomcsillapító hatással, visszaállítja roncsolt porc szövetet az ízületekben, beindítja a szövetek regenerálódását.
              </p>
            </div>
            <div class="desc">
              <p class="lt19">
                <span class="iconed n3th gold">Magyal levél leve</span> - Sikeresen gyógyítja artritist és reuma fájdalmakat. Rendelkezik gyulladás elleni és antibakteriális hatással a Streptococcus baktériumok ellen, melyek rendszerint felelősek a reuma kialakulásáért.
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section class="wrapper block-4 covered">
      <div class="container">
        <div class="row">
          <div class="col-sm-4 col-xs-offset-2 col-xs-8 col-sm-offset-0 col-1">
            <img alt src="images/bl4-1.png">
          </div>
          <div class="col-xs-8 col-xs-offset-2 visible-xs">
            <p class="desc lt20">Hatékonyan visszaállítja roncsolt porc szövetet </p>
          </div>
          <div class="col-sm-4 col-xs-offset-2 col-xs-8 col-sm-offset-0 col-2">
            <div class="pic-2">
              <img alt src="images/bl4-2.png">
            </div>
          </div>
          <div class="col-xs-8 col-xs-offset-2 visible-xs">
            <p class="desc lt21">Megszünteti az ízületi fájdalmakat, ödémát és ízület zsibbadását</p>
          </div>
          <div class="col-sm-4 col-xs-offset-2 col-xs-8 col-sm-offset-0 col-3">
            <img alt src="images/bl4-3.png">
          </div>
          <div class="col-xs-8 col-xs-offset-2 visible-xs">
            <p class="desc lt22">Visszanyeri a végtagok rugalmasságát</p>
          </div>
          <div class="col-sm-4 hidden-xs col-1">
            <p class="desc lt23">Hatékonyan visszaállítja roncsolt porc szövetet</p>
          </div>
          <div class="col-sm-4 hidden-xs col-2">
            <p class="desc lt24">Megszünteti az ízületi fájdalmakat, ödémát és ízület zsibbadását </p>
          </div>
          <div class="col-sm-4 hidden-xs col-3">
            <p class="desc lt25">Visszanyeri a végtagok rugalmasságát</p>
          </div>
        </div>
      </div>
    </section>
    <section class="wrapper block-5 covered">
      <div class="container">
        <div class="row">
          <div class="col-sm-10 col-sm-offset-1 col-xs-12 col-xs-offset-0 content">
            <h2 class="title lt26">Mivel jobb a Hondrostrong krém más ízületi gyógykészítményektől ?</h2>
            <p class="desc lt27">Jelenleg a porc szövet megbetegedések, olyanok, mint: artritis, artrosis, poliartritis, kosartrosis, osteochondrosis, vezető helyen állnak világszerte a lakosság megbetegedései között. Sajnálatos módon, nem rég a kór adatai átléptek a korhatárt.</p>
            <p class="desc lt28">Magyarországon a helyzet katasztrofális, alakosság 50% rendelkezik valamilyen ízületi problémákkal. De a legfélelmetesebb az, hogy az emberek előnybe részesítik “nem hagyományos” gyógykezelési módszereket, ami gyakran az állapot súlyosbodásához vezet. Ezért ahhoz, hogy elkerüljük a helyzet romlását, javasoljuk jelenleg legújabb és a leghatékonyabb készítményt “Hondrostrong”, mely ki lett fejlesztve a porc szövetek visszaállítására.</p>
            <div class="row half">
              <div class="col-sm-6 col-xs-12">
                <img alt="Продукт" src="images/product.png">
              </div>
              <div class="col-sm-6 col-xs-12">
                <div class="bold lt29">A készítmény bevezetéséhez a lakosság ÖSSZES csoportjai közé - "Hondrostrong" kapható az interneten csak a hivatalos weboldalon. Ilyen módon meg lehet takarítani az ár 70%-át a TV reklámokon és 300-400%-át gyógyszertári feláron, ezért a “Hondrostrong” megengedheti magának abszolút MINDENKI, akinek szüksége van rá.</div>
              </div>
            </div>
            <p class="desc lt30">Számos klinikai kutatások eredményei alapján a “Hondrostrong” megszabadítja Önt bármilyen porc szövet megbetegedéstől 1,5-2 hónap alatt. Eredményekből ítélve a készítmény felülmúlta abszolút MINDEN drága hasonló készítményeket, melyek értéke 2-3 szeres árban van.</p>
          </div>
        </div>
      </div>
    </section>
    <section class="wrapper block-6 covered">
      <div class="container">
        <div class="row">
          <div class="col-sm-8 col-sm-offset-2 col-xs-12 col-xs-offset-0">
            <h2 class="title lt31">Hondrostrong - krém a ritka zöld kagylók kivonata alapján készült az ízületek visszaállításához</h2>
            <div class="desc">
              <p class="lt32">
                <span class="gold">Hondrostrong</span> készül maori nép csoport, Új Zéland őslakosok, ősi receptjei alapján. A receptet generációról generációra továbbítják és a legnagyobb titokban tartják. Polinéziai nép csoport a cégünkre bízta ezt a receptet egy feltétellel – a krém gyártása nem lépheti túl 1500 darab üveggel évente.
              </p>
            </div>
            <div class="desc">
              <p class="bold purp lt33">A krém összetétele értékes zöld kagylók kivonatát tartalmaz, mely gazdag az apitoxin tartalommal, kardamom kivonattal, amaránt olajjal és magyal fa levelek levével.</p>
            </div>
            <div class="desc">
              <p class="lt34">Az injekciókkal ellentétben a készítmény alkalmazásánál nem roncsolja a puha szöveteket és ízületi szerkezetet, ellenkezőleg, bekerül az ízületi üregbe ozmózis által , ugyanakkor táplálja és visszaállítja ízületi szerkezetet. Ilyen hatás érhető el a "Hondrostrong" titkos formulájának köszönhetően.</p>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section class="wrapper block-7 covered">
      <div class="container">
        <div class="row">
          <div class="col-sm-7 col-xs-12 left">
            <div class="wrap">
              <div class="desc gold lt35">Hondrostrong krém ízületi fájdalmak ellen, artrisis és artrosis ellen.</div>
              <div class="price old">
                <span class="price_land_s4 price_old" style="font-size:inherit;"></span>
              </div>
              <div class="price new">
                <span class="price_land_s1 price_main" style="font-size:inherit;"></span>
              </div>
              <form action="../~@replacingTheContentsThis_successful" class="order_form" method="post">
                <label>
                  <select class="country_select" id="country" name="country" style="display: none"></select>
                </label>
                <label>
                  <input name="name" placeholder="Név" type="text">
                </label>
                <label>
                  <input name="phone" placeholder="Phone" type="text">
                </label>
                <button class="button lt36" type="submit">megrendelni</button>
              </form>
              <div class="desc purp lt37">* Csomagog mennyisége <span style="white-space: nowrap;">kedvezménnyel - <span class="pack_count"></span>
                </span>
              </div>
            </div>
          </div>
          <div class="col-sm-5 col-xs-12 product">
            <img alt="Продукт" src="images/product.png">
          </div>
        </div>
      </div>
    </section>
    <section class="wrapper block-8 covered">
      <div class="container">
        <div class="row">
          <div class="col-sm-8 col-sm-offset-2 col-xs-12 col-xs-offset-0">
            <h2 class="title lt38"> Hondrostrong hatékonysága páciensek által alá van támasztva</h2>
          </div>
          <div class="col-xs-12 desc visible-xs">
            <p class="lt39">Csak javasolni tudom a pácienseimnek, akik küzdenek az ízületi megbetegedésekkel különböző okokból és a betegség különböző stádiumánál a “Hondrostrong” krémet. Természetesen nem mindenki meg tudja szerezni, mivel korlátozott a gyártási száma. Krém helyileg hat, bekerül közvetlenül ízületi üregbe és célzattan hat a betegség megszüntetésére. A "Hondrostrong" készítmény egyedi összetétele regenerálja roncsolt porc szövetet, megszünteti az ízületi fájdalmakat és gyulladást, visszaállítja az ízületek normál működésbe. Kiválóan megfelel az osteochondrosis , artritis, artrosis kezelésére, mozgásszervi rendellenességek kezelésére. </p>
            <div class="blue doc-name lt40">Nagy István</div>
            <i class="ital doc-qual lt41">Felső kategóriás sebész </i>
          </div>
          <div class="col-md-4 col-sm-5 col-xs-12">
            <img alt="Доктор" src="images/bl8-doc.png">
          </div>
          <div class="col-xs-6 desc hidden-xs">
            <p class="lt42">Csak javasolni tudom a pácienseimnek, akik küzdenek az ízületi megbetegedésekkel különböző okokból és a betegség különböző stádiumánál a “Hondrostrong” krémet. Természetesen nem mindenki meg tudja szerezni, mivel korlátozott a gyártási száma. Krém helyileg hat, bekerül közvetlenül ízületi üregbe és célzattan hat a betegség megszüntetésére. A "Hondrostrong" készítmény egyedi összetétele regenerálja roncsolt porc szövetet, megszünteti az ízületi fájdalmakat és gyulladást, visszaállítja az ízületek normál működésbe. Kiválóan megfelel az osteochondrosis , artritis, artrosis kezelésére, mozgásszervi rendellenességek kezelésére. </p>
            <div class="blue doc-name lt43">Nagy István</div>
            <i class="ital doc-qual lt44">Felső kategóriás sebész</i>
          </div>
        </div>
      </div>
    </section>
    <section class="wrapper block-9 covered">
      <div class="container">
        <div class="row">
          <div class="col-sm-10 col-sm-offset-1 col-xs-12 col-xs-offset-0 content">
            <h2 class="title lt45">Mit mutatták ki a Hondrostrong klinikai kutatásai?</h2>
            <p class="desc lt46">A Hondrostrong klinikai teszteket lefolytatták Magyarországon 2014 évben ősszel. A tesztekben részt vettek több, mint 5000 ember, akik szenvednek az ízületi megbetegedésektől. 40 napon keresztül résztvevők használták a Hondrostrong krémet 2 szer naponta. A kísérlet eredményei lenyűgöztek még az orvosokat is! </p>
            <img alt="Диограмма" class="hidden-xs" src="images/bl9-diogram.png">
            <img alt="Диограмма" class="visible-xs" src="images/bl9-diogram_xs.png">
            <p class="desc bold lt47">A kísérlet mindegyik résztvevője megjegyezte jelentős javulást a Hondrostrong használatának eredményeképpen. Emberek majdnem 90% megszabadult az artritistől. Jelenleg egyetlen egy hasonló készítmény a porc szövetek és az összekötő szövetek kezelésére sem tud versenybe szállni ilyen hatékonysággal.</p>
          </div>
        </div>
      </div>
    </section>
    <section class="wrapper block-10 covered">
      <div class="container">
        <div class="row">
          <div class="col-sm-6 col-sm-offset-3 col-xs-12 col-xs-offset-0">
            <h2 class="title lt48">Ki az, aki veszélyeztetett lehet az ízületi megbetegedések által?</h2>
            <div class="desc">
              <p class="icon-box lt49">
                <span class="before"></span> Már rendelkeznek ilyen vagy egyéb ízületi megbetegedésekkel
              </p>
              <p class="icon-box lt50">
                <span class="before"></span> Idősebb korúak, ízületek rugalmasságának elvesztése idősebb kor változásainál.
              </p>
              <p class="icon-box lt51">
                <span class="before"></span> Aki már átélt valamilyen ízületi műtétet
              </p>
              <p class="icon-box lt52">
                <span class="before"></span> Aki rendelkezik valamilyen ízületi vagy gerinc traumával
              </p>
              <p class="icon-box lt53">
                <span class="before"></span> Aki mozgásszegény életvételt folytat (sokáig ülnek a számítógép előtt)
              </p>
              <p class="icon-box lt54">
                <span class="before"></span> Hosszú időn keresztül ki voltak téve az ízületi megterheléseknek (ide értve a súlyfelesleg is)
              </p>
              <p class="icon-box lt55">
                <span class="before"></span> Sportolók
              </p>
              <p class="icon-box lt56">
                <span class="before"></span> Az ízületi megbetegedések előzéséhez javasolt mindenkinek alkalmaznia krémet (mivel idősebb kor eljövetelével az ízületek roncsolódnak mindenkinél)
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section class="wrapper block-11 covered">
      <div class="container">
        <div class="row">
          <h2 class="title col-sm-8 col-sm-offset-2 col-xs-12 col-xs-offset-0 lt57">Vásárlók visszajelzései a "Hondrostrong" krémről</h2>
        </div>
        <div class="row chapter">
          <div class="col-sm-2 col-sm-offset-0 col-xs-6 col-xs-offset-3 pic">
            <img alt src="images/bl11-1.png">
            <i class="desc lt58">Attila, 45 éves</i>
          </div>
          <div class="col-sm-10 col-xs-12 desc">
            <p class="desc lt59">Úgy 3 évvel ezelőtt februárban megfájdult a térdem. Először leröntgeneztek és azt mondták, hogy artritisem van. Alig tudtam járni. Mint egy mozgássérült. Orvosok térd műtétet javasolták. Én nem akartam műtő asztalra feküdni. Elkezdtem önállóan tanulmányozni a problémát. Még jó, hogy nem hallgattam az orvosokra. Megtudtam az új krémről “Hondrostrong”, megrendeltem a hivatalos weboldalról. Olyan 7 nap múlva meg is kaptam, kenegettem úgy, ahogy a használati útmutatóban le van írva. 11-ik napra elmentem városi maratonra készülni. Térdem többé nem fáj!! </p>
          </div>
        </div>
        <div class="row chapter">
          <div class="visible-xs col-xs-6 col-xs-offset-3 pic">
            <img alt src="images/bl11-2.png">
            <i class="desc lt60">Anna, 30 éves</i>
          </div>
          <div class="col-sm-10 col-xs-12 desc left">
            <p class="desc blue lt61">Kórházba kerültem chondrosisszal és váll ízületi fájdalommal (feldagadt). Sok kezelésen átmentem, infúzióval, vitaminokkal, mágnes kezelés, matrac kezelés (gerinc nyújtás), tő és masszázs kezelésen. Végül is kiírták dolgozni,de a kezem továbbra is fájt. Rendelésnél neurológus javasolt, ahogy ő fogalmazott utolsót, amit még ki lehet próbálni, új fejlesztést. Krém “Hondrostrong”, 3 szor naponta bekentem. Nekem segített, most már nyugodtan tudok dolgozni és tánccal foglalkozni.</p>
          </div>
          <div class="col-sm-2 col-sm-offset-0 hidden-xs pic">
            <img alt src="images/bl11-2.png">
            <i class="desc lt62">Anna, 30 éves</i>
          </div>
        </div>
        <div class="row chapter">
          <div class="col-sm-2 col-sm-offset-0 col-xs-6 col-xs-offset-3 pic">
            <img alt src="images/bl11-3.png">
            <i class="desc lt63">Viktor, 62 éves</i>
          </div>
          <div class="col-sm-10 col-xs-12 desc">
            <p class="desc lt64">Most már látom, hogy nem csak nekem egyedül segített krém “Hondrostrong”! Ennek örülök. Azt hittem már, hogy műtétre kell mennem, de egy értelmes orvoshoz kerültem, aki felírt nekem ezt a készítményt.3 kezelési kurzus alatt az ízületekben minden visszaállt, nincs többé fájdalom, sem ödéma. Kiváló krém, nincs is mit mondani.</p>
          </div>
        </div>
      </div>
    </section>
    <section class="wrapper block-12 covered">
      <div class="container">
        <div class="row">
          <h2 class="title col-xs-8 col-xs-offset-2 lt65">Alkalmazási javaslat</h2>
          <div class="col-sm-4 col-sm-offset-0 col-xs-offset-2 col-xs-8 col-1">
            <img alt src="images/bl12-1.png">
          </div>
          <div class="col-xs-offset-2 col-xs-8 visible-xs col-1">
            <p class="desc lt66">Nyomja ki a krémből a tenyerére kis mennyiségben</p>
          </div>
          <div class="col-sm-4 col-sm-offset-0 col-xs-offset-2 col-xs-8 col-2">
            <div class="pic-2">
              <img alt src="images/bl12-2.png">
            </div>
          </div>
          <div class="col-xs-offset-2 col-xs-8 visible-xs col-2">
            <p class="desc lt67">Vegye fel masszírozva a problémás területre </p>
          </div>
          <div class="col-sm-4 col-sm-offset-0 col-xs-offset-2 col-xs-8 col-3">
            <img alt src="images/bl12-3.png">
          </div>
          <div class="col-xs-offset-2 col-xs-8 visible-xs col-3">
            <p class="desc lt68">Használja 3 szer <span style="white-space: nowrap;">naponta</span>
            </p>
          </div>
          <div class="col-sm-4 hidden-xs col-1">
            <p class="desc lt69">Nyomja ki a krémből a tenyerére kis mennyiségben</p>
          </div>
          <div class="col-sm-4 hidden-xs col-2">
            <p class="desc lt70">Vegye fel masszírozva a problémás területre</p>
          </div>
          <div class="col-sm-4 hidden-xs col-3">
            <p class="desc lt71">Használja 3 szer <span style="white-space: nowrap;">naponta</span>
            </p>
          </div>
        </div>
      </div>
    </section>
    <section class="wrapper block-13 covered">
      <div class="container">
        <div class="row">
          <div class="col-sm-8 col-sm-offset-2 col-xs-12 col-xs-offset-0">
            <h2 class="title lt72">Figyelem! Óvakodjon a hamisítványoktól!</h2>
            <div class="desc">
              <p class="lt73">Zöld kagylók híresek a gyógyhatásukról. A “Hondrostrong” krémet készítik polinéziai nép ősi receptje alapján. Zöld kagylók csak az Új Zéland partjainál tartózkodik. </p>
              <p class="lt74">Óvakodjon a hamisítványoktól! Ha látta valahol egy krémet a zöld kagylók kivonatából alacsony áron, valószínűleg ez hamisítvány. A legjobb esetben lesz valamilyen hatása, a legrosszabb esetben – a betegség tovább fejlődik. Eredeti készítményt csak a mi webáruházunkból lehet vásárolni. Mi hivatalos forgalmazók vagyunk és garanciát biztosítunk a termék minőségét illetően. </p>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section class="wrapper block-14 covered">
      <div class="container">
        <div class="row">
          <div class="col-xs-12">
            <h2 class="title lt75">Szállítás és fizetés:</h2>
          </div>
        </div>
        <div class="row content">
          <div class="col-sm-2 col-xs-4">
            <div class="icon-box lt76">
              <span class="before"></span> Hagyja a rendelését az oldalon
            </div>
          </div>
          <div class="col-sm-3 col-xs-4">
            <div class="icon-box nth-2 lt77">
              <span class="before"></span> 15 percen belül Önnel kapcsolatba lép az ügyfél kapcsolattartó a rendelésének megerősítése miatt
            </div>
          </div>
          <div class="col-sm-2 col-xs-4">
            <div class="icon-box nth-3 lt78">
              <span class="before"></span> Mi csomagoljuk és elküldjük a rendelését
            </div>
          </div>
          <div class="col-sm-3 col-xs-4 col-xs-offset-2 col-sm-offset-0">
            <div class="icon-box nth-4 lt79">
              <span class="before"></span> 7-14 nap elteltével megérkezik a postán
            </div>
          </div>
          <div class="col-sm-2 col-xs-4">
            <div class="icon-box nth-5 lt80">
              <span class="before"></span> Megkapja és kifizeti a terméket a postán
            </div>
          </div>
        </div>
      </div>
    </section>
    <section class="wrapper block-15 covered">
      <div class="container">
        <div class="row">
          <h2 class="title col-sm-8 col-sm-offset-2 col-xs-10 col-xs-offset-1 lt81">A társaságunk szakértői</h2>
          <div class="col-sm-4 col-xs-6 col-xs-offset-3 col-sm-offset-0 col-1">
            <img alt src="images/bl15-1.png">
          </div>
          <div class="col-sm-4 col-xs-6 col-xs-offset-3 visible-xs col-1">
            <p class="bold lt82">Molnár Lajos</p>
            <i class="prof lt83">Minőségi igazgató</i>
            <p class="text lt84">felügyeli, hogy a rendelése eredeti legyen és megfelelően legyen becsomagolva</p>
          </div>
          <div class="col-sm-4 col-xs-6 col-xs-offset-3 col-sm-offset-0 col-2">
            <img alt src="images/bl15-2.png">
          </div>
          <div class="col-sm-4 col-xs-6 col-xs-offset-3 visible-xs col-2">
            <p class="bold lt85">Kiss Henrietta</p>
            <i class="prof lt86">Call center igazgatója</i>
            <p class="text lt87">kapcsolattartásért felelős az Ön által megjelölt telefonszámon</p>
          </div>
          <div class="col-sm-4 col-xs-6 col-xs-offset-3 col-sm-offset-0 col-3">
            <img alt src="images/bl15-3.png">
          </div>
          <div class="col-sm-4 col-xs-6 col-xs-offset-3 visible-xs col-3">
            <p class="bold lt88">Hetényi Péter</p>
            <i class="prof lt89">Logisztikai igazgató</i>
            <p class="text lt90">felel a szállításért, hogy a termék helyes címre és időben legyen elküldve </p>
          </div>
        </div>
        <div class="row desc hidden-xs">
          <div class="col-xs-4 col-1">
            <p class="bold lt91">Burcsák László</p>
            <i class="prof lt92">Molnár Lajos</i>
            <p class="text lt93">felügyeli, hogy a rendelése eredeti legyen és megfelelően legyen becsomagolva</p>
          </div>
          <div class="col-xs-4 col-2">
            <p class="bold lt94">Kiss Henrietta</p>
            <i class="prof lt95">Call center igazgatója</i>
            <p class="text lt96">kapcsolattartásért felelős az Ön által megjelölt telefonszámon</p>
          </div>
          <div class="col-xs-4 col-3">
            <p class="bold lt97">Hetényi Péter</p>
            <i class="prof lt98">Logisztikai igazgató</i>
            <p class="text lt99">felel a szállításért, hogy a termék helyes címre és időben legyen elküldve </p>
          </div>
        </div>
      </div>
    </section>
    <section class="wrapper block-16 covered">
      <div class="container" id="last_form">
        <div class="row">
          <div class="col-sm-7 col-xs-12 left">
            <div class="wrap">
              <div class="desc gold lt100">Hondrostrong krém az ízületi fájdalmak ellen, artritis és artrosis ellen </div>
              <div class="price old">
                <span class="price_land_s4 price_old" style="font-size:inherit;"></span>
              </div>
              <div class="price new">
                <span class="price_land_s1 price_main" style="font-size:inherit;"></span>
              </div>
              <form action="../~@replacingTheContentsThis_successful" class="order_form" method="post">
                <label>
                  <select class="country_select" id="country" name="country" style="display: none"></select>
                </label>
                <label>
                  <input name="name" placeholder="Név" type="text">
                </label>
                <label>
                  <input name="phone" placeholder="Phone" type="text">
                </label>
                <button class="button lt101" type="submit">megrendelni</button>
              </form>
              <div class="desc purp lt102">* Csomagok mennyiségeо <span style="white-space: nowrap;">kedvezménnyel - <span class="pack_count"></span>
                </span>
              </div>
            </div>
          </div>
          <div class="col-sm-5 col-xs-12 product">
            <img alt="Продукт" src="images/product.png">
          </div>
        </div>
      </div>
    </section>
    <footer>
      <div class="container">
        <div class="row">
          <br>
          <p class="lt103">BERNADATTE LTD, Av Ricardo J. Alfaro, Panama International <br>
            <a href="contact/policy.php" target="_blank">Privacy Policy</a>
          </p>
        </div>
      </div>
    </footer>
    <script type="text/javascript">
      $(function() {
        $("a[href^='#']").click(function() {
          var _href = $(this).attr("href");
          $("html, body").animate({
            scrollTop: $(_href).offset().top + "px"
          });
          return false;
        });
      });
    </script>
    <script>
      //обратный счетчик товара$(function(){var timerIdPackCountNumber = 49;$('.pack_count').html(timerIdPackCountNumber);var timerIdPackCount = setTimeout(function tick() {timerIdPackCountNumber--;$('.pack_count').html(timerIdPackCountNumber);if(timerIdPackCountNumber >5){timerIdPackCount = setTimeout(tick, 60000);}}, 0);})
    </script>

    <script src="data:text/javascript;base64,KGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHsKCXR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyA/IGZhY3RvcnkoZXhwb3J0cykgOgoJdHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kID8gZGVmaW5lKFsnZXhwb3J0cyddLCBmYWN0b3J5KSA6CgkoZ2xvYmFsID0gZ2xvYmFsIHx8IHNlbGYsIGZhY3RvcnkoZ2xvYmFsLklNYXNrID0ge30pKTsKfSh0aGlzLCAoZnVuY3Rpb24gKGV4cG9ydHMpIHsgJ3VzZSBzdHJpY3QnOwoKCXZhciBjb21tb25qc0dsb2JhbCA9IHR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJyA/IGdsb2JhbFRoaXMgOiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHt9OwoKCWZ1bmN0aW9uIGNyZWF0ZUNvbW1vbmpzTW9kdWxlKGZuLCBtb2R1bGUpIHsKCQlyZXR1cm4gbW9kdWxlID0geyBleHBvcnRzOiB7fSB9LCBmbihtb2R1bGUsIG1vZHVsZS5leHBvcnRzKSwgbW9kdWxlLmV4cG9ydHM7Cgl9CgoJdmFyIGNoZWNrID0gZnVuY3Rpb24gKGl0KSB7CgkgIHJldHVybiBpdCAmJiBpdC5NYXRoID09IE1hdGggJiYgaXQ7Cgl9OyAvLyBodHRwczovL2dpdGh1Yi5jb20vemxvaXJvY2svY29yZS1qcy9pc3N1ZXMvODYjaXNzdWVjb21tZW50LTExNTc1OTAyOAoKCgl2YXIgZ2xvYmFsXzEgPSAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW5kZWYKCWNoZWNrKHR5cGVvZiBnbG9iYWxUaGlzID09ICdvYmplY3QnICYmIGdsb2JhbFRoaXMpIHx8IGNoZWNrKHR5cGVvZiB3aW5kb3cgPT0gJ29iamVjdCcgJiYgd2luZG93KSB8fCBjaGVjayh0eXBlb2Ygc2VsZiA9PSAnb2JqZWN0JyAmJiBzZWxmKSB8fCBjaGVjayh0eXBlb2YgY29tbW9uanNHbG9iYWwgPT0gJ29iamVjdCcgJiYgY29tbW9uanNHbG9iYWwpIHx8IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1uZXctZnVuYwoJRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTsKCgl2YXIgZmFpbHMgPSBmdW5jdGlvbiAoZXhlYykgewoJICB0cnkgewoJICAgIHJldHVybiAhIWV4ZWMoKTsKCSAgfSBjYXRjaCAoZXJyb3IpIHsKCSAgICByZXR1cm4gdHJ1ZTsKCSAgfQoJfTsKCgkvLyBUaGFuaydzIElFOCBmb3IgaGlzIGZ1bm55IGRlZmluZVByb3BlcnR5CgoKCXZhciBkZXNjcmlwdG9ycyA9ICFmYWlscyhmdW5jdGlvbiAoKSB7CgkgIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sIDEsIHsKCSAgICBnZXQ6IGZ1bmN0aW9uICgpIHsKCSAgICAgIHJldHVybiA3OwoJICAgIH0KCSAgfSlbMV0gIT0gNzsKCX0pOwoKCXZhciBuYXRpdmVQcm9wZXJ0eUlzRW51bWVyYWJsZSA9IHt9LnByb3BlcnR5SXNFbnVtZXJhYmxlOwoJdmFyIGdldE93blByb3BlcnR5RGVzY3JpcHRvciA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7IC8vIE5hc2hvcm4gfiBKREs4IGJ1ZwoKCXZhciBOQVNIT1JOX0JVRyA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvciAmJiAhbmF0aXZlUHJvcGVydHlJc0VudW1lcmFibGUuY2FsbCh7CgkgIDE6IDIKCX0sIDEpOyAvLyBgT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZWAgbWV0aG9kIGltcGxlbWVudGF0aW9uCgkvLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL2VjbWEyNjIvI3NlYy1vYmplY3QucHJvdG90eXBlLnByb3BlcnR5aXNlbnVtZXJhYmxlCgoJdmFyIGYgPSBOQVNIT1JOX0JVRyA/IGZ1bmN0aW9uIHByb3BlcnR5SXNFbnVtZXJhYmxlKFYpIHsKCSAgdmFyIGRlc2NyaXB0b3IgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGhpcywgVik7CgkgIHJldHVybiAhIWRlc2NyaXB0b3IgJiYgZGVzY3JpcHRvci5lbnVtZXJhYmxlOwoJfSA6IG5hdGl2ZVByb3BlcnR5SXNFbnVtZXJhYmxlOwoKCXZhciBvYmplY3RQcm9wZXJ0eUlzRW51bWVyYWJsZSA9IHsKCQlmOiBmCgl9OwoKCXZhciBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IgPSBmdW5jdGlvbiAoYml0bWFwLCB2YWx1ZSkgewoJICByZXR1cm4gewoJICAgIGVudW1lcmFibGU6ICEoYml0bWFwICYgMSksCgkgICAgY29uZmlndXJhYmxlOiAhKGJpdG1hcCAmIDIpLAoJICAgIHdyaXRhYmxlOiAhKGJpdG1hcCAmIDQpLAoJICAgIHZhbHVlOiB2YWx1ZQoJICB9OwoJfTsKCgl2YXIgdG9TdHJpbmcgPSB7fS50b1N0cmluZzsKCgl2YXIgY2xhc3NvZlJhdyA9IGZ1bmN0aW9uIChpdCkgewoJICByZXR1cm4gdG9TdHJpbmcuY2FsbChpdCkuc2xpY2UoOCwgLTEpOwoJfTsKCgl2YXIgc3BsaXQgPSAnJy5zcGxpdDsgLy8gZmFsbGJhY2sgZm9yIG5vbi1hcnJheS1saWtlIEVTMyBhbmQgbm9uLWVudW1lcmFibGUgb2xkIFY4IHN0cmluZ3MKCgl2YXIgaW5kZXhlZE9iamVjdCA9IGZhaWxzKGZ1bmN0aW9uICgpIHsKCSAgLy8gdGhyb3dzIGFuIGVycm9yIGluIHJoaW5vLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL21vemlsbGEvcmhpbm8vaXNzdWVzLzM0NgoJICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcHJvdG90eXBlLWJ1aWx0aW5zCgkgIHJldHVybiAhT2JqZWN0KCd6JykucHJvcGVydHlJc0VudW1lcmFibGUoMCk7Cgl9KSA/IGZ1bmN0aW9uIChpdCkgewoJICByZXR1cm4gY2xhc3NvZlJhdyhpdCkgPT0gJ1N0cmluZycgPyBzcGxpdC5jYWxsKGl0LCAnJykgOiBPYmplY3QoaXQpOwoJfSA6IE9iamVjdDsKCgkvLyBgUmVxdWlyZU9iamVjdENvZXJjaWJsZWAgYWJzdHJhY3Qgb3BlcmF0aW9uCgkvLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL2VjbWEyNjIvI3NlYy1yZXF1aXJlb2JqZWN0Y29lcmNpYmxlCgl2YXIgcmVxdWlyZU9iamVjdENvZXJjaWJsZSA9IGZ1bmN0aW9uIChpdCkgewoJICBpZiAoaXQgPT0gdW5kZWZpbmVkKSB0aHJvdyBUeXBlRXJyb3IoIkNhbid0IGNhbGwgbWV0aG9kIG9uICIgKyBpdCk7CgkgIHJldHVybiBpdDsKCX07CgoJLy8gdG9PYmplY3Qgd2l0aCBmYWxsYmFjayBmb3Igbm9uLWFycmF5LWxpa2UgRVMzIHN0cmluZ3MKCgoKCgl2YXIgdG9JbmRleGVkT2JqZWN0ID0gZnVuY3Rpb24gKGl0KSB7CgkgIHJldHVybiBpbmRleGVkT2JqZWN0KHJlcXVpcmVPYmplY3RDb2VyY2libGUoaXQpKTsKCX07CgoJdmFyIGlzT2JqZWN0ID0gZnVuY3Rpb24gKGl0KSB7CgkgIHJldHVybiB0eXBlb2YgaXQgPT09ICdvYmplY3QnID8gaXQgIT09IG51bGwgOiB0eXBlb2YgaXQgPT09ICdmdW5jdGlvbic7Cgl9OwoKCS8vIGBUb1ByaW1pdGl2ZWAgYWJzdHJhY3Qgb3BlcmF0aW9uCgkvLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL2VjbWEyNjIvI3NlYy10b3ByaW1pdGl2ZQoJLy8gaW5zdGVhZCBvZiB0aGUgRVM2IHNwZWMgdmVyc2lvbiwgd2UgZGlkbid0IGltcGxlbWVudCBAQHRvUHJpbWl0aXZlIGNhc2UKCS8vIGFuZCB0aGUgc2Vjb25kIGFyZ3VtZW50IC0gZmxhZyAtIHByZWZlcnJlZCB0eXBlIGlzIGEgc3RyaW5nCgoKCXZhciB0b1ByaW1pdGl2ZSA9IGZ1bmN0aW9uIChpbnB1dCwgUFJFRkVSUkVEX1NUUklORykgewoJICBpZiAoIWlzT2JqZWN0KGlucHV0KSkgcmV0dXJuIGlucHV0OwoJICB2YXIgZm4sIHZhbDsKCSAgaWYgKFBSRUZFUlJFRF9TVFJJTkcgJiYgdHlwZW9mIChmbiA9IGlucHV0LnRvU3RyaW5nKSA9PSAnZnVuY3Rpb24nICYmICFpc09iamVjdCh2YWwgPSBmbi5jYWxsKGlucHV0KSkpIHJldHVybiB2YWw7CgkgIGlmICh0eXBlb2YgKGZuID0gaW5wdXQudmFsdWVPZikgPT0gJ2Z1bmN0aW9uJyAmJiAhaXNPYmplY3QodmFsID0gZm4uY2FsbChpbnB1dCkpKSByZXR1cm4gdmFsOwoJICBpZiAoIVBSRUZFUlJFRF9TVFJJTkcgJiYgdHlwZW9mIChmbiA9IGlucHV0LnRvU3RyaW5nKSA9PSAnZnVuY3Rpb24nICYmICFpc09iamVjdCh2YWwgPSBmbi5jYWxsKGlucHV0KSkpIHJldHVybiB2YWw7CgkgIHRocm93IFR5cGVFcnJvcigiQ2FuJ3QgY29udmVydCBvYmplY3QgdG8gcHJpbWl0aXZlIHZhbHVlIik7Cgl9OwoKCXZhciBoYXNPd25Qcm9wZXJ0eSA9IHt9Lmhhc093blByb3BlcnR5OwoKCXZhciBoYXMgPSBmdW5jdGlvbiAoaXQsIGtleSkgewoJICByZXR1cm4gaGFzT3duUHJvcGVydHkuY2FsbChpdCwga2V5KTsKCX07CgoJdmFyIGRvY3VtZW50JDEgPSBnbG9iYWxfMS5kb2N1bWVudDsgLy8gdHlwZW9mIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQgaXMgJ29iamVjdCcgaW4gb2xkIElFCgoJdmFyIEVYSVNUUyA9IGlzT2JqZWN0KGRvY3VtZW50JDEpICYmIGlzT2JqZWN0KGRvY3VtZW50JDEuY3JlYXRlRWxlbWVudCk7CgoJdmFyIGRvY3VtZW50Q3JlYXRlRWxlbWVudCA9IGZ1bmN0aW9uIChpdCkgewoJICByZXR1cm4gRVhJU1RTID8gZG9jdW1lbnQkMS5jcmVhdGVFbGVtZW50KGl0KSA6IHt9OwoJfTsKCgkvLyBUaGFuaydzIElFOCBmb3IgaGlzIGZ1bm55IGRlZmluZVByb3BlcnR5CgoKCXZhciBpZThEb21EZWZpbmUgPSAhZGVzY3JpcHRvcnMgJiYgIWZhaWxzKGZ1bmN0aW9uICgpIHsKCSAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShkb2N1bWVudENyZWF0ZUVsZW1lbnQoJ2RpdicpLCAnYScsIHsKCSAgICBnZXQ6IGZ1bmN0aW9uICgpIHsKCSAgICAgIHJldHVybiA3OwoJICAgIH0KCSAgfSkuYSAhPSA3OwoJfSk7CgoJdmFyIG5hdGl2ZUdldE93blByb3BlcnR5RGVzY3JpcHRvciA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7IC8vIGBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yYCBtZXRob2QKCS8vIGh0dHBzOi8vdGMzOS5naXRodWIuaW8vZWNtYTI2Mi8jc2VjLW9iamVjdC5nZXRvd25wcm9wZXJ0eWRlc2NyaXB0b3IKCgl2YXIgZiQxID0gZGVzY3JpcHRvcnMgPyBuYXRpdmVHZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgOiBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTywgUCkgewoJICBPID0gdG9JbmRleGVkT2JqZWN0KE8pOwoJICBQID0gdG9QcmltaXRpdmUoUCwgdHJ1ZSk7CgkgIGlmIChpZThEb21EZWZpbmUpIHRyeSB7CgkgICAgcmV0dXJuIG5hdGl2ZUdldE93blByb3BlcnR5RGVzY3JpcHRvcihPLCBQKTsKCSAgfSBjYXRjaCAoZXJyb3IpIHsKCSAgICAvKiBlbXB0eSAqLwoJICB9CgkgIGlmIChoYXMoTywgUCkpIHJldHVybiBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IoIW9iamVjdFByb3BlcnR5SXNFbnVtZXJhYmxlLmYuY2FsbChPLCBQKSwgT1tQXSk7Cgl9OwoKCXZhciBvYmplY3RHZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPSB7CgkJZjogZiQxCgl9OwoKCXZhciBhbk9iamVjdCA9IGZ1bmN0aW9uIChpdCkgewoJICBpZiAoIWlzT2JqZWN0KGl0KSkgewoJICAgIHRocm93IFR5cGVFcnJvcihTdHJpbmcoaXQpICsgJyBpcyBub3QgYW4gb2JqZWN0Jyk7CgkgIH0KCgkgIHJldHVybiBpdDsKCX07CgoJdmFyIG5hdGl2ZURlZmluZVByb3BlcnR5ID0gT2JqZWN0LmRlZmluZVByb3BlcnR5OyAvLyBgT2JqZWN0LmRlZmluZVByb3BlcnR5YCBtZXRob2QKCS8vIGh0dHBzOi8vdGMzOS5naXRodWIuaW8vZWNtYTI2Mi8jc2VjLW9iamVjdC5kZWZpbmVwcm9wZXJ0eQoKCXZhciBmJDIgPSBkZXNjcmlwdG9ycyA/IG5hdGl2ZURlZmluZVByb3BlcnR5IDogZnVuY3Rpb24gZGVmaW5lUHJvcGVydHkoTywgUCwgQXR0cmlidXRlcykgewoJICBhbk9iamVjdChPKTsKCSAgUCA9IHRvUHJpbWl0aXZlKFAsIHRydWUpOwoJICBhbk9iamVjdChBdHRyaWJ1dGVzKTsKCSAgaWYgKGllOERvbURlZmluZSkgdHJ5IHsKCSAgICByZXR1cm4gbmF0aXZlRGVmaW5lUHJvcGVydHkoTywgUCwgQXR0cmlidXRlcyk7CgkgIH0gY2F0Y2ggKGVycm9yKSB7CgkgICAgLyogZW1wdHkgKi8KCSAgfQoJICBpZiAoJ2dldCcgaW4gQXR0cmlidXRlcyB8fCAnc2V0JyBpbiBBdHRyaWJ1dGVzKSB0aHJvdyBUeXBlRXJyb3IoJ0FjY2Vzc29ycyBub3Qgc3VwcG9ydGVkJyk7CgkgIGlmICgndmFsdWUnIGluIEF0dHJpYnV0ZXMpIE9bUF0gPSBBdHRyaWJ1dGVzLnZhbHVlOwoJICByZXR1cm4gTzsKCX07CgoJdmFyIG9iamVjdERlZmluZVByb3BlcnR5ID0gewoJCWY6IGYkMgoJfTsKCgl2YXIgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5ID0gZGVzY3JpcHRvcnMgPyBmdW5jdGlvbiAob2JqZWN0LCBrZXksIHZhbHVlKSB7CgkgIHJldHVybiBvYmplY3REZWZpbmVQcm9wZXJ0eS5mKG9iamVjdCwga2V5LCBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IoMSwgdmFsdWUpKTsKCX0gOiBmdW5jdGlvbiAob2JqZWN0LCBrZXksIHZhbHVlKSB7CgkgIG9iamVjdFtrZXldID0gdmFsdWU7CgkgIHJldHVybiBvYmplY3Q7Cgl9OwoKCXZhciBzZXRHbG9iYWwgPSBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkgewoJICB0cnkgewoJICAgIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eShnbG9iYWxfMSwga2V5LCB2YWx1ZSk7CgkgIH0gY2F0Y2ggKGVycm9yKSB7CgkgICAgZ2xvYmFsXzFba2V5XSA9IHZhbHVlOwoJICB9CgoJICByZXR1cm4gdmFsdWU7Cgl9OwoKCXZhciBTSEFSRUQgPSAnX19jb3JlLWpzX3NoYXJlZF9fJzsKCXZhciBzdG9yZSA9IGdsb2JhbF8xW1NIQVJFRF0gfHwgc2V0R2xvYmFsKFNIQVJFRCwge30pOwoJdmFyIHNoYXJlZFN0b3JlID0gc3RvcmU7CgoJdmFyIGZ1bmN0aW9uVG9TdHJpbmcgPSBGdW5jdGlvbi50b1N0cmluZzsgLy8gdGhpcyBoZWxwZXIgYnJva2VuIGluIGAzLjQuMS0zLjQuNGAsIHNvIHdlIGNhbid0IHVzZSBgc2hhcmVkYCBoZWxwZXIKCglpZiAodHlwZW9mIHNoYXJlZFN0b3JlLmluc3BlY3RTb3VyY2UgIT0gJ2Z1bmN0aW9uJykgewoJICBzaGFyZWRTdG9yZS5pbnNwZWN0U291cmNlID0gZnVuY3Rpb24gKGl0KSB7CgkgICAgcmV0dXJuIGZ1bmN0aW9uVG9TdHJpbmcuY2FsbChpdCk7CgkgIH07Cgl9CgoJdmFyIGluc3BlY3RTb3VyY2UgPSBzaGFyZWRTdG9yZS5pbnNwZWN0U291cmNlOwoKCXZhciBXZWFrTWFwID0gZ2xvYmFsXzEuV2Vha01hcDsKCXZhciBuYXRpdmVXZWFrTWFwID0gdHlwZW9mIFdlYWtNYXAgPT09ICdmdW5jdGlvbicgJiYgL25hdGl2ZSBjb2RlLy50ZXN0KGluc3BlY3RTb3VyY2UoV2Vha01hcCkpOwoKCXZhciBzaGFyZWQgPSBjcmVhdGVDb21tb25qc01vZHVsZShmdW5jdGlvbiAobW9kdWxlKSB7CgkobW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkgewoJICByZXR1cm4gc2hhcmVkU3RvcmVba2V5XSB8fCAoc2hhcmVkU3RvcmVba2V5XSA9IHZhbHVlICE9PSB1bmRlZmluZWQgPyB2YWx1ZSA6IHt9KTsKCX0pKCd2ZXJzaW9ucycsIFtdKS5wdXNoKHsKCSAgdmVyc2lvbjogJzMuNi40JywKCSAgbW9kZTogICdnbG9iYWwnLAoJICBjb3B5cmlnaHQ6ICfCqSAyMDIwIERlbmlzIFB1c2hrYXJldiAoemxvaXJvY2sucnUpJwoJfSk7Cgl9KTsKCgl2YXIgaWQgPSAwOwoJdmFyIHBvc3RmaXggPSBNYXRoLnJhbmRvbSgpOwoKCXZhciB1aWQgPSBmdW5jdGlvbiAoa2V5KSB7CgkgIHJldHVybiAnU3ltYm9sKCcgKyBTdHJpbmcoa2V5ID09PSB1bmRlZmluZWQgPyAnJyA6IGtleSkgKyAnKV8nICsgKCsraWQgKyBwb3N0Zml4KS50b1N0cmluZygzNik7Cgl9OwoKCXZhciBrZXlzID0gc2hhcmVkKCdrZXlzJyk7CgoJdmFyIHNoYXJlZEtleSA9IGZ1bmN0aW9uIChrZXkpIHsKCSAgcmV0dXJuIGtleXNba2V5XSB8fCAoa2V5c1trZXldID0gdWlkKGtleSkpOwoJfTsKCgl2YXIgaGlkZGVuS2V5cyA9IHt9OwoKCXZhciBXZWFrTWFwJDEgPSBnbG9iYWxfMS5XZWFrTWFwOwoJdmFyIHNldCwgZ2V0LCBoYXMkMTsKCgl2YXIgZW5mb3JjZSA9IGZ1bmN0aW9uIChpdCkgewoJICByZXR1cm4gaGFzJDEoaXQpID8gZ2V0KGl0KSA6IHNldChpdCwge30pOwoJfTsKCgl2YXIgZ2V0dGVyRm9yID0gZnVuY3Rpb24gKFRZUEUpIHsKCSAgcmV0dXJuIGZ1bmN0aW9uIChpdCkgewoJICAgIHZhciBzdGF0ZTsKCgkgICAgaWYgKCFpc09iamVjdChpdCkgfHwgKHN0YXRlID0gZ2V0KGl0KSkudHlwZSAhPT0gVFlQRSkgewoJICAgICAgdGhyb3cgVHlwZUVycm9yKCdJbmNvbXBhdGlibGUgcmVjZWl2ZXIsICcgKyBUWVBFICsgJyByZXF1aXJlZCcpOwoJICAgIH0KCgkgICAgcmV0dXJuIHN0YXRlOwoJICB9OwoJfTsKCglpZiAobmF0aXZlV2Vha01hcCkgewoJICB2YXIgc3RvcmUkMSA9IG5ldyBXZWFrTWFwJDEoKTsKCSAgdmFyIHdtZ2V0ID0gc3RvcmUkMS5nZXQ7CgkgIHZhciB3bWhhcyA9IHN0b3JlJDEuaGFzOwoJICB2YXIgd21zZXQgPSBzdG9yZSQxLnNldDsKCgkgIHNldCA9IGZ1bmN0aW9uIChpdCwgbWV0YWRhdGEpIHsKCSAgICB3bXNldC5jYWxsKHN0b3JlJDEsIGl0LCBtZXRhZGF0YSk7CgkgICAgcmV0dXJuIG1ldGFkYXRhOwoJICB9OwoKCSAgZ2V0ID0gZnVuY3Rpb24gKGl0KSB7CgkgICAgcmV0dXJuIHdtZ2V0LmNhbGwoc3RvcmUkMSwgaXQpIHx8IHt9OwoJICB9OwoKCSAgaGFzJDEgPSBmdW5jdGlvbiAoaXQpIHsKCSAgICByZXR1cm4gd21oYXMuY2FsbChzdG9yZSQxLCBpdCk7CgkgIH07Cgl9IGVsc2UgewoJICB2YXIgU1RBVEUgPSBzaGFyZWRLZXkoJ3N0YXRlJyk7CgkgIGhpZGRlbktleXNbU1RBVEVdID0gdHJ1ZTsKCgkgIHNldCA9IGZ1bmN0aW9uIChpdCwgbWV0YWRhdGEpIHsKCSAgICBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkoaXQsIFNUQVRFLCBtZXRhZGF0YSk7CgkgICAgcmV0dXJuIG1ldGFkYXRhOwoJICB9OwoKCSAgZ2V0ID0gZnVuY3Rpb24gKGl0KSB7CgkgICAgcmV0dXJuIGhhcyhpdCwgU1RBVEUpID8gaXRbU1RBVEVdIDoge307CgkgIH07CgoJICBoYXMkMSA9IGZ1bmN0aW9uIChpdCkgewoJICAgIHJldHVybiBoYXMoaXQsIFNUQVRFKTsKCSAgfTsKCX0KCgl2YXIgaW50ZXJuYWxTdGF0ZSA9IHsKCSAgc2V0OiBzZXQsCgkgIGdldDogZ2V0LAoJICBoYXM6IGhhcyQxLAoJICBlbmZvcmNlOiBlbmZvcmNlLAoJICBnZXR0ZXJGb3I6IGdldHRlckZvcgoJfTsKCgl2YXIgcmVkZWZpbmUgPSBjcmVhdGVDb21tb25qc01vZHVsZShmdW5jdGlvbiAobW9kdWxlKSB7Cgl2YXIgZ2V0SW50ZXJuYWxTdGF0ZSA9IGludGVybmFsU3RhdGUuZ2V0OwoJdmFyIGVuZm9yY2VJbnRlcm5hbFN0YXRlID0gaW50ZXJuYWxTdGF0ZS5lbmZvcmNlOwoJdmFyIFRFTVBMQVRFID0gU3RyaW5nKFN0cmluZykuc3BsaXQoJ1N0cmluZycpOwoJKG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKE8sIGtleSwgdmFsdWUsIG9wdGlvbnMpIHsKCSAgdmFyIHVuc2FmZSA9IG9wdGlvbnMgPyAhIW9wdGlvbnMudW5zYWZlIDogZmFsc2U7CgkgIHZhciBzaW1wbGUgPSBvcHRpb25zID8gISFvcHRpb25zLmVudW1lcmFibGUgOiBmYWxzZTsKCSAgdmFyIG5vVGFyZ2V0R2V0ID0gb3B0aW9ucyA/ICEhb3B0aW9ucy5ub1RhcmdldEdldCA6IGZhbHNlOwoKCSAgaWYgKHR5cGVvZiB2YWx1ZSA9PSAnZnVuY3Rpb24nKSB7CgkgICAgaWYgKHR5cGVvZiBrZXkgPT0gJ3N0cmluZycgJiYgIWhhcyh2YWx1ZSwgJ25hbWUnKSkgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5KHZhbHVlLCAnbmFtZScsIGtleSk7CgkgICAgZW5mb3JjZUludGVybmFsU3RhdGUodmFsdWUpLnNvdXJjZSA9IFRFTVBMQVRFLmpvaW4odHlwZW9mIGtleSA9PSAnc3RyaW5nJyA/IGtleSA6ICcnKTsKCSAgfQoKCSAgaWYgKE8gPT09IGdsb2JhbF8xKSB7CgkgICAgaWYgKHNpbXBsZSkgT1trZXldID0gdmFsdWU7ZWxzZSBzZXRHbG9iYWwoa2V5LCB2YWx1ZSk7CgkgICAgcmV0dXJuOwoJICB9IGVsc2UgaWYgKCF1bnNhZmUpIHsKCSAgICBkZWxldGUgT1trZXldOwoJICB9IGVsc2UgaWYgKCFub1RhcmdldEdldCAmJiBPW2tleV0pIHsKCSAgICBzaW1wbGUgPSB0cnVlOwoJICB9CgoJICBpZiAoc2ltcGxlKSBPW2tleV0gPSB2YWx1ZTtlbHNlIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eShPLCBrZXksIHZhbHVlKTsgLy8gYWRkIGZha2UgRnVuY3Rpb24jdG9TdHJpbmcgZm9yIGNvcnJlY3Qgd29yayB3cmFwcGVkIG1ldGhvZHMgLyBjb25zdHJ1Y3RvcnMgd2l0aCBtZXRob2RzIGxpa2UgTG9EYXNoIGlzTmF0aXZlCgl9KShGdW5jdGlvbi5wcm90b3R5cGUsICd0b1N0cmluZycsIGZ1bmN0aW9uIHRvU3RyaW5nKCkgewoJICByZXR1cm4gdHlwZW9mIHRoaXMgPT0gJ2Z1bmN0aW9uJyAmJiBnZXRJbnRlcm5hbFN0YXRlKHRoaXMpLnNvdXJjZSB8fCBpbnNwZWN0U291cmNlKHRoaXMpOwoJfSk7Cgl9KTsKCgl2YXIgcGF0aCA9IGdsb2JhbF8xOwoKCXZhciBhRnVuY3Rpb24gPSBmdW5jdGlvbiAodmFyaWFibGUpIHsKCSAgcmV0dXJuIHR5cGVvZiB2YXJpYWJsZSA9PSAnZnVuY3Rpb24nID8gdmFyaWFibGUgOiB1bmRlZmluZWQ7Cgl9OwoKCXZhciBnZXRCdWlsdEluID0gZnVuY3Rpb24gKG5hbWVzcGFjZSwgbWV0aG9kKSB7CgkgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoIDwgMiA/IGFGdW5jdGlvbihwYXRoW25hbWVzcGFjZV0pIHx8IGFGdW5jdGlvbihnbG9iYWxfMVtuYW1lc3BhY2VdKSA6IHBhdGhbbmFtZXNwYWNlXSAmJiBwYXRoW25hbWVzcGFjZV1bbWV0aG9kXSB8fCBnbG9iYWxfMVtuYW1lc3BhY2VdICYmIGdsb2JhbF8xW25hbWVzcGFjZV1bbWV0aG9kXTsKCX07CgoJdmFyIGNlaWwgPSBNYXRoLmNlaWw7Cgl2YXIgZmxvb3IgPSBNYXRoLmZsb29yOyAvLyBgVG9JbnRlZ2VyYCBhYnN0cmFjdCBvcGVyYXRpb24KCS8vIGh0dHBzOi8vdGMzOS5naXRodWIuaW8vZWNtYTI2Mi8jc2VjLXRvaW50ZWdlcgoKCXZhciB0b0ludGVnZXIgPSBmdW5jdGlvbiAoYXJndW1lbnQpIHsKCSAgcmV0dXJuIGlzTmFOKGFyZ3VtZW50ID0gK2FyZ3VtZW50KSA/IDAgOiAoYXJndW1lbnQgPiAwID8gZmxvb3IgOiBjZWlsKShhcmd1bWVudCk7Cgl9OwoKCXZhciBtaW4gPSBNYXRoLm1pbjsgLy8gYFRvTGVuZ3RoYCBhYnN0cmFjdCBvcGVyYXRpb24KCS8vIGh0dHBzOi8vdGMzOS5naXRodWIuaW8vZWNtYTI2Mi8jc2VjLXRvbGVuZ3RoCgoJdmFyIHRvTGVuZ3RoID0gZnVuY3Rpb24gKGFyZ3VtZW50KSB7CgkgIHJldHVybiBhcmd1bWVudCA+IDAgPyBtaW4odG9JbnRlZ2VyKGFyZ3VtZW50KSwgMHgxRkZGRkZGRkZGRkZGRikgOiAwOyAvLyAyICoqIDUzIC0gMSA9PSA5MDA3MTk5MjU0NzQwOTkxCgl9OwoKCXZhciBtYXggPSBNYXRoLm1heDsKCXZhciBtaW4kMSA9IE1hdGgubWluOyAvLyBIZWxwZXIgZm9yIGEgcG9wdWxhciByZXBlYXRpbmcgY2FzZSBvZiB0aGUgc3BlYzoKCS8vIExldCBpbnRlZ2VyIGJlID8gVG9JbnRlZ2VyKGluZGV4KS4KCS8vIElmIGludGVnZXIgPCAwLCBsZXQgcmVzdWx0IGJlIG1heCgobGVuZ3RoICsgaW50ZWdlciksIDApOyBlbHNlIGxldCByZXN1bHQgYmUgbWluKGludGVnZXIsIGxlbmd0aCkuCgoJdmFyIHRvQWJzb2x1dGVJbmRleCA9IGZ1bmN0aW9uIChpbmRleCwgbGVuZ3RoKSB7CgkgIHZhciBpbnRlZ2VyID0gdG9JbnRlZ2VyKGluZGV4KTsKCSAgcmV0dXJuIGludGVnZXIgPCAwID8gbWF4KGludGVnZXIgKyBsZW5ndGgsIDApIDogbWluJDEoaW50ZWdlciwgbGVuZ3RoKTsKCX07CgoJLy8gYEFycmF5LnByb3RvdHlwZS57IGluZGV4T2YsIGluY2x1ZGVzIH1gIG1ldGhvZHMgaW1wbGVtZW50YXRpb24KCgoJdmFyIGNyZWF0ZU1ldGhvZCA9IGZ1bmN0aW9uIChJU19JTkNMVURFUykgewoJICByZXR1cm4gZnVuY3Rpb24gKCR0aGlzLCBlbCwgZnJvbUluZGV4KSB7CgkgICAgdmFyIE8gPSB0b0luZGV4ZWRPYmplY3QoJHRoaXMpOwoJICAgIHZhciBsZW5ndGggPSB0b0xlbmd0aChPLmxlbmd0aCk7CgkgICAgdmFyIGluZGV4ID0gdG9BYnNvbHV0ZUluZGV4KGZyb21JbmRleCwgbGVuZ3RoKTsKCSAgICB2YXIgdmFsdWU7IC8vIEFycmF5I2luY2x1ZGVzIHVzZXMgU2FtZVZhbHVlWmVybyBlcXVhbGl0eSBhbGdvcml0aG0KCSAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2VsZi1jb21wYXJlCgoJICAgIGlmIChJU19JTkNMVURFUyAmJiBlbCAhPSBlbCkgd2hpbGUgKGxlbmd0aCA+IGluZGV4KSB7CgkgICAgICB2YWx1ZSA9IE9baW5kZXgrK107IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1zZWxmLWNvbXBhcmUKCgkgICAgICBpZiAodmFsdWUgIT0gdmFsdWUpIHJldHVybiB0cnVlOyAvLyBBcnJheSNpbmRleE9mIGlnbm9yZXMgaG9sZXMsIEFycmF5I2luY2x1ZGVzIC0gbm90CgkgICAgfSBlbHNlIGZvciAoOyBsZW5ndGggPiBpbmRleDsgaW5kZXgrKykgewoJICAgICAgaWYgKChJU19JTkNMVURFUyB8fCBpbmRleCBpbiBPKSAmJiBPW2luZGV4XSA9PT0gZWwpIHJldHVybiBJU19JTkNMVURFUyB8fCBpbmRleCB8fCAwOwoJICAgIH0KCSAgICByZXR1cm4gIUlTX0lOQ0xVREVTICYmIC0xOwoJICB9OwoJfTsKCgl2YXIgYXJyYXlJbmNsdWRlcyA9IHsKCSAgLy8gYEFycmF5LnByb3RvdHlwZS5pbmNsdWRlc2AgbWV0aG9kCgkgIC8vIGh0dHBzOi8vdGMzOS5naXRodWIuaW8vZWNtYTI2Mi8jc2VjLWFycmF5LnByb3RvdHlwZS5pbmNsdWRlcwoJICBpbmNsdWRlczogY3JlYXRlTWV0aG9kKHRydWUpLAoJICAvLyBgQXJyYXkucHJvdG90eXBlLmluZGV4T2ZgIG1ldGhvZAoJICAvLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL2VjbWEyNjIvI3NlYy1hcnJheS5wcm90b3R5cGUuaW5kZXhvZgoJICBpbmRleE9mOiBjcmVhdGVNZXRob2QoZmFsc2UpCgl9OwoKCXZhciBpbmRleE9mID0gYXJyYXlJbmNsdWRlcy5pbmRleE9mOwoKCgoJdmFyIG9iamVjdEtleXNJbnRlcm5hbCA9IGZ1bmN0aW9uIChvYmplY3QsIG5hbWVzKSB7CgkgIHZhciBPID0gdG9JbmRleGVkT2JqZWN0KG9iamVjdCk7CgkgIHZhciBpID0gMDsKCSAgdmFyIHJlc3VsdCA9IFtdOwoJICB2YXIga2V5OwoKCSAgZm9yIChrZXkgaW4gTykgIWhhcyhoaWRkZW5LZXlzLCBrZXkpICYmIGhhcyhPLCBrZXkpICYmIHJlc3VsdC5wdXNoKGtleSk7IC8vIERvbid0IGVudW0gYnVnICYgaGlkZGVuIGtleXMKCgoJICB3aGlsZSAobmFtZXMubGVuZ3RoID4gaSkgaWYgKGhhcyhPLCBrZXkgPSBuYW1lc1tpKytdKSkgewoJICAgIH5pbmRleE9mKHJlc3VsdCwga2V5KSB8fCByZXN1bHQucHVzaChrZXkpOwoJICB9CgoJICByZXR1cm4gcmVzdWx0OwoJfTsKCgkvLyBJRTgtIGRvbid0IGVudW0gYnVnIGtleXMKCXZhciBlbnVtQnVnS2V5cyA9IFsnY29uc3RydWN0b3InLCAnaGFzT3duUHJvcGVydHknLCAnaXNQcm90b3R5cGVPZicsICdwcm9wZXJ0eUlzRW51bWVyYWJsZScsICd0b0xvY2FsZVN0cmluZycsICd0b1N0cmluZycsICd2YWx1ZU9mJ107CgoJdmFyIGhpZGRlbktleXMkMSA9IGVudW1CdWdLZXlzLmNvbmNhdCgnbGVuZ3RoJywgJ3Byb3RvdHlwZScpOyAvLyBgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXNgIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmdpdGh1Yi5pby9lY21hMjYyLyNzZWMtb2JqZWN0LmdldG93bnByb3BlcnR5bmFtZXMKCgl2YXIgZiQzID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMgfHwgZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlOYW1lcyhPKSB7CgkgIHJldHVybiBvYmplY3RLZXlzSW50ZXJuYWwoTywgaGlkZGVuS2V5cyQxKTsKCX07CgoJdmFyIG9iamVjdEdldE93blByb3BlcnR5TmFtZXMgPSB7CgkJZjogZiQzCgl9OwoKCXZhciBmJDQgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzOwoKCXZhciBvYmplY3RHZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPSB7CgkJZjogZiQ0Cgl9OwoKCS8vIGFsbCBvYmplY3Qga2V5cywgaW5jbHVkZXMgbm9uLWVudW1lcmFibGUgYW5kIHN5bWJvbHMKCgoJdmFyIG93bktleXMgPSBnZXRCdWlsdEluKCdSZWZsZWN0JywgJ293bktleXMnKSB8fCBmdW5jdGlvbiBvd25LZXlzKGl0KSB7CgkgIHZhciBrZXlzID0gb2JqZWN0R2V0T3duUHJvcGVydHlOYW1lcy5mKGFuT2JqZWN0KGl0KSk7CgkgIHZhciBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPSBvYmplY3RHZXRPd25Qcm9wZXJ0eVN5bWJvbHMuZjsKCSAgcmV0dXJuIGdldE93blByb3BlcnR5U3ltYm9scyA/IGtleXMuY29uY2F0KGdldE93blByb3BlcnR5U3ltYm9scyhpdCkpIDoga2V5czsKCX07CgoJdmFyIGNvcHlDb25zdHJ1Y3RvclByb3BlcnRpZXMgPSBmdW5jdGlvbiAodGFyZ2V0LCBzb3VyY2UpIHsKCSAgdmFyIGtleXMgPSBvd25LZXlzKHNvdXJjZSk7CgkgIHZhciBkZWZpbmVQcm9wZXJ0eSA9IG9iamVjdERlZmluZVByb3BlcnR5LmY7CgkgIHZhciBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPSBvYmplY3RHZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IuZjsKCgkgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgewoJICAgIHZhciBrZXkgPSBrZXlzW2ldOwoJICAgIGlmICghaGFzKHRhcmdldCwga2V5KSkgZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIGdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOwoJICB9Cgl9OwoKCXZhciByZXBsYWNlbWVudCA9IC8jfFwucHJvdG90eXBlXC4vOwoKCXZhciBpc0ZvcmNlZCA9IGZ1bmN0aW9uIChmZWF0dXJlLCBkZXRlY3Rpb24pIHsKCSAgdmFyIHZhbHVlID0gZGF0YVtub3JtYWxpemUoZmVhdHVyZSldOwoJICByZXR1cm4gdmFsdWUgPT0gUE9MWUZJTEwgPyB0cnVlIDogdmFsdWUgPT0gTkFUSVZFID8gZmFsc2UgOiB0eXBlb2YgZGV0ZWN0aW9uID09ICdmdW5jdGlvbicgPyBmYWlscyhkZXRlY3Rpb24pIDogISFkZXRlY3Rpb247Cgl9OwoKCXZhciBub3JtYWxpemUgPSBpc0ZvcmNlZC5ub3JtYWxpemUgPSBmdW5jdGlvbiAoc3RyaW5nKSB7CgkgIHJldHVybiBTdHJpbmcoc3RyaW5nKS5yZXBsYWNlKHJlcGxhY2VtZW50LCAnLicpLnRvTG93ZXJDYXNlKCk7Cgl9OwoKCXZhciBkYXRhID0gaXNGb3JjZWQuZGF0YSA9IHt9OwoJdmFyIE5BVElWRSA9IGlzRm9yY2VkLk5BVElWRSA9ICdOJzsKCXZhciBQT0xZRklMTCA9IGlzRm9yY2VkLlBPTFlGSUxMID0gJ1AnOwoJdmFyIGlzRm9yY2VkXzEgPSBpc0ZvcmNlZDsKCgl2YXIgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yJDEgPSBvYmplY3RHZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IuZjsKCgoKCgoKCgoKCgkvKgoJICBvcHRpb25zLnRhcmdldCAgICAgIC0gbmFtZSBvZiB0aGUgdGFyZ2V0IG9iamVjdAoJICBvcHRpb25zLmdsb2JhbCAgICAgIC0gdGFyZ2V0IGlzIHRoZSBnbG9iYWwgb2JqZWN0CgkgIG9wdGlvbnMuc3RhdCAgICAgICAgLSBleHBvcnQgYXMgc3RhdGljIG1ldGhvZHMgb2YgdGFyZ2V0CgkgIG9wdGlvbnMucHJvdG8gICAgICAgLSBleHBvcnQgYXMgcHJvdG90eXBlIG1ldGhvZHMgb2YgdGFyZ2V0CgkgIG9wdGlvbnMucmVhbCAgICAgICAgLSByZWFsIHByb3RvdHlwZSBtZXRob2QgZm9yIHRoZSBgcHVyZWAgdmVyc2lvbgoJICBvcHRpb25zLmZvcmNlZCAgICAgIC0gZXhwb3J0IGV2ZW4gaWYgdGhlIG5hdGl2ZSBmZWF0dXJlIGlzIGF2YWlsYWJsZQoJICBvcHRpb25zLmJpbmQgICAgICAgIC0gYmluZCBtZXRob2RzIHRvIHRoZSB0YXJnZXQsIHJlcXVpcmVkIGZvciB0aGUgYHB1cmVgIHZlcnNpb24KCSAgb3B0aW9ucy53cmFwICAgICAgICAtIHdyYXAgY29uc3RydWN0b3JzIHRvIHByZXZlbnRpbmcgZ2xvYmFsIHBvbGx1dGlvbiwgcmVxdWlyZWQgZm9yIHRoZSBgcHVyZWAgdmVyc2lvbgoJICBvcHRpb25zLnVuc2FmZSAgICAgIC0gdXNlIHRoZSBzaW1wbGUgYXNzaWdubWVudCBvZiBwcm9wZXJ0eSBpbnN0ZWFkIG9mIGRlbGV0ZSArIGRlZmluZVByb3BlcnR5CgkgIG9wdGlvbnMuc2hhbSAgICAgICAgLSBhZGQgYSBmbGFnIHRvIG5vdCBjb21wbGV0ZWx5IGZ1bGwgcG9seWZpbGxzCgkgIG9wdGlvbnMuZW51bWVyYWJsZSAgLSBleHBvcnQgYXMgZW51bWVyYWJsZSBwcm9wZXJ0eQoJICBvcHRpb25zLm5vVGFyZ2V0R2V0IC0gcHJldmVudCBjYWxsaW5nIGEgZ2V0dGVyIG9uIHRhcmdldAoJKi8KCgoJdmFyIF9leHBvcnQgPSBmdW5jdGlvbiAob3B0aW9ucywgc291cmNlKSB7CgkgIHZhciBUQVJHRVQgPSBvcHRpb25zLnRhcmdldDsKCSAgdmFyIEdMT0JBTCA9IG9wdGlvbnMuZ2xvYmFsOwoJICB2YXIgU1RBVElDID0gb3B0aW9ucy5zdGF0OwoJICB2YXIgRk9SQ0VELCB0YXJnZXQsIGtleSwgdGFyZ2V0UHJvcGVydHksIHNvdXJjZVByb3BlcnR5LCBkZXNjcmlwdG9yOwoKCSAgaWYgKEdMT0JBTCkgewoJICAgIHRhcmdldCA9IGdsb2JhbF8xOwoJICB9IGVsc2UgaWYgKFNUQVRJQykgewoJICAgIHRhcmdldCA9IGdsb2JhbF8xW1RBUkdFVF0gfHwgc2V0R2xvYmFsKFRBUkdFVCwge30pOwoJICB9IGVsc2UgewoJICAgIHRhcmdldCA9IChnbG9iYWxfMVtUQVJHRVRdIHx8IHt9KS5wcm90b3R5cGU7CgkgIH0KCgkgIGlmICh0YXJnZXQpIGZvciAoa2V5IGluIHNvdXJjZSkgewoJICAgIHNvdXJjZVByb3BlcnR5ID0gc291cmNlW2tleV07CgoJICAgIGlmIChvcHRpb25zLm5vVGFyZ2V0R2V0KSB7CgkgICAgICBkZXNjcmlwdG9yID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yJDEodGFyZ2V0LCBrZXkpOwoJICAgICAgdGFyZ2V0UHJvcGVydHkgPSBkZXNjcmlwdG9yICYmIGRlc2NyaXB0b3IudmFsdWU7CgkgICAgfSBlbHNlIHRhcmdldFByb3BlcnR5ID0gdGFyZ2V0W2tleV07CgoJICAgIEZPUkNFRCA9IGlzRm9yY2VkXzEoR0xPQkFMID8ga2V5IDogVEFSR0VUICsgKFNUQVRJQyA/ICcuJyA6ICcjJykgKyBrZXksIG9wdGlvbnMuZm9yY2VkKTsgLy8gY29udGFpbmVkIGluIHRhcmdldAoKCSAgICBpZiAoIUZPUkNFRCAmJiB0YXJnZXRQcm9wZXJ0eSAhPT0gdW5kZWZpbmVkKSB7CgkgICAgICBpZiAodHlwZW9mIHNvdXJjZVByb3BlcnR5ID09PSB0eXBlb2YgdGFyZ2V0UHJvcGVydHkpIGNvbnRpbnVlOwoJICAgICAgY29weUNvbnN0cnVjdG9yUHJvcGVydGllcyhzb3VyY2VQcm9wZXJ0eSwgdGFyZ2V0UHJvcGVydHkpOwoJICAgIH0gLy8gYWRkIGEgZmxhZyB0byBub3QgY29tcGxldGVseSBmdWxsIHBvbHlmaWxscwoKCgkgICAgaWYgKG9wdGlvbnMuc2hhbSB8fCB0YXJnZXRQcm9wZXJ0eSAmJiB0YXJnZXRQcm9wZXJ0eS5zaGFtKSB7CgkgICAgICBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkoc291cmNlUHJvcGVydHksICdzaGFtJywgdHJ1ZSk7CgkgICAgfSAvLyBleHRlbmQgZ2xvYmFsCgoKCSAgICByZWRlZmluZSh0YXJnZXQsIGtleSwgc291cmNlUHJvcGVydHksIG9wdGlvbnMpOwoJICB9Cgl9OwoKCS8vIGBPYmplY3Qua2V5c2AgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL2VjbWEyNjIvI3NlYy1vYmplY3Qua2V5cwoKCgl2YXIgb2JqZWN0S2V5cyA9IE9iamVjdC5rZXlzIHx8IGZ1bmN0aW9uIGtleXMoTykgewoJICByZXR1cm4gb2JqZWN0S2V5c0ludGVybmFsKE8sIGVudW1CdWdLZXlzKTsKCX07CgoJLy8gYFRvT2JqZWN0YCBhYnN0cmFjdCBvcGVyYXRpb24KCS8vIGh0dHBzOi8vdGMzOS5naXRodWIuaW8vZWNtYTI2Mi8jc2VjLXRvb2JqZWN0CgoKCXZhciB0b09iamVjdCA9IGZ1bmN0aW9uIChhcmd1bWVudCkgewoJICByZXR1cm4gT2JqZWN0KHJlcXVpcmVPYmplY3RDb2VyY2libGUoYXJndW1lbnQpKTsKCX07CgoJdmFyIG5hdGl2ZUFzc2lnbiA9IE9iamVjdC5hc3NpZ247Cgl2YXIgZGVmaW5lUHJvcGVydHkgPSBPYmplY3QuZGVmaW5lUHJvcGVydHk7IC8vIGBPYmplY3QuYXNzaWduYCBtZXRob2QKCS8vIGh0dHBzOi8vdGMzOS5naXRodWIuaW8vZWNtYTI2Mi8jc2VjLW9iamVjdC5hc3NpZ24KCgl2YXIgb2JqZWN0QXNzaWduID0gIW5hdGl2ZUFzc2lnbiB8fCBmYWlscyhmdW5jdGlvbiAoKSB7CgkgIC8vIHNob3VsZCBoYXZlIGNvcnJlY3Qgb3JkZXIgb2Ygb3BlcmF0aW9ucyAoRWRnZSBidWcpCgkgIGlmIChkZXNjcmlwdG9ycyAmJiBuYXRpdmVBc3NpZ24oewoJICAgIGI6IDEKCSAgfSwgbmF0aXZlQXNzaWduKGRlZmluZVByb3BlcnR5KHt9LCAnYScsIHsKCSAgICBlbnVtZXJhYmxlOiB0cnVlLAoJICAgIGdldDogZnVuY3Rpb24gKCkgewoJICAgICAgZGVmaW5lUHJvcGVydHkodGhpcywgJ2InLCB7CgkgICAgICAgIHZhbHVlOiAzLAoJICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZQoJICAgICAgfSk7CgkgICAgfQoJICB9KSwgewoJICAgIGI6IDIKCSAgfSkpLmIgIT09IDEpIHJldHVybiB0cnVlOyAvLyBzaG91bGQgd29yayB3aXRoIHN5bWJvbHMgYW5kIHNob3VsZCBoYXZlIGRldGVybWluaXN0aWMgcHJvcGVydHkgb3JkZXIgKFY4IGJ1ZykKCgkgIHZhciBBID0ge307CgkgIHZhciBCID0ge307IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bmRlZgoKCSAgdmFyIHN5bWJvbCA9IFN5bWJvbCgpOwoJICB2YXIgYWxwaGFiZXQgPSAnYWJjZGVmZ2hpamtsbW5vcHFyc3QnOwoJICBBW3N5bWJvbF0gPSA3OwoJICBhbHBoYWJldC5zcGxpdCgnJykuZm9yRWFjaChmdW5jdGlvbiAoY2hyKSB7CgkgICAgQltjaHJdID0gY2hyOwoJICB9KTsKCSAgcmV0dXJuIG5hdGl2ZUFzc2lnbih7fSwgQSlbc3ltYm9sXSAhPSA3IHx8IG9iamVjdEtleXMobmF0aXZlQXNzaWduKHt9LCBCKSkuam9pbignJykgIT0gYWxwaGFiZXQ7Cgl9KSA/IGZ1bmN0aW9uIGFzc2lnbih0YXJnZXQsIHNvdXJjZSkgewoJICAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXVudXNlZC12YXJzCgkgIHZhciBUID0gdG9PYmplY3QodGFyZ2V0KTsKCSAgdmFyIGFyZ3VtZW50c0xlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGg7CgkgIHZhciBpbmRleCA9IDE7CgkgIHZhciBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPSBvYmplY3RHZXRPd25Qcm9wZXJ0eVN5bWJvbHMuZjsKCSAgdmFyIHByb3BlcnR5SXNFbnVtZXJhYmxlID0gb2JqZWN0UHJvcGVydHlJc0VudW1lcmFibGUuZjsKCgkgIHdoaWxlIChhcmd1bWVudHNMZW5ndGggPiBpbmRleCkgewoJICAgIHZhciBTID0gaW5kZXhlZE9iamVjdChhcmd1bWVudHNbaW5kZXgrK10pOwoJICAgIHZhciBrZXlzID0gZ2V0T3duUHJvcGVydHlTeW1ib2xzID8gb2JqZWN0S2V5cyhTKS5jb25jYXQoZ2V0T3duUHJvcGVydHlTeW1ib2xzKFMpKSA6IG9iamVjdEtleXMoUyk7CgkgICAgdmFyIGxlbmd0aCA9IGtleXMubGVuZ3RoOwoJICAgIHZhciBqID0gMDsKCSAgICB2YXIga2V5OwoKCSAgICB3aGlsZSAobGVuZ3RoID4gaikgewoJICAgICAga2V5ID0ga2V5c1tqKytdOwoJICAgICAgaWYgKCFkZXNjcmlwdG9ycyB8fCBwcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKFMsIGtleSkpIFRba2V5XSA9IFNba2V5XTsKCSAgICB9CgkgIH0KCgkgIHJldHVybiBUOwoJfSA6IG5hdGl2ZUFzc2lnbjsKCgkvLyBgT2JqZWN0LmFzc2lnbmAgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL2VjbWEyNjIvI3NlYy1vYmplY3QuYXNzaWduCgoKCV9leHBvcnQoewoJICB0YXJnZXQ6ICdPYmplY3QnLAoJICBzdGF0OiB0cnVlLAoJICBmb3JjZWQ6IE9iamVjdC5hc3NpZ24gIT09IG9iamVjdEFzc2lnbgoJfSwgewoJICBhc3NpZ246IG9iamVjdEFzc2lnbgoJfSk7CgoJLy8gYFN0cmluZy5wcm90b3R5cGUucmVwZWF0YCBtZXRob2QgaW1wbGVtZW50YXRpb24KCS8vIGh0dHBzOi8vdGMzOS5naXRodWIuaW8vZWNtYTI2Mi8jc2VjLXN0cmluZy5wcm90b3R5cGUucmVwZWF0CgoKCXZhciBzdHJpbmdSZXBlYXQgPSAnJy5yZXBlYXQgfHwgZnVuY3Rpb24gcmVwZWF0KGNvdW50KSB7CgkgIHZhciBzdHIgPSBTdHJpbmcocmVxdWlyZU9iamVjdENvZXJjaWJsZSh0aGlzKSk7CgkgIHZhciByZXN1bHQgPSAnJzsKCSAgdmFyIG4gPSB0b0ludGVnZXIoY291bnQpOwoJICBpZiAobiA8IDAgfHwgbiA9PSBJbmZpbml0eSkgdGhyb3cgUmFuZ2VFcnJvcignV3JvbmcgbnVtYmVyIG9mIHJlcGV0aXRpb25zJyk7CgoJICBmb3IgKDsgbiA+IDA7IChuID4+Pj0gMSkgJiYgKHN0ciArPSBzdHIpKSBpZiAobiAmIDEpIHJlc3VsdCArPSBzdHI7CgoJICByZXR1cm4gcmVzdWx0OwoJfTsKCgkvLyBodHRwczovL2dpdGh1Yi5jb20vdGMzOS9wcm9wb3NhbC1zdHJpbmctcGFkLXN0YXJ0LWVuZAoKCgoKCgoJdmFyIGNlaWwkMSA9IE1hdGguY2VpbDsgLy8gYFN0cmluZy5wcm90b3R5cGUueyBwYWRTdGFydCwgcGFkRW5kIH1gIG1ldGhvZHMgaW1wbGVtZW50YXRpb24KCgl2YXIgY3JlYXRlTWV0aG9kJDEgPSBmdW5jdGlvbiAoSVNfRU5EKSB7CgkgIHJldHVybiBmdW5jdGlvbiAoJHRoaXMsIG1heExlbmd0aCwgZmlsbFN0cmluZykgewoJICAgIHZhciBTID0gU3RyaW5nKHJlcXVpcmVPYmplY3RDb2VyY2libGUoJHRoaXMpKTsKCSAgICB2YXIgc3RyaW5nTGVuZ3RoID0gUy5sZW5ndGg7CgkgICAgdmFyIGZpbGxTdHIgPSBmaWxsU3RyaW5nID09PSB1bmRlZmluZWQgPyAnICcgOiBTdHJpbmcoZmlsbFN0cmluZyk7CgkgICAgdmFyIGludE1heExlbmd0aCA9IHRvTGVuZ3RoKG1heExlbmd0aCk7CgkgICAgdmFyIGZpbGxMZW4sIHN0cmluZ0ZpbGxlcjsKCSAgICBpZiAoaW50TWF4TGVuZ3RoIDw9IHN0cmluZ0xlbmd0aCB8fCBmaWxsU3RyID09ICcnKSByZXR1cm4gUzsKCSAgICBmaWxsTGVuID0gaW50TWF4TGVuZ3RoIC0gc3RyaW5nTGVuZ3RoOwoJICAgIHN0cmluZ0ZpbGxlciA9IHN0cmluZ1JlcGVhdC5jYWxsKGZpbGxTdHIsIGNlaWwkMShmaWxsTGVuIC8gZmlsbFN0ci5sZW5ndGgpKTsKCSAgICBpZiAoc3RyaW5nRmlsbGVyLmxlbmd0aCA+IGZpbGxMZW4pIHN0cmluZ0ZpbGxlciA9IHN0cmluZ0ZpbGxlci5zbGljZSgwLCBmaWxsTGVuKTsKCSAgICByZXR1cm4gSVNfRU5EID8gUyArIHN0cmluZ0ZpbGxlciA6IHN0cmluZ0ZpbGxlciArIFM7CgkgIH07Cgl9OwoKCXZhciBzdHJpbmdQYWQgPSB7CgkgIC8vIGBTdHJpbmcucHJvdG90eXBlLnBhZFN0YXJ0YCBtZXRob2QKCSAgLy8gaHR0cHM6Ly90YzM5LmdpdGh1Yi5pby9lY21hMjYyLyNzZWMtc3RyaW5nLnByb3RvdHlwZS5wYWRzdGFydAoJICBzdGFydDogY3JlYXRlTWV0aG9kJDEoZmFsc2UpLAoJICAvLyBgU3RyaW5nLnByb3RvdHlwZS5wYWRFbmRgIG1ldGhvZAoJICAvLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL2VjbWEyNjIvI3NlYy1zdHJpbmcucHJvdG90eXBlLnBhZGVuZAoJICBlbmQ6IGNyZWF0ZU1ldGhvZCQxKHRydWUpCgl9OwoKCXZhciBlbmdpbmVVc2VyQWdlbnQgPSBnZXRCdWlsdEluKCduYXZpZ2F0b3InLCAndXNlckFnZW50JykgfHwgJyc7CgoJLy8gaHR0cHM6Ly9naXRodWIuY29tL3psb2lyb2NrL2NvcmUtanMvaXNzdWVzLzI4MAoJIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSB1bmljb3JuL25vLXVuc2FmZS1yZWdleAoKCgl2YXIgc3RyaW5nUGFkV2Via2l0QnVnID0gL1ZlcnNpb25cLzEwXC5cZCsoXC5cZCspPyggTW9iaWxlXC9cdyspPyBTYWZhcmlcLy8udGVzdChlbmdpbmVVc2VyQWdlbnQpOwoKCXZhciAkcGFkRW5kID0gc3RyaW5nUGFkLmVuZDsKCgkgLy8gYFN0cmluZy5wcm90b3R5cGUucGFkRW5kYCBtZXRob2QKCS8vIGh0dHBzOi8vdGMzOS5naXRodWIuaW8vZWNtYTI2Mi8jc2VjLXN0cmluZy5wcm90b3R5cGUucGFkZW5kCgoKCV9leHBvcnQoewoJICB0YXJnZXQ6ICdTdHJpbmcnLAoJICBwcm90bzogdHJ1ZSwKCSAgZm9yY2VkOiBzdHJpbmdQYWRXZWJraXRCdWcKCX0sIHsKCSAgcGFkRW5kOiBmdW5jdGlvbiBwYWRFbmQobWF4TGVuZ3RoCgkgIC8qICwgZmlsbFN0cmluZyA9ICcgJyAqLwoJICApIHsKCSAgICByZXR1cm4gJHBhZEVuZCh0aGlzLCBtYXhMZW5ndGgsIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkKTsKCSAgfQoJfSk7CgoJdmFyICRwYWRTdGFydCA9IHN0cmluZ1BhZC5zdGFydDsKCgkgLy8gYFN0cmluZy5wcm90b3R5cGUucGFkU3RhcnRgIG1ldGhvZAoJLy8gaHR0cHM6Ly90YzM5LmdpdGh1Yi5pby9lY21hMjYyLyNzZWMtc3RyaW5nLnByb3RvdHlwZS5wYWRzdGFydAoKCglfZXhwb3J0KHsKCSAgdGFyZ2V0OiAnU3RyaW5nJywKCSAgcHJvdG86IHRydWUsCgkgIGZvcmNlZDogc3RyaW5nUGFkV2Via2l0QnVnCgl9LCB7CgkgIHBhZFN0YXJ0OiBmdW5jdGlvbiBwYWRTdGFydChtYXhMZW5ndGgKCSAgLyogLCBmaWxsU3RyaW5nID0gJyAnICovCgkgICkgewoJICAgIHJldHVybiAkcGFkU3RhcnQodGhpcywgbWF4TGVuZ3RoLCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCk7CgkgIH0KCX0pOwoKCS8vIGBTdHJpbmcucHJvdG90eXBlLnJlcGVhdGAgbWV0aG9kCgkvLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL2VjbWEyNjIvI3NlYy1zdHJpbmcucHJvdG90eXBlLnJlcGVhdAoKCglfZXhwb3J0KHsKCSAgdGFyZ2V0OiAnU3RyaW5nJywKCSAgcHJvdG86IHRydWUKCX0sIHsKCSAgcmVwZWF0OiBzdHJpbmdSZXBlYXQKCX0pOwoKCS8vIGBnbG9iYWxUaGlzYCBvYmplY3QKCS8vIGh0dHBzOi8vZ2l0aHViLmNvbS90YzM5L3Byb3Bvc2FsLWdsb2JhbAoKCglfZXhwb3J0KHsKCSAgZ2xvYmFsOiB0cnVlCgl9LCB7CgkgIGdsb2JhbFRoaXM6IGdsb2JhbF8xCgl9KTsKCglmdW5jdGlvbiBfdHlwZW9mKG9iaikgewoJICAiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YiOwoKCSAgaWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHsKCSAgICBfdHlwZW9mID0gZnVuY3Rpb24gKG9iaikgewoJICAgICAgcmV0dXJuIHR5cGVvZiBvYmo7CgkgICAgfTsKCSAgfSBlbHNlIHsKCSAgICBfdHlwZW9mID0gZnVuY3Rpb24gKG9iaikgewoJICAgICAgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsKCSAgICB9OwoJICB9CgoJICByZXR1cm4gX3R5cGVvZihvYmopOwoJfQoKCWZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsKCSAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsKCSAgfQoJfQoKCWZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsKCSAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgewoJICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07CgkgICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOwoJICAgIGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsKCSAgICBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKCSAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7CgkgIH0KCX0KCglmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CgkgIGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOwoJICBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7CgkgIHJldHVybiBDb25zdHJ1Y3RvcjsKCX0KCglmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CgkgIGlmIChrZXkgaW4gb2JqKSB7CgkgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7CgkgICAgICB2YWx1ZTogdmFsdWUsCgkgICAgICBlbnVtZXJhYmxlOiB0cnVlLAoJICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAoJICAgICAgd3JpdGFibGU6IHRydWUKCSAgICB9KTsKCSAgfSBlbHNlIHsKCSAgICBvYmpba2V5XSA9IHZhbHVlOwoJICB9CgoJICByZXR1cm4gb2JqOwoJfQoKCWZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgewoJICBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgewoJICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7CgkgIH0KCgkgIHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgewoJICAgIGNvbnN0cnVjdG9yOiB7CgkgICAgICB2YWx1ZTogc3ViQ2xhc3MsCgkgICAgICB3cml0YWJsZTogdHJ1ZSwKCSAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQoJICAgIH0KCSAgfSk7CgkgIGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOwoJfQoKCWZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7CgkgIF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7CgkgICAgcmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTsKCSAgfTsKCSAgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsKCX0KCglmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgewoJICBfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsKCSAgICBvLl9fcHJvdG9fXyA9IHA7CgkgICAgcmV0dXJuIG87CgkgIH07CgoJICByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOwoJfQoKCWZ1bmN0aW9uIF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKHNvdXJjZSwgZXhjbHVkZWQpIHsKCSAgaWYgKHNvdXJjZSA9PSBudWxsKSByZXR1cm4ge307CgkgIHZhciB0YXJnZXQgPSB7fTsKCSAgdmFyIHNvdXJjZUtleXMgPSBPYmplY3Qua2V5cyhzb3VyY2UpOwoJICB2YXIga2V5LCBpOwoKCSAgZm9yIChpID0gMDsgaSA8IHNvdXJjZUtleXMubGVuZ3RoOyBpKyspIHsKCSAgICBrZXkgPSBzb3VyY2VLZXlzW2ldOwoJICAgIGlmIChleGNsdWRlZC5pbmRleE9mKGtleSkgPj0gMCkgY29udGludWU7CgkgICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsKCSAgfQoKCSAgcmV0dXJuIHRhcmdldDsKCX0KCglmdW5jdGlvbiBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMoc291cmNlLCBleGNsdWRlZCkgewoJICBpZiAoc291cmNlID09IG51bGwpIHJldHVybiB7fTsKCgkgIHZhciB0YXJnZXQgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZShzb3VyY2UsIGV4Y2x1ZGVkKTsKCgkgIHZhciBrZXksIGk7CgoJICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgewoJICAgIHZhciBzb3VyY2VTeW1ib2xLZXlzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhzb3VyY2UpOwoKCSAgICBmb3IgKGkgPSAwOyBpIDwgc291cmNlU3ltYm9sS2V5cy5sZW5ndGg7IGkrKykgewoJICAgICAga2V5ID0gc291cmNlU3ltYm9sS2V5c1tpXTsKCSAgICAgIGlmIChleGNsdWRlZC5pbmRleE9mKGtleSkgPj0gMCkgY29udGludWU7CgkgICAgICBpZiAoIU9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChzb3VyY2UsIGtleSkpIGNvbnRpbnVlOwoJICAgICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsKCSAgICB9CgkgIH0KCgkgIHJldHVybiB0YXJnZXQ7Cgl9CgoJZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7CgkgIGlmIChzZWxmID09PSB2b2lkIDApIHsKCSAgICB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOwoJICB9CgoJICByZXR1cm4gc2VsZjsKCX0KCglmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7CgkgIGlmIChjYWxsICYmICh0eXBlb2YgY2FsbCA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7CgkgICAgcmV0dXJuIGNhbGw7CgkgIH0KCgkgIHJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpOwoJfQoKCWZ1bmN0aW9uIF9zdXBlclByb3BCYXNlKG9iamVjdCwgcHJvcGVydHkpIHsKCSAgd2hpbGUgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSkpIHsKCSAgICBvYmplY3QgPSBfZ2V0UHJvdG90eXBlT2Yob2JqZWN0KTsKCSAgICBpZiAob2JqZWN0ID09PSBudWxsKSBicmVhazsKCSAgfQoKCSAgcmV0dXJuIG9iamVjdDsKCX0KCglmdW5jdGlvbiBfZ2V0KHRhcmdldCwgcHJvcGVydHksIHJlY2VpdmVyKSB7CgkgIGlmICh0eXBlb2YgUmVmbGVjdCAhPT0gInVuZGVmaW5lZCIgJiYgUmVmbGVjdC5nZXQpIHsKCSAgICBfZ2V0ID0gUmVmbGVjdC5nZXQ7CgkgIH0gZWxzZSB7CgkgICAgX2dldCA9IGZ1bmN0aW9uIF9nZXQodGFyZ2V0LCBwcm9wZXJ0eSwgcmVjZWl2ZXIpIHsKCSAgICAgIHZhciBiYXNlID0gX3N1cGVyUHJvcEJhc2UodGFyZ2V0LCBwcm9wZXJ0eSk7CgoJICAgICAgaWYgKCFiYXNlKSByZXR1cm47CgkgICAgICB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoYmFzZSwgcHJvcGVydHkpOwoKCSAgICAgIGlmIChkZXNjLmdldCkgewoJICAgICAgICByZXR1cm4gZGVzYy5nZXQuY2FsbChyZWNlaXZlcik7CgkgICAgICB9CgoJICAgICAgcmV0dXJuIGRlc2MudmFsdWU7CgkgICAgfTsKCSAgfQoKCSAgcmV0dXJuIF9nZXQodGFyZ2V0LCBwcm9wZXJ0eSwgcmVjZWl2ZXIgfHwgdGFyZ2V0KTsKCX0KCglmdW5jdGlvbiBzZXQkMSh0YXJnZXQsIHByb3BlcnR5LCB2YWx1ZSwgcmVjZWl2ZXIpIHsKCSAgaWYgKHR5cGVvZiBSZWZsZWN0ICE9PSAidW5kZWZpbmVkIiAmJiBSZWZsZWN0LnNldCkgewoJICAgIHNldCQxID0gUmVmbGVjdC5zZXQ7CgkgIH0gZWxzZSB7CgkgICAgc2V0JDEgPSBmdW5jdGlvbiBzZXQodGFyZ2V0LCBwcm9wZXJ0eSwgdmFsdWUsIHJlY2VpdmVyKSB7CgkgICAgICB2YXIgYmFzZSA9IF9zdXBlclByb3BCYXNlKHRhcmdldCwgcHJvcGVydHkpOwoKCSAgICAgIHZhciBkZXNjOwoKCSAgICAgIGlmIChiYXNlKSB7CgkgICAgICAgIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGJhc2UsIHByb3BlcnR5KTsKCgkgICAgICAgIGlmIChkZXNjLnNldCkgewoJICAgICAgICAgIGRlc2Muc2V0LmNhbGwocmVjZWl2ZXIsIHZhbHVlKTsKCSAgICAgICAgICByZXR1cm4gdHJ1ZTsKCSAgICAgICAgfSBlbHNlIGlmICghZGVzYy53cml0YWJsZSkgewoJICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgfQoKCSAgICAgIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHJlY2VpdmVyLCBwcm9wZXJ0eSk7CgoJICAgICAgaWYgKGRlc2MpIHsKCSAgICAgICAgaWYgKCFkZXNjLndyaXRhYmxlKSB7CgkgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgoJICAgICAgICBkZXNjLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShyZWNlaXZlciwgcHJvcGVydHksIGRlc2MpOwoJICAgICAgfSBlbHNlIHsKCSAgICAgICAgX2RlZmluZVByb3BlcnR5KHJlY2VpdmVyLCBwcm9wZXJ0eSwgdmFsdWUpOwoJICAgICAgfQoKCSAgICAgIHJldHVybiB0cnVlOwoJICAgIH07CgkgIH0KCgkgIHJldHVybiBzZXQkMSh0YXJnZXQsIHByb3BlcnR5LCB2YWx1ZSwgcmVjZWl2ZXIpOwoJfQoKCWZ1bmN0aW9uIF9zZXQodGFyZ2V0LCBwcm9wZXJ0eSwgdmFsdWUsIHJlY2VpdmVyLCBpc1N0cmljdCkgewoJICB2YXIgcyA9IHNldCQxKHRhcmdldCwgcHJvcGVydHksIHZhbHVlLCByZWNlaXZlciB8fCB0YXJnZXQpOwoKCSAgaWYgKCFzICYmIGlzU3RyaWN0KSB7CgkgICAgdGhyb3cgbmV3IEVycm9yKCdmYWlsZWQgdG8gc2V0IHByb3BlcnR5Jyk7CgkgIH0KCgkgIHJldHVybiB2YWx1ZTsKCX0KCglmdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkpIHsKCSAgcmV0dXJuIF9hcnJheVdpdGhIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHx8IF9ub25JdGVyYWJsZVJlc3QoKTsKCX0KCglmdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB7CgkgIGlmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnI7Cgl9CgoJZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgewoJICBpZiAoIShTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGFycikgfHwgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGFycikgPT09ICJbb2JqZWN0IEFyZ3VtZW50c10iKSkgewoJICAgIHJldHVybjsKCSAgfQoKCSAgdmFyIF9hcnIgPSBbXTsKCSAgdmFyIF9uID0gdHJ1ZTsKCSAgdmFyIF9kID0gZmFsc2U7CgkgIHZhciBfZSA9IHVuZGVmaW5lZDsKCgkgIHRyeSB7CgkgICAgZm9yICh2YXIgX2kgPSBhcnJbU3ltYm9sLml0ZXJhdG9yXSgpLCBfczsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkgewoJICAgICAgX2Fyci5wdXNoKF9zLnZhbHVlKTsKCgkgICAgICBpZiAoaSAmJiBfYXJyLmxlbmd0aCA9PT0gaSkgYnJlYWs7CgkgICAgfQoJICB9IGNhdGNoIChlcnIpIHsKCSAgICBfZCA9IHRydWU7CgkgICAgX2UgPSBlcnI7CgkgIH0gZmluYWxseSB7CgkgICAgdHJ5IHsKCSAgICAgIGlmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpOwoJICAgIH0gZmluYWxseSB7CgkgICAgICBpZiAoX2QpIHRocm93IF9lOwoJICAgIH0KCSAgfQoKCSAgcmV0dXJuIF9hcnI7Cgl9CgoJZnVuY3Rpb24gX25vbkl0ZXJhYmxlUmVzdCgpIHsKCSAgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZSIpOwoJfQoKCS8qKiBDaGVja3MgaWYgdmFsdWUgaXMgc3RyaW5nICovCglmdW5jdGlvbiBpc1N0cmluZyhzdHIpIHsKCSAgcmV0dXJuIHR5cGVvZiBzdHIgPT09ICdzdHJpbmcnIHx8IHN0ciBpbnN0YW5jZW9mIFN0cmluZzsKCX0KCS8qKgoJICBEaXJlY3Rpb24KCSAgQHByb3Age3N0cmluZ30gTk9ORQoJICBAcHJvcCB7c3RyaW5nfSBMRUZUCgkgIEBwcm9wIHtzdHJpbmd9IEZPUkNFX0xFRlQKCSAgQHByb3Age3N0cmluZ30gUklHSFQKCSAgQHByb3Age3N0cmluZ30gRk9SQ0VfUklHSFQKCSovCgoJdmFyIERJUkVDVElPTiA9IHsKCSAgTk9ORTogJ05PTkUnLAoJICBMRUZUOiAnTEVGVCcsCgkgIEZPUkNFX0xFRlQ6ICdGT1JDRV9MRUZUJywKCSAgUklHSFQ6ICdSSUdIVCcsCgkgIEZPUkNFX1JJR0hUOiAnRk9SQ0VfUklHSFQnCgl9OwoJLyoqICovCgoJZnVuY3Rpb24gZm9yY2VEaXJlY3Rpb24oZGlyZWN0aW9uKSB7CgkgIHN3aXRjaCAoZGlyZWN0aW9uKSB7CgkgICAgY2FzZSBESVJFQ1RJT04uTEVGVDoKCSAgICAgIHJldHVybiBESVJFQ1RJT04uRk9SQ0VfTEVGVDsKCgkgICAgY2FzZSBESVJFQ1RJT04uUklHSFQ6CgkgICAgICByZXR1cm4gRElSRUNUSU9OLkZPUkNFX1JJR0hUOwoKCSAgICBkZWZhdWx0OgoJICAgICAgcmV0dXJuIGRpcmVjdGlvbjsKCSAgfQoJfQoJLyoqIEVzY2FwZXMgcmVndWxhciBleHByZXNzaW9uIGNvbnRyb2wgY2hhcnMgKi8KCglmdW5jdGlvbiBlc2NhcGVSZWdFeHAoc3RyKSB7CgkgIHJldHVybiBzdHIucmVwbGFjZSgvKFsuKis/Xj0hOiR7fSgpfFtcXS9cXF0pL2csICdcXCQxJyk7Cgl9IC8vIGNsb25lZCBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9lcG9iZXJlemtpbi9mYXN0LWRlZXAtZXF1YWwgd2l0aCBzbWFsbCBjaGFuZ2VzCgoJZnVuY3Rpb24gb2JqZWN0SW5jbHVkZXMoYiwgYSkgewoJICBpZiAoYSA9PT0gYikgcmV0dXJuIHRydWU7CgkgIHZhciBhcnJBID0gQXJyYXkuaXNBcnJheShhKSwKCSAgICAgIGFyckIgPSBBcnJheS5pc0FycmF5KGIpLAoJICAgICAgaTsKCgkgIGlmIChhcnJBICYmIGFyckIpIHsKCSAgICBpZiAoYS5sZW5ndGggIT0gYi5sZW5ndGgpIHJldHVybiBmYWxzZTsKCgkgICAgZm9yIChpID0gMDsgaSA8IGEubGVuZ3RoOyBpKyspIHsKCSAgICAgIGlmICghb2JqZWN0SW5jbHVkZXMoYVtpXSwgYltpXSkpIHJldHVybiBmYWxzZTsKCSAgICB9CgoJICAgIHJldHVybiB0cnVlOwoJICB9CgoJICBpZiAoYXJyQSAhPSBhcnJCKSByZXR1cm4gZmFsc2U7CgoJICBpZiAoYSAmJiBiICYmIF90eXBlb2YoYSkgPT09ICdvYmplY3QnICYmIF90eXBlb2YoYikgPT09ICdvYmplY3QnKSB7CgkgICAgdmFyIGRhdGVBID0gYSBpbnN0YW5jZW9mIERhdGUsCgkgICAgICAgIGRhdGVCID0gYiBpbnN0YW5jZW9mIERhdGU7CgkgICAgaWYgKGRhdGVBICYmIGRhdGVCKSByZXR1cm4gYS5nZXRUaW1lKCkgPT0gYi5nZXRUaW1lKCk7CgkgICAgaWYgKGRhdGVBICE9IGRhdGVCKSByZXR1cm4gZmFsc2U7CgkgICAgdmFyIHJlZ2V4cEEgPSBhIGluc3RhbmNlb2YgUmVnRXhwLAoJICAgICAgICByZWdleHBCID0gYiBpbnN0YW5jZW9mIFJlZ0V4cDsKCSAgICBpZiAocmVnZXhwQSAmJiByZWdleHBCKSByZXR1cm4gYS50b1N0cmluZygpID09IGIudG9TdHJpbmcoKTsKCSAgICBpZiAocmVnZXhwQSAhPSByZWdleHBCKSByZXR1cm4gZmFsc2U7CgkgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhhKTsgLy8gaWYgKGtleXMubGVuZ3RoICE9PSBPYmplY3Qua2V5cyhiKS5sZW5ndGgpIHJldHVybiBmYWxzZTsKCgkgICAgZm9yIChpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHsKCSAgICAgIGlmICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGIsIGtleXNbaV0pKSByZXR1cm4gZmFsc2U7CgkgICAgfQoKCSAgICBmb3IgKGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgewoJICAgICAgaWYgKCFvYmplY3RJbmNsdWRlcyhiW2tleXNbaV1dLCBhW2tleXNbaV1dKSkgcmV0dXJuIGZhbHNlOwoJICAgIH0KCgkgICAgcmV0dXJuIHRydWU7CgkgIH0gZWxzZSBpZiAoYSAmJiBiICYmIHR5cGVvZiBhID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZiBiID09PSAnZnVuY3Rpb24nKSB7CgkgICAgcmV0dXJuIGEudG9TdHJpbmcoKSA9PT0gYi50b1N0cmluZygpOwoJICB9CgoJICByZXR1cm4gZmFsc2U7Cgl9CgkvKiogU2VsZWN0aW9uIHJhbmdlICovCgoJLyoqIFByb3ZpZGVzIGRldGFpbHMgb2YgY2hhbmdpbmcgaW5wdXQgKi8KCgl2YXIgQWN0aW9uRGV0YWlscyA9CgkvKiNfX1BVUkVfXyovCglmdW5jdGlvbiAoKSB7CgkgIC8qKiBDdXJyZW50IGlucHV0IHZhbHVlICovCgoJICAvKiogQ3VycmVudCBjdXJzb3IgcG9zaXRpb24gKi8KCgkgIC8qKiBPbGQgaW5wdXQgdmFsdWUgKi8KCgkgIC8qKiBPbGQgc2VsZWN0aW9uICovCgkgIGZ1bmN0aW9uIEFjdGlvbkRldGFpbHModmFsdWUsIGN1cnNvclBvcywgb2xkVmFsdWUsIG9sZFNlbGVjdGlvbikgewoJICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBBY3Rpb25EZXRhaWxzKTsKCgkgICAgdGhpcy52YWx1ZSA9IHZhbHVlOwoJICAgIHRoaXMuY3Vyc29yUG9zID0gY3Vyc29yUG9zOwoJICAgIHRoaXMub2xkVmFsdWUgPSBvbGRWYWx1ZTsKCSAgICB0aGlzLm9sZFNlbGVjdGlvbiA9IG9sZFNlbGVjdGlvbjsgLy8gZG91YmxlIGNoZWNrIGlmIGxlZnQgcGFydCB3YXMgY2hhbmdlZCAoYXV0b2ZpbGxpbmcsIG90aGVyIG5vbi1zdGFuZGFyZCBpbnB1dCB0cmlnZ2VycykKCgkgICAgd2hpbGUgKHRoaXMudmFsdWUuc2xpY2UoMCwgdGhpcy5zdGFydENoYW5nZVBvcykgIT09IHRoaXMub2xkVmFsdWUuc2xpY2UoMCwgdGhpcy5zdGFydENoYW5nZVBvcykpIHsKCSAgICAgIC0tdGhpcy5vbGRTZWxlY3Rpb24uc3RhcnQ7CgkgICAgfQoJICB9CgkgIC8qKgoJICAgIFN0YXJ0IGNoYW5naW5nIHBvc2l0aW9uCgkgICAgQHJlYWRvbmx5CgkgICovCgoKCSAgX2NyZWF0ZUNsYXNzKEFjdGlvbkRldGFpbHMsIFt7CgkgICAga2V5OiAic3RhcnRDaGFuZ2VQb3MiLAoJICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewoJICAgICAgcmV0dXJuIE1hdGgubWluKHRoaXMuY3Vyc29yUG9zLCB0aGlzLm9sZFNlbGVjdGlvbi5zdGFydCk7CgkgICAgfQoJICAgIC8qKgoJICAgICAgSW5zZXJ0ZWQgc3ltYm9scyBjb3VudAoJICAgICAgQHJlYWRvbmx5CgkgICAgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJpbnNlcnRlZENvdW50IiwKCSAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCSAgICAgIHJldHVybiB0aGlzLmN1cnNvclBvcyAtIHRoaXMuc3RhcnRDaGFuZ2VQb3M7CgkgICAgfQoJICAgIC8qKgoJICAgICAgSW5zZXJ0ZWQgc3ltYm9scwoJICAgICAgQHJlYWRvbmx5CgkgICAgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJpbnNlcnRlZCIsCgkgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkgICAgICByZXR1cm4gdGhpcy52YWx1ZS5zdWJzdHIodGhpcy5zdGFydENoYW5nZVBvcywgdGhpcy5pbnNlcnRlZENvdW50KTsKCSAgICB9CgkgICAgLyoqCgkgICAgICBSZW1vdmVkIHN5bWJvbHMgY291bnQKCSAgICAgIEByZWFkb25seQoJICAgICovCgoJICB9LCB7CgkgICAga2V5OiAicmVtb3ZlZENvdW50IiwKCSAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCSAgICAgIC8vIE1hdGgubWF4IGZvciBvcHBvc2l0ZSBvcGVyYXRpb24KCSAgICAgIHJldHVybiBNYXRoLm1heCh0aGlzLm9sZFNlbGVjdGlvbi5lbmQgLSB0aGlzLnN0YXJ0Q2hhbmdlUG9zIHx8IC8vIGZvciBEZWxldGUKCSAgICAgIHRoaXMub2xkVmFsdWUubGVuZ3RoIC0gdGhpcy52YWx1ZS5sZW5ndGgsIDApOwoJICAgIH0KCSAgICAvKioKCSAgICAgIFJlbW92ZWQgc3ltYm9scwoJICAgICAgQHJlYWRvbmx5CgkgICAgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJyZW1vdmVkIiwKCSAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCSAgICAgIHJldHVybiB0aGlzLm9sZFZhbHVlLnN1YnN0cih0aGlzLnN0YXJ0Q2hhbmdlUG9zLCB0aGlzLnJlbW92ZWRDb3VudCk7CgkgICAgfQoJICAgIC8qKgoJICAgICAgVW5jaGFuZ2VkIGhlYWQgc3ltYm9scwoJICAgICAgQHJlYWRvbmx5CgkgICAgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJoZWFkIiwKCSAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCSAgICAgIHJldHVybiB0aGlzLnZhbHVlLnN1YnN0cmluZygwLCB0aGlzLnN0YXJ0Q2hhbmdlUG9zKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICBVbmNoYW5nZWQgdGFpbCBzeW1ib2xzCgkgICAgICBAcmVhZG9ubHkKCSAgICAqLwoKCSAgfSwgewoJICAgIGtleTogInRhaWwiLAoJICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewoJICAgICAgcmV0dXJuIHRoaXMudmFsdWUuc3Vic3RyaW5nKHRoaXMuc3RhcnRDaGFuZ2VQb3MgKyB0aGlzLmluc2VydGVkQ291bnQpOwoJICAgIH0KCSAgICAvKioKCSAgICAgIFJlbW92ZSBkaXJlY3Rpb24KCSAgICAgIEByZWFkb25seQoJICAgICovCgoJICB9LCB7CgkgICAga2V5OiAicmVtb3ZlRGlyZWN0aW9uIiwKCSAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCSAgICAgIGlmICghdGhpcy5yZW1vdmVkQ291bnQgfHwgdGhpcy5pbnNlcnRlZENvdW50KSByZXR1cm4gRElSRUNUSU9OLk5PTkU7IC8vIGFsaWduIHJpZ2h0IGlmIGRlbGV0ZSBhdCByaWdodCBvciBpZiByYW5nZSByZW1vdmVkIChldmVudCB3aXRoIGJhY2tzcGFjZSkKCgkgICAgICByZXR1cm4gdGhpcy5vbGRTZWxlY3Rpb24uZW5kID09PSB0aGlzLmN1cnNvclBvcyB8fCB0aGlzLm9sZFNlbGVjdGlvbi5zdGFydCA9PT0gdGhpcy5jdXJzb3JQb3MgPyBESVJFQ1RJT04uUklHSFQgOiBESVJFQ1RJT04uTEVGVDsKCSAgICB9CgkgIH1dKTsKCgkgIHJldHVybiBBY3Rpb25EZXRhaWxzOwoJfSgpOwoKCS8qKgoJICBQcm92aWRlcyBkZXRhaWxzIG9mIGNoYW5naW5nIG1vZGVsIHZhbHVlCgkgIEBwYXJhbSB7T2JqZWN0fSBbZGV0YWlsc10KCSAgQHBhcmFtIHtzdHJpbmd9IFtkZXRhaWxzLmluc2VydGVkXSAtIEluc2VydGVkIHN5bWJvbHMKCSAgQHBhcmFtIHtib29sZWFufSBbZGV0YWlscy5za2lwXSAtIENhbiBza2lwIGNoYXJzCgkgIEBwYXJhbSB7bnVtYmVyfSBbZGV0YWlscy5yZW1vdmVDb3VudF0gLSBSZW1vdmVkIHN5bWJvbHMgY291bnQKCSAgQHBhcmFtIHtudW1iZXJ9IFtkZXRhaWxzLnRhaWxTaGlmdF0gLSBBZGRpdGlvbmFsIG9mZnNldCBpZiBhbnkgY2hhbmdlcyBvY2N1cnJlZCBiZWZvcmUgdGFpbAoJKi8KCXZhciBDaGFuZ2VEZXRhaWxzID0KCS8qI19fUFVSRV9fKi8KCWZ1bmN0aW9uICgpIHsKCSAgLyoqIEluc2VydGVkIHN5bWJvbHMgKi8KCgkgIC8qKiBDYW4gc2tpcCBjaGFycyAqLwoKCSAgLyoqIEFkZGl0aW9uYWwgb2Zmc2V0IGlmIGFueSBjaGFuZ2VzIG9jY3VycmVkIGJlZm9yZSB0YWlsICovCgoJICAvKiogUmF3IGluc2VydGVkIGlzIHVzZWQgYnkgZHluYW1pYyBtYXNrICovCgkgIGZ1bmN0aW9uIENoYW5nZURldGFpbHMoZGV0YWlscykgewoJICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBDaGFuZ2VEZXRhaWxzKTsKCgkgICAgT2JqZWN0LmFzc2lnbih0aGlzLCB7CgkgICAgICBpbnNlcnRlZDogJycsCgkgICAgICByYXdJbnNlcnRlZDogJycsCgkgICAgICBza2lwOiBmYWxzZSwKCSAgICAgIHRhaWxTaGlmdDogMAoJICAgIH0sIGRldGFpbHMpOwoJICB9CgkgIC8qKgoJICAgIEFnZ3JlZ2F0ZSBjaGFuZ2VzCgkgICAgQHJldHVybnMge0NoYW5nZURldGFpbHN9IGB0aGlzYAoJICAqLwoKCgkgIF9jcmVhdGVDbGFzcyhDaGFuZ2VEZXRhaWxzLCBbewoJICAgIGtleTogImFnZ3JlZ2F0ZSIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGFnZ3JlZ2F0ZShkZXRhaWxzKSB7CgkgICAgICB0aGlzLnJhd0luc2VydGVkICs9IGRldGFpbHMucmF3SW5zZXJ0ZWQ7CgkgICAgICB0aGlzLnNraXAgPSB0aGlzLnNraXAgfHwgZGV0YWlscy5za2lwOwoJICAgICAgdGhpcy5pbnNlcnRlZCArPSBkZXRhaWxzLmluc2VydGVkOwoJICAgICAgdGhpcy50YWlsU2hpZnQgKz0gZGV0YWlscy50YWlsU2hpZnQ7CgkgICAgICByZXR1cm4gdGhpczsKCSAgICB9CgkgICAgLyoqIFRvdGFsIG9mZnNldCBjb25zaWRlcmluZyBhbGwgY2hhbmdlcyAqLwoKCSAgfSwgewoJICAgIGtleTogIm9mZnNldCIsCgkgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkgICAgICByZXR1cm4gdGhpcy50YWlsU2hpZnQgKyB0aGlzLmluc2VydGVkLmxlbmd0aDsKCSAgICB9CgkgIH1dKTsKCgkgIHJldHVybiBDaGFuZ2VEZXRhaWxzOwoJfSgpOwoKCS8qKiBQcm92aWRlcyBkZXRhaWxzIG9mIGNvbnRpbnVvdXMgZXh0cmFjdGVkIHRhaWwgKi8KCXZhciBDb250aW51b3VzVGFpbERldGFpbHMgPQoJLyojX19QVVJFX18qLwoJZnVuY3Rpb24gKCkgewoJICAvKiogVGFpbCB2YWx1ZSBhcyBzdHJpbmcgKi8KCgkgIC8qKiBUYWlsIHN0YXJ0IHBvc2l0aW9uICovCgoJICAvKiogU3RhcnQgcG9zaXRpb24gKi8KCSAgZnVuY3Rpb24gQ29udGludW91c1RhaWxEZXRhaWxzKCkgewoJICAgIHZhciB2YWx1ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogJyc7CgkgICAgdmFyIGZyb20gPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IDA7CgkgICAgdmFyIHN0b3AgPSBhcmd1bWVudHMubGVuZ3RoID4gMiA/IGFyZ3VtZW50c1syXSA6IHVuZGVmaW5lZDsKCgkgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENvbnRpbnVvdXNUYWlsRGV0YWlscyk7CgoJICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKCSAgICB0aGlzLmZyb20gPSBmcm9tOwoJICAgIHRoaXMuc3RvcCA9IHN0b3A7CgkgIH0KCgkgIF9jcmVhdGVDbGFzcyhDb250aW51b3VzVGFpbERldGFpbHMsIFt7CgkgICAga2V5OiAidG9TdHJpbmciLAoJICAgIHZhbHVlOiBmdW5jdGlvbiB0b1N0cmluZygpIHsKCSAgICAgIHJldHVybiB0aGlzLnZhbHVlOwoJICAgIH0KCSAgfSwgewoJICAgIGtleTogImV4dGVuZCIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGV4dGVuZCh0YWlsKSB7CgkgICAgICB0aGlzLnZhbHVlICs9IFN0cmluZyh0YWlsKTsKCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICJhcHBlbmRUbyIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGFwcGVuZFRvKG1hc2tlZCkgewoJICAgICAgcmV0dXJuIG1hc2tlZC5hcHBlbmQodGhpcy50b1N0cmluZygpLCB7CgkgICAgICAgIHRhaWw6IHRydWUKCSAgICAgIH0pLmFnZ3JlZ2F0ZShtYXNrZWQuX2FwcGVuZFBsYWNlaG9sZGVyKCkpOwoJICAgIH0KCSAgfSwgewoJICAgIGtleTogInNoaWZ0QmVmb3JlIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gc2hpZnRCZWZvcmUocG9zKSB7CgkgICAgICBpZiAodGhpcy5mcm9tID49IHBvcyB8fCAhdGhpcy52YWx1ZS5sZW5ndGgpIHJldHVybiAnJzsKCSAgICAgIHZhciBzaGlmdENoYXIgPSB0aGlzLnZhbHVlWzBdOwoJICAgICAgdGhpcy52YWx1ZSA9IHRoaXMudmFsdWUuc2xpY2UoMSk7CgkgICAgICByZXR1cm4gc2hpZnRDaGFyOwoJICAgIH0KCSAgfSwgewoJICAgIGtleTogInN0YXRlIiwKCSAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCSAgICAgIHJldHVybiB7CgkgICAgICAgIHZhbHVlOiB0aGlzLnZhbHVlLAoJICAgICAgICBmcm9tOiB0aGlzLmZyb20sCgkgICAgICAgIHN0b3A6IHRoaXMuc3RvcAoJICAgICAgfTsKCSAgICB9LAoJICAgIHNldDogZnVuY3Rpb24gc2V0KHN0YXRlKSB7CgkgICAgICBPYmplY3QuYXNzaWduKHRoaXMsIHN0YXRlKTsKCSAgICB9CgkgIH1dKTsKCgkgIHJldHVybiBDb250aW51b3VzVGFpbERldGFpbHM7Cgl9KCk7CgoJLyoqCgkgKiBBcHBsaWVzIG1hc2sgb24gZWxlbWVudC4KCSAqIEBjb25zdHJ1Y3RvcgoJICogQHBhcmFtIHtIVE1MSW5wdXRFbGVtZW50fEhUTUxUZXh0QXJlYUVsZW1lbnR8TWFza0VsZW1lbnR9IGVsIC0gRWxlbWVudCB0byBhcHBseSBtYXNrCgkgKiBAcGFyYW0ge09iamVjdH0gb3B0cyAtIEN1c3RvbSBtYXNrIG9wdGlvbnMKCSAqIEByZXR1cm4ge0lucHV0TWFza30KCSAqLwoJZnVuY3Rpb24gSU1hc2soZWwpIHsKCSAgdmFyIG9wdHMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwoJICAvLyBjdXJyZW50bHkgYXZhaWxhYmxlIG9ubHkgZm9yIGlucHV0LWxpa2UgZWxlbWVudHMKCSAgcmV0dXJuIG5ldyBJTWFzay5JbnB1dE1hc2soZWwsIG9wdHMpOwoJfQoKCS8qKiBTdXBwb3J0ZWQgbWFzayB0eXBlICovCgoJLyoqIFByb3ZpZGVzIGNvbW1vbiBtYXNraW5nIHN0dWZmICovCgl2YXIgTWFza2VkID0KCS8qI19fUFVSRV9fKi8KCWZ1bmN0aW9uICgpIHsKCSAgLy8gJFNoYXBlPE1hc2tlZE9wdGlvbnM+OyBUT0RPIGFmdGVyIGZpeCBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svZmxvdy9pc3N1ZXMvNDc3MwoKCSAgLyoqIEB0eXBlIHtNYXNrfSAqLwoKCSAgLyoqICovCgkgIC8vICRGbG93Rml4TWUgbm8gaWRlYXMKCgkgIC8qKiBUcmFuc2Zvcm1zIHZhbHVlIGJlZm9yZSBtYXNrIHByb2Nlc3NpbmcgKi8KCgkgIC8qKiBWYWxpZGF0ZXMgaWYgdmFsdWUgaXMgYWNjZXB0YWJsZSAqLwoKCSAgLyoqIERvZXMgYWRkaXRpb25hbCBwcm9jZXNzaW5nIGluIHRoZSBlbmQgb2YgZWRpdGluZyAqLwoKCSAgLyoqIEZvcm1hdCB0eXBlZCB2YWx1ZSB0byBzdHJpbmcgKi8KCgkgIC8qKiBQYXJzZSBzdHJnaW4gdG8gZ2V0IHR5cGVkIHZhbHVlICovCgoJICAvKiogRW5hYmxlIGNoYXJhY3RlcnMgb3ZlcndyaXRpbmcgKi8KCgkgIC8qKiAqLwoJICBmdW5jdGlvbiBNYXNrZWQob3B0cykgewoJICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBNYXNrZWQpOwoKCSAgICB0aGlzLl92YWx1ZSA9ICcnOwoKCSAgICB0aGlzLl91cGRhdGUoT2JqZWN0LmFzc2lnbih7fSwgTWFza2VkLkRFRkFVTFRTLCB7fSwgb3B0cykpOwoKCSAgICB0aGlzLmlzSW5pdGlhbGl6ZWQgPSB0cnVlOwoJICB9CgkgIC8qKiBTZXRzIGFuZCBhcHBsaWVzIG5ldyBvcHRpb25zICovCgoKCSAgX2NyZWF0ZUNsYXNzKE1hc2tlZCwgW3sKCSAgICBrZXk6ICJ1cGRhdGVPcHRpb25zIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlT3B0aW9ucyhvcHRzKSB7CgkgICAgICBpZiAoIU9iamVjdC5rZXlzKG9wdHMpLmxlbmd0aCkgcmV0dXJuOwoJICAgICAgdGhpcy53aXRoVmFsdWVSZWZyZXNoKHRoaXMuX3VwZGF0ZS5iaW5kKHRoaXMsIG9wdHMpKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICBTZXRzIG5ldyBvcHRpb25zCgkgICAgICBAcHJvdGVjdGVkCgkgICAgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJfdXBkYXRlIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gX3VwZGF0ZShvcHRzKSB7CgkgICAgICBPYmplY3QuYXNzaWduKHRoaXMsIG9wdHMpOwoJICAgIH0KCSAgICAvKiogTWFzayBzdGF0ZSAqLwoKCSAgfSwgewoJICAgIGtleTogInJlc2V0IiwKCgkgICAgLyoqIFJlc2V0cyB2YWx1ZSAqLwoJICAgIHZhbHVlOiBmdW5jdGlvbiByZXNldCgpIHsKCSAgICAgIHRoaXMuX3ZhbHVlID0gJyc7CgkgICAgfQoJICAgIC8qKiAqLwoKCSAgfSwgewoJICAgIGtleTogInJlc29sdmUiLAoKCSAgICAvKiogUmVzb2x2ZSBuZXcgdmFsdWUgKi8KCSAgICB2YWx1ZTogZnVuY3Rpb24gcmVzb2x2ZSh2YWx1ZSkgewoJICAgICAgdGhpcy5yZXNldCgpOwoJICAgICAgdGhpcy5hcHBlbmQodmFsdWUsIHsKCSAgICAgICAgaW5wdXQ6IHRydWUKCSAgICAgIH0sICcnKTsKCSAgICAgIHRoaXMuZG9Db21taXQoKTsKCSAgICAgIHJldHVybiB0aGlzLnZhbHVlOwoJICAgIH0KCSAgICAvKiogKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJuZWFyZXN0SW5wdXRQb3MiLAoKCSAgICAvKiogRmluZHMgbmVhcmVzdCBpbnB1dCBwb3NpdGlvbiBpbiBkaXJlY3Rpb24gKi8KCSAgICB2YWx1ZTogZnVuY3Rpb24gbmVhcmVzdElucHV0UG9zKGN1cnNvclBvcywgZGlyZWN0aW9uKSB7CgkgICAgICByZXR1cm4gY3Vyc29yUG9zOwoJICAgIH0KCSAgICAvKiogRXh0cmFjdHMgdmFsdWUgaW4gcmFuZ2UgY29uc2lkZXJpbmcgZmxhZ3MgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJleHRyYWN0SW5wdXQiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBleHRyYWN0SW5wdXQoKSB7CgkgICAgICB2YXIgZnJvbVBvcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogMDsKCSAgICAgIHZhciB0b1BvcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogdGhpcy52YWx1ZS5sZW5ndGg7CgkgICAgICByZXR1cm4gdGhpcy52YWx1ZS5zbGljZShmcm9tUG9zLCB0b1Bvcyk7CgkgICAgfQoJICAgIC8qKiBFeHRyYWN0cyB0YWlsIGluIHJhbmdlICovCgoJICB9LCB7CgkgICAga2V5OiAiZXh0cmFjdFRhaWwiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBleHRyYWN0VGFpbCgpIHsKCSAgICAgIHZhciBmcm9tUG9zID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAwOwoJICAgICAgdmFyIHRvUG9zID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB0aGlzLnZhbHVlLmxlbmd0aDsKCSAgICAgIHJldHVybiBuZXcgQ29udGludW91c1RhaWxEZXRhaWxzKHRoaXMuZXh0cmFjdElucHV0KGZyb21Qb3MsIHRvUG9zKSwgZnJvbVBvcyk7CgkgICAgfQoJICAgIC8qKiBBcHBlbmRzIHRhaWwgKi8KCSAgICAvLyAkRmxvd0ZpeE1lIG5vIGlkZWFzCgoJICB9LCB7CgkgICAga2V5OiAiYXBwZW5kVGFpbCIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGFwcGVuZFRhaWwodGFpbCkgewoJICAgICAgaWYgKGlzU3RyaW5nKHRhaWwpKSB0YWlsID0gbmV3IENvbnRpbnVvdXNUYWlsRGV0YWlscyhTdHJpbmcodGFpbCkpOwoJICAgICAgcmV0dXJuIHRhaWwuYXBwZW5kVG8odGhpcyk7CgkgICAgfQoJICAgIC8qKiBBcHBlbmRzIGNoYXIgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJfYXBwZW5kQ2hhclJhdyIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIF9hcHBlbmRDaGFyUmF3KGNoKSB7CgkgICAgICB2YXIgZmxhZ3MgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwoJICAgICAgY2ggPSB0aGlzLmRvUHJlcGFyZShjaCwgZmxhZ3MpOwoJICAgICAgaWYgKCFjaCkgcmV0dXJuIG5ldyBDaGFuZ2VEZXRhaWxzKCk7CgkgICAgICB0aGlzLl92YWx1ZSArPSBjaDsKCSAgICAgIHJldHVybiBuZXcgQ2hhbmdlRGV0YWlscyh7CgkgICAgICAgIGluc2VydGVkOiBjaCwKCSAgICAgICAgcmF3SW5zZXJ0ZWQ6IGNoCgkgICAgICB9KTsKCSAgICB9CgkgICAgLyoqIEFwcGVuZHMgY2hhciAqLwoKCSAgfSwgewoJICAgIGtleTogIl9hcHBlbmRDaGFyIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gX2FwcGVuZENoYXIoY2gpIHsKCSAgICAgIHZhciBmbGFncyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CgkgICAgICB2YXIgY2hlY2tUYWlsID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgPyBhcmd1bWVudHNbMl0gOiB1bmRlZmluZWQ7CgkgICAgICB2YXIgY29uc2lzdGVudFN0YXRlID0gdGhpcy5zdGF0ZTsKCgkgICAgICB2YXIgZGV0YWlscyA9IHRoaXMuX2FwcGVuZENoYXJSYXcoY2gsIGZsYWdzKTsKCgkgICAgICBpZiAoZGV0YWlscy5pbnNlcnRlZCkgewoJICAgICAgICB2YXIgY29uc2lzdGVudFRhaWw7CgkgICAgICAgIHZhciBhcHBlbmRlZCA9IHRoaXMuZG9WYWxpZGF0ZShmbGFncykgIT09IGZhbHNlOwoKCSAgICAgICAgaWYgKGFwcGVuZGVkICYmIGNoZWNrVGFpbCAhPSBudWxsKSB7CgkgICAgICAgICAgLy8gdmFsaWRhdGlvbiBvaywgY2hlY2sgdGFpbAoJICAgICAgICAgIHZhciBiZWZvcmVUYWlsU3RhdGUgPSB0aGlzLnN0YXRlOwoKCSAgICAgICAgICBpZiAodGhpcy5vdmVyd3JpdGUpIHsKCSAgICAgICAgICAgIGNvbnNpc3RlbnRUYWlsID0gY2hlY2tUYWlsLnN0YXRlOwoJICAgICAgICAgICAgY2hlY2tUYWlsLnNoaWZ0QmVmb3JlKHRoaXMudmFsdWUubGVuZ3RoKTsKCSAgICAgICAgICB9CgoJICAgICAgICAgIHZhciB0YWlsRGV0YWlscyA9IHRoaXMuYXBwZW5kVGFpbChjaGVja1RhaWwpOwoJICAgICAgICAgIGFwcGVuZGVkID0gdGFpbERldGFpbHMucmF3SW5zZXJ0ZWQgPT09IGNoZWNrVGFpbC50b1N0cmluZygpOyAvLyBpZiBvaywgcm9sbGJhY2sgc3RhdGUgYWZ0ZXIgdGFpbAoKCSAgICAgICAgICBpZiAoYXBwZW5kZWQgJiYgdGFpbERldGFpbHMuaW5zZXJ0ZWQpIHRoaXMuc3RhdGUgPSBiZWZvcmVUYWlsU3RhdGU7CgkgICAgICAgIH0gLy8gcmV2ZXJ0IGFsbCBpZiBzb21ldGhpbmcgd2VudCB3cm9uZwoKCgkgICAgICAgIGlmICghYXBwZW5kZWQpIHsKCSAgICAgICAgICBkZXRhaWxzID0gbmV3IENoYW5nZURldGFpbHMoKTsKCSAgICAgICAgICB0aGlzLnN0YXRlID0gY29uc2lzdGVudFN0YXRlOwoJICAgICAgICAgIGlmIChjaGVja1RhaWwgJiYgY29uc2lzdGVudFRhaWwpIGNoZWNrVGFpbC5zdGF0ZSA9IGNvbnNpc3RlbnRUYWlsOwoJICAgICAgICB9CgkgICAgICB9CgoJICAgICAgcmV0dXJuIGRldGFpbHM7CgkgICAgfQoJICAgIC8qKiBBcHBlbmRzIG9wdGlvbmFsIHBsYWNlaG9sZGVyIGF0IGVuZCAqLwoKCSAgfSwgewoJICAgIGtleTogIl9hcHBlbmRQbGFjZWhvbGRlciIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIF9hcHBlbmRQbGFjZWhvbGRlcigpIHsKCSAgICAgIHJldHVybiBuZXcgQ2hhbmdlRGV0YWlscygpOwoJICAgIH0KCSAgICAvKiogQXBwZW5kcyBzeW1ib2xzIGNvbnNpZGVyaW5nIGZsYWdzICovCgkgICAgLy8gJEZsb3dGaXhNZSBubyBpZGVhcwoKCSAgfSwgewoJICAgIGtleTogImFwcGVuZCIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGFwcGVuZChzdHIsIGZsYWdzLCB0YWlsKSB7CgkgICAgICBpZiAoIWlzU3RyaW5nKHN0cikpIHRocm93IG5ldyBFcnJvcigndmFsdWUgc2hvdWxkIGJlIHN0cmluZycpOwoJICAgICAgdmFyIGRldGFpbHMgPSBuZXcgQ2hhbmdlRGV0YWlscygpOwoJICAgICAgdmFyIGNoZWNrVGFpbCA9IGlzU3RyaW5nKHRhaWwpID8gbmV3IENvbnRpbnVvdXNUYWlsRGV0YWlscyhTdHJpbmcodGFpbCkpIDogdGFpbDsKCSAgICAgIGlmIChmbGFncy50YWlsKSBmbGFncy5fYmVmb3JlVGFpbFN0YXRlID0gdGhpcy5zdGF0ZTsKCgkgICAgICBmb3IgKHZhciBjaSA9IDA7IGNpIDwgc3RyLmxlbmd0aDsgKytjaSkgewoJICAgICAgICBkZXRhaWxzLmFnZ3JlZ2F0ZSh0aGlzLl9hcHBlbmRDaGFyKHN0cltjaV0sIGZsYWdzLCBjaGVja1RhaWwpKTsKCSAgICAgIH0gLy8gYXBwZW5kIHRhaWwgYnV0IGFnZ3JlZ2F0ZSBvbmx5IHRhaWxTaGlmdAoKCgkgICAgICBpZiAoY2hlY2tUYWlsICE9IG51bGwpIHsKCSAgICAgICAgZGV0YWlscy50YWlsU2hpZnQgKz0gdGhpcy5hcHBlbmRUYWlsKGNoZWNrVGFpbCkudGFpbFNoaWZ0OyAvLyBUT0RPIGl0J3MgYSBnb29kIGlkZWEgdG8gY2xlYXIgc3RhdGUgYWZ0ZXIgYXBwZW5kaW5nIGVuZHMKCSAgICAgICAgLy8gYnV0IGl0IGNhdXNlcyBidWdzIHdoZW4gb25lIGFwcGVuZCBjYWxscyBhbm90aGVyICh3aGVuIGR5bmFtaWMgZGlzcGF0Y2ggc2V0IHJhd0lucHV0VmFsdWUpCgkgICAgICAgIC8vIHRoaXMuX3Jlc2V0QmVmb3JlVGFpbFN0YXRlKCk7CgkgICAgICB9CgoJICAgICAgcmV0dXJuIGRldGFpbHM7CgkgICAgfQoJICAgIC8qKiAqLwoKCSAgfSwgewoJICAgIGtleTogInJlbW92ZSIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZSgpIHsKCSAgICAgIHZhciBmcm9tUG9zID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAwOwoJICAgICAgdmFyIHRvUG9zID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB0aGlzLnZhbHVlLmxlbmd0aDsKCSAgICAgIHRoaXMuX3ZhbHVlID0gdGhpcy52YWx1ZS5zbGljZSgwLCBmcm9tUG9zKSArIHRoaXMudmFsdWUuc2xpY2UodG9Qb3MpOwoJICAgICAgcmV0dXJuIG5ldyBDaGFuZ2VEZXRhaWxzKCk7CgkgICAgfQoJICAgIC8qKiBDYWxscyBmdW5jdGlvbiBhbmQgcmVhcHBsaWVzIGN1cnJlbnQgdmFsdWUgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJ3aXRoVmFsdWVSZWZyZXNoIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gd2l0aFZhbHVlUmVmcmVzaChmbikgewoJICAgICAgaWYgKHRoaXMuX3JlZnJlc2hpbmcgfHwgIXRoaXMuaXNJbml0aWFsaXplZCkgcmV0dXJuIGZuKCk7CgkgICAgICB0aGlzLl9yZWZyZXNoaW5nID0gdHJ1ZTsKCSAgICAgIHZhciByYXdJbnB1dCA9IHRoaXMucmF3SW5wdXRWYWx1ZTsKCSAgICAgIHZhciB2YWx1ZSA9IHRoaXMudmFsdWU7CgkgICAgICB2YXIgcmV0ID0gZm4oKTsKCSAgICAgIHRoaXMucmF3SW5wdXRWYWx1ZSA9IHJhd0lucHV0OyAvLyBhcHBlbmQgbG9zdCB0cmFpbGluZyBjaGFycyBhdCBlbmQKCgkgICAgICBpZiAodGhpcy52YWx1ZSAhPT0gdmFsdWUgJiYgdmFsdWUuaW5kZXhPZih0aGlzLnZhbHVlKSA9PT0gMCkgewoJICAgICAgICB0aGlzLmFwcGVuZCh2YWx1ZS5zbGljZSh0aGlzLnZhbHVlLmxlbmd0aCksIHt9LCAnJyk7CgkgICAgICB9CgoJICAgICAgZGVsZXRlIHRoaXMuX3JlZnJlc2hpbmc7CgkgICAgICByZXR1cm4gcmV0OwoJICAgIH0KCSAgICAvKiogKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJydW5Jc29sYXRlZCIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIHJ1bklzb2xhdGVkKGZuKSB7CgkgICAgICBpZiAodGhpcy5faXNvbGF0ZWQgfHwgIXRoaXMuaXNJbml0aWFsaXplZCkgcmV0dXJuIGZuKHRoaXMpOwoJICAgICAgdGhpcy5faXNvbGF0ZWQgPSB0cnVlOwoJICAgICAgdmFyIHN0YXRlID0gdGhpcy5zdGF0ZTsKCSAgICAgIHZhciByZXQgPSBmbih0aGlzKTsKCSAgICAgIHRoaXMuc3RhdGUgPSBzdGF0ZTsKCSAgICAgIGRlbGV0ZSB0aGlzLl9pc29sYXRlZDsKCSAgICAgIHJldHVybiByZXQ7CgkgICAgfQoJICAgIC8qKgoJICAgICAgUHJlcGFyZXMgc3RyaW5nIGJlZm9yZSBtYXNrIHByb2Nlc3NpbmcKCSAgICAgIEBwcm90ZWN0ZWQKCSAgICAqLwoKCSAgfSwgewoJICAgIGtleTogImRvUHJlcGFyZSIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGRvUHJlcGFyZShzdHIpIHsKCSAgICAgIHZhciBmbGFncyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CgkgICAgICByZXR1cm4gdGhpcy5wcmVwYXJlID8gdGhpcy5wcmVwYXJlKHN0ciwgdGhpcywgZmxhZ3MpIDogc3RyOwoJICAgIH0KCSAgICAvKioKCSAgICAgIFZhbGlkYXRlcyBpZiB2YWx1ZSBpcyBhY2NlcHRhYmxlCgkgICAgICBAcHJvdGVjdGVkCgkgICAgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJkb1ZhbGlkYXRlIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gZG9WYWxpZGF0ZShmbGFncykgewoJICAgICAgcmV0dXJuICghdGhpcy52YWxpZGF0ZSB8fCB0aGlzLnZhbGlkYXRlKHRoaXMudmFsdWUsIHRoaXMsIGZsYWdzKSkgJiYgKCF0aGlzLnBhcmVudCB8fCB0aGlzLnBhcmVudC5kb1ZhbGlkYXRlKGZsYWdzKSk7CgkgICAgfQoJICAgIC8qKgoJICAgICAgRG9lcyBhZGRpdGlvbmFsIHByb2Nlc3NpbmcgaW4gdGhlIGVuZCBvZiBlZGl0aW5nCgkgICAgICBAcHJvdGVjdGVkCgkgICAgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJkb0NvbW1pdCIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGRvQ29tbWl0KCkgewoJICAgICAgaWYgKHRoaXMuY29tbWl0KSB0aGlzLmNvbW1pdCh0aGlzLnZhbHVlLCB0aGlzKTsKCSAgICB9CgkgICAgLyoqICovCgoJICB9LCB7CgkgICAga2V5OiAiZG9Gb3JtYXQiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBkb0Zvcm1hdCh2YWx1ZSkgewoJICAgICAgcmV0dXJuIHRoaXMuZm9ybWF0ID8gdGhpcy5mb3JtYXQodmFsdWUsIHRoaXMpIDogdmFsdWU7CgkgICAgfQoJICAgIC8qKiAqLwoKCSAgfSwgewoJICAgIGtleTogImRvUGFyc2UiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBkb1BhcnNlKHN0cikgewoJICAgICAgcmV0dXJuIHRoaXMucGFyc2UgPyB0aGlzLnBhcnNlKHN0ciwgdGhpcykgOiBzdHI7CgkgICAgfQoJICAgIC8qKiAqLwoKCSAgfSwgewoJICAgIGtleTogInNwbGljZSIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIHNwbGljZShzdGFydCwgZGVsZXRlQ291bnQsIGluc2VydGVkLCByZW1vdmVEaXJlY3Rpb24pIHsKCSAgICAgIHZhciB0YWlsUG9zID0gc3RhcnQgKyBkZWxldGVDb3VudDsKCSAgICAgIHZhciB0YWlsID0gdGhpcy5leHRyYWN0VGFpbCh0YWlsUG9zKTsKCSAgICAgIHZhciBzdGFydENoYW5nZVBvcyA9IHRoaXMubmVhcmVzdElucHV0UG9zKHN0YXJ0LCByZW1vdmVEaXJlY3Rpb24pOwoJICAgICAgdmFyIGNoYW5nZURldGFpbHMgPSBuZXcgQ2hhbmdlRGV0YWlscyh7CgkgICAgICAgIHRhaWxTaGlmdDogc3RhcnRDaGFuZ2VQb3MgLSBzdGFydCAvLyBhZGp1c3QgdGFpbFNoaWZ0IGlmIHN0YXJ0IHdhcyBhbGlnbmVkCgoJICAgICAgfSkuYWdncmVnYXRlKHRoaXMucmVtb3ZlKHN0YXJ0Q2hhbmdlUG9zKSkuYWdncmVnYXRlKHRoaXMuYXBwZW5kKGluc2VydGVkLCB7CgkgICAgICAgIGlucHV0OiB0cnVlCgkgICAgICB9LCB0YWlsKSk7CgkgICAgICByZXR1cm4gY2hhbmdlRGV0YWlsczsKCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICJzdGF0ZSIsCgkgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkgICAgICByZXR1cm4gewoJICAgICAgICBfdmFsdWU6IHRoaXMudmFsdWUKCSAgICAgIH07CgkgICAgfSwKCSAgICBzZXQ6IGZ1bmN0aW9uIHNldChzdGF0ZSkgewoJICAgICAgdGhpcy5fdmFsdWUgPSBzdGF0ZS5fdmFsdWU7CgkgICAgfQoJICB9LCB7CgkgICAga2V5OiAidmFsdWUiLAoJICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewoJICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlOwoJICAgIH0sCgkgICAgc2V0OiBmdW5jdGlvbiBzZXQodmFsdWUpIHsKCSAgICAgIHRoaXMucmVzb2x2ZSh2YWx1ZSk7CgkgICAgfQoJICB9LCB7CgkgICAga2V5OiAidW5tYXNrZWRWYWx1ZSIsCgkgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkgICAgICByZXR1cm4gdGhpcy52YWx1ZTsKCSAgICB9LAoJICAgIHNldDogZnVuY3Rpb24gc2V0KHZhbHVlKSB7CgkgICAgICB0aGlzLnJlc2V0KCk7CgkgICAgICB0aGlzLmFwcGVuZCh2YWx1ZSwge30sICcnKTsKCSAgICAgIHRoaXMuZG9Db21taXQoKTsKCSAgICB9CgkgICAgLyoqICovCgoJICB9LCB7CgkgICAga2V5OiAidHlwZWRWYWx1ZSIsCgkgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkgICAgICByZXR1cm4gdGhpcy5kb1BhcnNlKHRoaXMudmFsdWUpOwoJICAgIH0sCgkgICAgc2V0OiBmdW5jdGlvbiBzZXQodmFsdWUpIHsKCSAgICAgIHRoaXMudmFsdWUgPSB0aGlzLmRvRm9ybWF0KHZhbHVlKTsKCSAgICB9CgkgICAgLyoqIFZhbHVlIHRoYXQgaW5jbHVkZXMgcmF3IHVzZXIgaW5wdXQgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJyYXdJbnB1dFZhbHVlIiwKCSAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCSAgICAgIHJldHVybiB0aGlzLmV4dHJhY3RJbnB1dCgwLCB0aGlzLnZhbHVlLmxlbmd0aCwgewoJICAgICAgICByYXc6IHRydWUKCSAgICAgIH0pOwoJICAgIH0sCgkgICAgc2V0OiBmdW5jdGlvbiBzZXQodmFsdWUpIHsKCSAgICAgIHRoaXMucmVzZXQoKTsKCSAgICAgIHRoaXMuYXBwZW5kKHZhbHVlLCB7CgkgICAgICAgIHJhdzogdHJ1ZQoJICAgICAgfSwgJycpOwoJICAgICAgdGhpcy5kb0NvbW1pdCgpOwoJICAgIH0KCSAgICAvKiogKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJpc0NvbXBsZXRlIiwKCSAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCSAgICAgIHJldHVybiB0cnVlOwoJICAgIH0KCSAgfV0pOwoKCSAgcmV0dXJuIE1hc2tlZDsKCX0oKTsKCU1hc2tlZC5ERUZBVUxUUyA9IHsKCSAgZm9ybWF0OiBmdW5jdGlvbiBmb3JtYXQodikgewoJICAgIHJldHVybiB2OwoJICB9LAoJICBwYXJzZTogZnVuY3Rpb24gcGFyc2UodikgewoJICAgIHJldHVybiB2OwoJICB9Cgl9OwoJSU1hc2suTWFza2VkID0gTWFza2VkOwoKCS8qKiBHZXQgTWFza2VkIGNsYXNzIGJ5IG1hc2sgdHlwZSAqLwoKCWZ1bmN0aW9uIG1hc2tlZENsYXNzKG1hc2spIHsKCSAgaWYgKG1hc2sgPT0gbnVsbCkgewoJICAgIHRocm93IG5ldyBFcnJvcignbWFzayBwcm9wZXJ0eSBzaG91bGQgYmUgZGVmaW5lZCcpOwoJICB9IC8vICRGbG93Rml4TWUKCgoJICBpZiAobWFzayBpbnN0YW5jZW9mIFJlZ0V4cCkgcmV0dXJuIElNYXNrLk1hc2tlZFJlZ0V4cDsgLy8gJEZsb3dGaXhNZQoKCSAgaWYgKGlzU3RyaW5nKG1hc2spKSByZXR1cm4gSU1hc2suTWFza2VkUGF0dGVybjsgLy8gJEZsb3dGaXhNZQoKCSAgaWYgKG1hc2sgaW5zdGFuY2VvZiBEYXRlIHx8IG1hc2sgPT09IERhdGUpIHJldHVybiBJTWFzay5NYXNrZWREYXRlOyAvLyAkRmxvd0ZpeE1lCgoJICBpZiAobWFzayBpbnN0YW5jZW9mIE51bWJlciB8fCB0eXBlb2YgbWFzayA9PT0gJ251bWJlcicgfHwgbWFzayA9PT0gTnVtYmVyKSByZXR1cm4gSU1hc2suTWFza2VkTnVtYmVyOyAvLyAkRmxvd0ZpeE1lCgoJICBpZiAoQXJyYXkuaXNBcnJheShtYXNrKSB8fCBtYXNrID09PSBBcnJheSkgcmV0dXJuIElNYXNrLk1hc2tlZER5bmFtaWM7IC8vICRGbG93Rml4TWUKCgkgIGlmIChJTWFzay5NYXNrZWQgJiYgbWFzay5wcm90b3R5cGUgaW5zdGFuY2VvZiBJTWFzay5NYXNrZWQpIHJldHVybiBtYXNrOyAvLyAkRmxvd0ZpeE1lCgoJICBpZiAobWFzayBpbnN0YW5jZW9mIEZ1bmN0aW9uKSByZXR1cm4gSU1hc2suTWFza2VkRnVuY3Rpb247IC8vICRGbG93Rml4TWUKCgkgIGlmIChtYXNrIGluc3RhbmNlb2YgSU1hc2suTWFza2VkKSByZXR1cm4gbWFzay5jb25zdHJ1Y3RvcjsKCSAgY29uc29sZS53YXJuKCdNYXNrIG5vdCBmb3VuZCBmb3IgbWFzaycsIG1hc2spOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKCSAgLy8gJEZsb3dGaXhNZQoKCSAgcmV0dXJuIElNYXNrLk1hc2tlZDsKCX0KCS8qKiBDcmVhdGVzIG5ldyB7QGxpbmsgTWFza2VkfSBkZXBlbmRpbmcgb24gbWFzayB0eXBlICovCgoJZnVuY3Rpb24gY3JlYXRlTWFzayhvcHRzKSB7CgkgIC8vICRGbG93Rml4TWUKCSAgaWYgKElNYXNrLk1hc2tlZCAmJiBvcHRzIGluc3RhbmNlb2YgSU1hc2suTWFza2VkKSByZXR1cm4gb3B0czsKCSAgb3B0cyA9IE9iamVjdC5hc3NpZ24oe30sIG9wdHMpOwoJICB2YXIgbWFzayA9IG9wdHMubWFzazsgLy8gJEZsb3dGaXhNZQoKCSAgaWYgKElNYXNrLk1hc2tlZCAmJiBtYXNrIGluc3RhbmNlb2YgSU1hc2suTWFza2VkKSByZXR1cm4gbWFzazsKCSAgdmFyIE1hc2tlZENsYXNzID0gbWFza2VkQ2xhc3MobWFzayk7CgkgIGlmICghTWFza2VkQ2xhc3MpIHRocm93IG5ldyBFcnJvcignTWFza2VkIGNsYXNzIGlzIG5vdCBmb3VuZCBmb3IgcHJvdmlkZWQgbWFzaywgYXBwcm9wcmlhdGUgbW9kdWxlIG5lZWRzIHRvIGJlIGltcG9ydCBtYW51YWxseSBiZWZvcmUgY3JlYXRpbmcgbWFzay4nKTsKCSAgcmV0dXJuIG5ldyBNYXNrZWRDbGFzcyhvcHRzKTsKCX0KCUlNYXNrLmNyZWF0ZU1hc2sgPSBjcmVhdGVNYXNrOwoKCXZhciBERUZBVUxUX0lOUFVUX0RFRklOSVRJT05TID0gewoJICAnMCc6IC9cZC8sCgkgICdhJzogL1tcdTAwNDEtXHUwMDVBXHUwMDYxLVx1MDA3QVx1MDBBQVx1MDBCNVx1MDBCQVx1MDBDMC1cdTAwRDZcdTAwRDgtXHUwMEY2XHUwMEY4LVx1MDJDMVx1MDJDNi1cdTAyRDFcdTAyRTAtXHUwMkU0XHUwMkVDXHUwMkVFXHUwMzcwLVx1MDM3NFx1MDM3Nlx1MDM3N1x1MDM3QS1cdTAzN0RcdTAzODZcdTAzODgtXHUwMzhBXHUwMzhDXHUwMzhFLVx1MDNBMVx1MDNBMy1cdTAzRjVcdTAzRjctXHUwNDgxXHUwNDhBLVx1MDUyN1x1MDUzMS1cdTA1NTZcdTA1NTlcdTA1NjEtXHUwNTg3XHUwNUQwLVx1MDVFQVx1MDVGMC1cdTA1RjJcdTA2MjAtXHUwNjRBXHUwNjZFXHUwNjZGXHUwNjcxLVx1MDZEM1x1MDZENVx1MDZFNVx1MDZFNlx1MDZFRVx1MDZFRlx1MDZGQS1cdTA2RkNcdTA2RkZcdTA3MTBcdTA3MTItXHUwNzJGXHUwNzRELVx1MDdBNVx1MDdCMVx1MDdDQS1cdTA3RUFcdTA3RjRcdTA3RjVcdTA3RkFcdTA4MDAtXHUwODE1XHUwODFBXHUwODI0XHUwODI4XHUwODQwLVx1MDg1OFx1MDhBMFx1MDhBMi1cdTA4QUNcdTA5MDQtXHUwOTM5XHUwOTNEXHUwOTUwXHUwOTU4LVx1MDk2MVx1MDk3MS1cdTA5NzdcdTA5NzktXHUwOTdGXHUwOTg1LVx1MDk4Q1x1MDk4Rlx1MDk5MFx1MDk5My1cdTA5QThcdTA5QUEtXHUwOUIwXHUwOUIyXHUwOUI2LVx1MDlCOVx1MDlCRFx1MDlDRVx1MDlEQ1x1MDlERFx1MDlERi1cdTA5RTFcdTA5RjBcdTA5RjFcdTBBMDUtXHUwQTBBXHUwQTBGXHUwQTEwXHUwQTEzLVx1MEEyOFx1MEEyQS1cdTBBMzBcdTBBMzJcdTBBMzNcdTBBMzVcdTBBMzZcdTBBMzhcdTBBMzlcdTBBNTktXHUwQTVDXHUwQTVFXHUwQTcyLVx1MEE3NFx1MEE4NS1cdTBBOERcdTBBOEYtXHUwQTkxXHUwQTkzLVx1MEFBOFx1MEFBQS1cdTBBQjBcdTBBQjJcdTBBQjNcdTBBQjUtXHUwQUI5XHUwQUJEXHUwQUQwXHUwQUUwXHUwQUUxXHUwQjA1LVx1MEIwQ1x1MEIwRlx1MEIxMFx1MEIxMy1cdTBCMjhcdTBCMkEtXHUwQjMwXHUwQjMyXHUwQjMzXHUwQjM1LVx1MEIzOVx1MEIzRFx1MEI1Q1x1MEI1RFx1MEI1Ri1cdTBCNjFcdTBCNzFcdTBCODNcdTBCODUtXHUwQjhBXHUwQjhFLVx1MEI5MFx1MEI5Mi1cdTBCOTVcdTBCOTlcdTBCOUFcdTBCOUNcdTBCOUVcdTBCOUZcdTBCQTNcdTBCQTRcdTBCQTgtXHUwQkFBXHUwQkFFLVx1MEJCOVx1MEJEMFx1MEMwNS1cdTBDMENcdTBDMEUtXHUwQzEwXHUwQzEyLVx1MEMyOFx1MEMyQS1cdTBDMzNcdTBDMzUtXHUwQzM5XHUwQzNEXHUwQzU4XHUwQzU5XHUwQzYwXHUwQzYxXHUwQzg1LVx1MEM4Q1x1MEM4RS1cdTBDOTBcdTBDOTItXHUwQ0E4XHUwQ0FBLVx1MENCM1x1MENCNS1cdTBDQjlcdTBDQkRcdTBDREVcdTBDRTBcdTBDRTFcdTBDRjFcdTBDRjJcdTBEMDUtXHUwRDBDXHUwRDBFLVx1MEQxMFx1MEQxMi1cdTBEM0FcdTBEM0RcdTBENEVcdTBENjBcdTBENjFcdTBEN0EtXHUwRDdGXHUwRDg1LVx1MEQ5Nlx1MEQ5QS1cdTBEQjFcdTBEQjMtXHUwREJCXHUwREJEXHUwREMwLVx1MERDNlx1MEUwMS1cdTBFMzBcdTBFMzJcdTBFMzNcdTBFNDAtXHUwRTQ2XHUwRTgxXHUwRTgyXHUwRTg0XHUwRTg3XHUwRTg4XHUwRThBXHUwRThEXHUwRTk0LVx1MEU5N1x1MEU5OS1cdTBFOUZcdTBFQTEtXHUwRUEzXHUwRUE1XHUwRUE3XHUwRUFBXHUwRUFCXHUwRUFELVx1MEVCMFx1MEVCMlx1MEVCM1x1MEVCRFx1MEVDMC1cdTBFQzRcdTBFQzZcdTBFREMtXHUwRURGXHUwRjAwXHUwRjQwLVx1MEY0N1x1MEY0OS1cdTBGNkNcdTBGODgtXHUwRjhDXHUxMDAwLVx1MTAyQVx1MTAzRlx1MTA1MC1cdTEwNTVcdTEwNUEtXHUxMDVEXHUxMDYxXHUxMDY1XHUxMDY2XHUxMDZFLVx1MTA3MFx1MTA3NS1cdTEwODFcdTEwOEVcdTEwQTAtXHUxMEM1XHUxMEM3XHUxMENEXHUxMEQwLVx1MTBGQVx1MTBGQy1cdTEyNDhcdTEyNEEtXHUxMjREXHUxMjUwLVx1MTI1Nlx1MTI1OFx1MTI1QS1cdTEyNURcdTEyNjAtXHUxMjg4XHUxMjhBLVx1MTI4RFx1MTI5MC1cdTEyQjBcdTEyQjItXHUxMkI1XHUxMkI4LVx1MTJCRVx1MTJDMFx1MTJDMi1cdTEyQzVcdTEyQzgtXHUxMkQ2XHUxMkQ4LVx1MTMxMFx1MTMxMi1cdTEzMTVcdTEzMTgtXHUxMzVBXHUxMzgwLVx1MTM4Rlx1MTNBMC1cdTEzRjRcdTE0MDEtXHUxNjZDXHUxNjZGLVx1MTY3Rlx1MTY4MS1cdTE2OUFcdTE2QTAtXHUxNkVBXHUxNzAwLVx1MTcwQ1x1MTcwRS1cdTE3MTFcdTE3MjAtXHUxNzMxXHUxNzQwLVx1MTc1MVx1MTc2MC1cdTE3NkNcdTE3NkUtXHUxNzcwXHUxNzgwLVx1MTdCM1x1MTdEN1x1MTdEQ1x1MTgyMC1cdTE4NzdcdTE4ODAtXHUxOEE4XHUxOEFBXHUxOEIwLVx1MThGNVx1MTkwMC1cdTE5MUNcdTE5NTAtXHUxOTZEXHUxOTcwLVx1MTk3NFx1MTk4MC1cdTE5QUJcdTE5QzEtXHUxOUM3XHUxQTAwLVx1MUExNlx1MUEyMC1cdTFBNTRcdTFBQTdcdTFCMDUtXHUxQjMzXHUxQjQ1LVx1MUI0Qlx1MUI4My1cdTFCQTBcdTFCQUVcdTFCQUZcdTFCQkEtXHUxQkU1XHUxQzAwLVx1MUMyM1x1MUM0RC1cdTFDNEZcdTFDNUEtXHUxQzdEXHUxQ0U5LVx1MUNFQ1x1MUNFRS1cdTFDRjFcdTFDRjVcdTFDRjZcdTFEMDAtXHUxREJGXHUxRTAwLVx1MUYxNVx1MUYxOC1cdTFGMURcdTFGMjAtXHUxRjQ1XHUxRjQ4LVx1MUY0RFx1MUY1MC1cdTFGNTdcdTFGNTlcdTFGNUJcdTFGNURcdTFGNUYtXHUxRjdEXHUxRjgwLVx1MUZCNFx1MUZCNi1cdTFGQkNcdTFGQkVcdTFGQzItXHUxRkM0XHUxRkM2LVx1MUZDQ1x1MUZEMC1cdTFGRDNcdTFGRDYtXHUxRkRCXHUxRkUwLVx1MUZFQ1x1MUZGMi1cdTFGRjRcdTFGRjYtXHUxRkZDXHUyMDcxXHUyMDdGXHUyMDkwLVx1MjA5Q1x1MjEwMlx1MjEwN1x1MjEwQS1cdTIxMTNcdTIxMTVcdTIxMTktXHUyMTFEXHUyMTI0XHUyMTI2XHUyMTI4XHUyMTJBLVx1MjEyRFx1MjEyRi1cdTIxMzlcdTIxM0MtXHUyMTNGXHUyMTQ1LVx1MjE0OVx1MjE0RVx1MjE4M1x1MjE4NFx1MkMwMC1cdTJDMkVcdTJDMzAtXHUyQzVFXHUyQzYwLVx1MkNFNFx1MkNFQi1cdTJDRUVcdTJDRjJcdTJDRjNcdTJEMDAtXHUyRDI1XHUyRDI3XHUyRDJEXHUyRDMwLVx1MkQ2N1x1MkQ2Rlx1MkQ4MC1cdTJEOTZcdTJEQTAtXHUyREE2XHUyREE4LVx1MkRBRVx1MkRCMC1cdTJEQjZcdTJEQjgtXHUyREJFXHUyREMwLVx1MkRDNlx1MkRDOC1cdTJEQ0VcdTJERDAtXHUyREQ2XHUyREQ4LVx1MkRERVx1MkUyRlx1MzAwNVx1MzAwNlx1MzAzMS1cdTMwMzVcdTMwM0JcdTMwM0NcdTMwNDEtXHUzMDk2XHUzMDlELVx1MzA5Rlx1MzBBMS1cdTMwRkFcdTMwRkMtXHUzMEZGXHUzMTA1LVx1MzEyRFx1MzEzMS1cdTMxOEVcdTMxQTAtXHUzMUJBXHUzMUYwLVx1MzFGRlx1MzQwMC1cdTREQjVcdTRFMDAtXHU5RkNDXHVBMDAwLVx1QTQ4Q1x1QTREMC1cdUE0RkRcdUE1MDAtXHVBNjBDXHVBNjEwLVx1QTYxRlx1QTYyQVx1QTYyQlx1QTY0MC1cdUE2NkVcdUE2N0YtXHVBNjk3XHVBNkEwLVx1QTZFNVx1QTcxNy1cdUE3MUZcdUE3MjItXHVBNzg4XHVBNzhCLVx1QTc4RVx1QTc5MC1cdUE3OTNcdUE3QTAtXHVBN0FBXHVBN0Y4LVx1QTgwMVx1QTgwMy1cdUE4MDVcdUE4MDctXHVBODBBXHVBODBDLVx1QTgyMlx1QTg0MC1cdUE4NzNcdUE4ODItXHVBOEIzXHVBOEYyLVx1QThGN1x1QThGQlx1QTkwQS1cdUE5MjVcdUE5MzAtXHVBOTQ2XHVBOTYwLVx1QTk3Q1x1QTk4NC1cdUE5QjJcdUE5Q0ZcdUFBMDAtXHVBQTI4XHVBQTQwLVx1QUE0Mlx1QUE0NC1cdUFBNEJcdUFBNjAtXHVBQTc2XHVBQTdBXHVBQTgwLVx1QUFBRlx1QUFCMVx1QUFCNVx1QUFCNlx1QUFCOS1cdUFBQkRcdUFBQzBcdUFBQzJcdUFBREItXHVBQUREXHVBQUUwLVx1QUFFQVx1QUFGMi1cdUFBRjRcdUFCMDEtXHVBQjA2XHVBQjA5LVx1QUIwRVx1QUIxMS1cdUFCMTZcdUFCMjAtXHVBQjI2XHVBQjI4LVx1QUIyRVx1QUJDMC1cdUFCRTJcdUFDMDAtXHVEN0EzXHVEN0IwLVx1RDdDNlx1RDdDQi1cdUQ3RkJcdUY5MDAtXHVGQTZEXHVGQTcwLVx1RkFEOVx1RkIwMC1cdUZCMDZcdUZCMTMtXHVGQjE3XHVGQjFEXHVGQjFGLVx1RkIyOFx1RkIyQS1cdUZCMzZcdUZCMzgtXHVGQjNDXHVGQjNFXHVGQjQwXHVGQjQxXHVGQjQzXHVGQjQ0XHVGQjQ2LVx1RkJCMVx1RkJEMy1cdUZEM0RcdUZENTAtXHVGRDhGXHVGRDkyLVx1RkRDN1x1RkRGMC1cdUZERkJcdUZFNzAtXHVGRTc0XHVGRTc2LVx1RkVGQ1x1RkYyMS1cdUZGM0FcdUZGNDEtXHVGRjVBXHVGRjY2LVx1RkZCRVx1RkZDMi1cdUZGQzdcdUZGQ0EtXHVGRkNGXHVGRkQyLVx1RkZEN1x1RkZEQS1cdUZGRENdLywKCSAgLy8gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL2EvMjIwNzUwNzAKCSAgJyonOiAvLi8KCX07CgkvKiogKi8KCgl2YXIgUGF0dGVybklucHV0RGVmaW5pdGlvbiA9CgkvKiNfX1BVUkVfXyovCglmdW5jdGlvbiAoKSB7CgkgIC8qKiAqLwoKCSAgLyoqICovCgoJICAvKiogKi8KCgkgIC8qKiAqLwoKCSAgLyoqICovCgoJICAvKiogKi8KCSAgZnVuY3Rpb24gUGF0dGVybklucHV0RGVmaW5pdGlvbihvcHRzKSB7CgkgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFBhdHRlcm5JbnB1dERlZmluaXRpb24pOwoKCSAgICB2YXIgbWFzayA9IG9wdHMubWFzaywKCSAgICAgICAgYmxvY2tPcHRzID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKG9wdHMsIFsibWFzayJdKTsKCgkgICAgdGhpcy5tYXNrZWQgPSBjcmVhdGVNYXNrKHsKCSAgICAgIG1hc2s6IG1hc2sKCSAgICB9KTsKCSAgICBPYmplY3QuYXNzaWduKHRoaXMsIGJsb2NrT3B0cyk7CgkgIH0KCgkgIF9jcmVhdGVDbGFzcyhQYXR0ZXJuSW5wdXREZWZpbml0aW9uLCBbewoJICAgIGtleTogInJlc2V0IiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gcmVzZXQoKSB7CgkgICAgICB0aGlzLl9pc0ZpbGxlZCA9IGZhbHNlOwoJICAgICAgdGhpcy5tYXNrZWQucmVzZXQoKTsKCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICJyZW1vdmUiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmUoKSB7CgkgICAgICB2YXIgZnJvbVBvcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogMDsKCSAgICAgIHZhciB0b1BvcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogdGhpcy52YWx1ZS5sZW5ndGg7CgoJICAgICAgaWYgKGZyb21Qb3MgPT09IDAgJiYgdG9Qb3MgPj0gMSkgewoJICAgICAgICB0aGlzLl9pc0ZpbGxlZCA9IGZhbHNlOwoJICAgICAgICByZXR1cm4gdGhpcy5tYXNrZWQucmVtb3ZlKGZyb21Qb3MsIHRvUG9zKTsKCSAgICAgIH0KCgkgICAgICByZXR1cm4gbmV3IENoYW5nZURldGFpbHMoKTsKCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICJfYXBwZW5kQ2hhciIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIF9hcHBlbmRDaGFyKHN0cikgewoJICAgICAgdmFyIGZsYWdzID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsKCSAgICAgIGlmICh0aGlzLl9pc0ZpbGxlZCkgcmV0dXJuIG5ldyBDaGFuZ2VEZXRhaWxzKCk7CgkgICAgICB2YXIgc3RhdGUgPSB0aGlzLm1hc2tlZC5zdGF0ZTsgLy8gc2ltdWxhdGUgaW5wdXQKCgkgICAgICB2YXIgZGV0YWlscyA9IHRoaXMubWFza2VkLl9hcHBlbmRDaGFyKHN0ciwgZmxhZ3MpOwoKCSAgICAgIGlmIChkZXRhaWxzLmluc2VydGVkICYmIHRoaXMuZG9WYWxpZGF0ZShmbGFncykgPT09IGZhbHNlKSB7CgkgICAgICAgIGRldGFpbHMuaW5zZXJ0ZWQgPSBkZXRhaWxzLnJhd0luc2VydGVkID0gJyc7CgkgICAgICAgIHRoaXMubWFza2VkLnN0YXRlID0gc3RhdGU7CgkgICAgICB9CgoJICAgICAgaWYgKCFkZXRhaWxzLmluc2VydGVkICYmICF0aGlzLmlzT3B0aW9uYWwgJiYgIXRoaXMubGF6eSAmJiAhZmxhZ3MuaW5wdXQpIHsKCSAgICAgICAgZGV0YWlscy5pbnNlcnRlZCA9IHRoaXMucGxhY2Vob2xkZXJDaGFyOwoJICAgICAgfQoKCSAgICAgIGRldGFpbHMuc2tpcCA9ICFkZXRhaWxzLmluc2VydGVkICYmICF0aGlzLmlzT3B0aW9uYWw7CgkgICAgICB0aGlzLl9pc0ZpbGxlZCA9IEJvb2xlYW4oZGV0YWlscy5pbnNlcnRlZCk7CgkgICAgICByZXR1cm4gZGV0YWlsczsKCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICJhcHBlbmQiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBhcHBlbmQoKSB7CgkgICAgICB2YXIgX3RoaXMkbWFza2VkOwoKCSAgICAgIHJldHVybiAoX3RoaXMkbWFza2VkID0gdGhpcy5tYXNrZWQpLmFwcGVuZC5hcHBseShfdGhpcyRtYXNrZWQsIGFyZ3VtZW50cyk7CgkgICAgfQoJICB9LCB7CgkgICAga2V5OiAiX2FwcGVuZFBsYWNlaG9sZGVyIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gX2FwcGVuZFBsYWNlaG9sZGVyKCkgewoJICAgICAgdmFyIGRldGFpbHMgPSBuZXcgQ2hhbmdlRGV0YWlscygpOwoJICAgICAgaWYgKHRoaXMuX2lzRmlsbGVkIHx8IHRoaXMuaXNPcHRpb25hbCkgcmV0dXJuIGRldGFpbHM7CgkgICAgICB0aGlzLl9pc0ZpbGxlZCA9IHRydWU7CgkgICAgICBkZXRhaWxzLmluc2VydGVkID0gdGhpcy5wbGFjZWhvbGRlckNoYXI7CgkgICAgICByZXR1cm4gZGV0YWlsczsKCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICJleHRyYWN0VGFpbCIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGV4dHJhY3RUYWlsKCkgewoJICAgICAgdmFyIF90aGlzJG1hc2tlZDI7CgoJICAgICAgcmV0dXJuIChfdGhpcyRtYXNrZWQyID0gdGhpcy5tYXNrZWQpLmV4dHJhY3RUYWlsLmFwcGx5KF90aGlzJG1hc2tlZDIsIGFyZ3VtZW50cyk7CgkgICAgfQoJICB9LCB7CgkgICAga2V5OiAiYXBwZW5kVGFpbCIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGFwcGVuZFRhaWwoKSB7CgkgICAgICB2YXIgX3RoaXMkbWFza2VkMzsKCgkgICAgICByZXR1cm4gKF90aGlzJG1hc2tlZDMgPSB0aGlzLm1hc2tlZCkuYXBwZW5kVGFpbC5hcHBseShfdGhpcyRtYXNrZWQzLCBhcmd1bWVudHMpOwoJICAgIH0KCSAgfSwgewoJICAgIGtleTogImV4dHJhY3RJbnB1dCIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGV4dHJhY3RJbnB1dCgpIHsKCSAgICAgIHZhciBmcm9tUG9zID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAwOwoJICAgICAgdmFyIHRvUG9zID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB0aGlzLnZhbHVlLmxlbmd0aDsKCSAgICAgIHZhciBmbGFncyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyID8gYXJndW1lbnRzWzJdIDogdW5kZWZpbmVkOwoJICAgICAgcmV0dXJuIHRoaXMubWFza2VkLmV4dHJhY3RJbnB1dChmcm9tUG9zLCB0b1BvcywgZmxhZ3MpOwoJICAgIH0KCSAgfSwgewoJICAgIGtleTogIm5lYXJlc3RJbnB1dFBvcyIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIG5lYXJlc3RJbnB1dFBvcyhjdXJzb3JQb3MpIHsKCSAgICAgIHZhciBkaXJlY3Rpb24gPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IERJUkVDVElPTi5OT05FOwoJICAgICAgdmFyIG1pblBvcyA9IDA7CgkgICAgICB2YXIgbWF4UG9zID0gdGhpcy52YWx1ZS5sZW5ndGg7CgkgICAgICB2YXIgYm91bmRQb3MgPSBNYXRoLm1pbihNYXRoLm1heChjdXJzb3JQb3MsIG1pblBvcyksIG1heFBvcyk7CgoJICAgICAgc3dpdGNoIChkaXJlY3Rpb24pIHsKCSAgICAgICAgY2FzZSBESVJFQ1RJT04uTEVGVDoKCSAgICAgICAgY2FzZSBESVJFQ1RJT04uRk9SQ0VfTEVGVDoKCSAgICAgICAgICByZXR1cm4gdGhpcy5pc0NvbXBsZXRlID8gYm91bmRQb3MgOiBtaW5Qb3M7CgoJICAgICAgICBjYXNlIERJUkVDVElPTi5SSUdIVDoKCSAgICAgICAgY2FzZSBESVJFQ1RJT04uRk9SQ0VfUklHSFQ6CgkgICAgICAgICAgcmV0dXJuIHRoaXMuaXNDb21wbGV0ZSA/IGJvdW5kUG9zIDogbWF4UG9zOwoKCSAgICAgICAgY2FzZSBESVJFQ1RJT04uTk9ORToKCSAgICAgICAgZGVmYXVsdDoKCSAgICAgICAgICByZXR1cm4gYm91bmRQb3M7CgkgICAgICB9CgkgICAgfQoJICB9LCB7CgkgICAga2V5OiAiZG9WYWxpZGF0ZSIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGRvVmFsaWRhdGUoKSB7CgkgICAgICB2YXIgX3RoaXMkbWFza2VkNCwgX3RoaXMkcGFyZW50OwoKCSAgICAgIHJldHVybiAoX3RoaXMkbWFza2VkNCA9IHRoaXMubWFza2VkKS5kb1ZhbGlkYXRlLmFwcGx5KF90aGlzJG1hc2tlZDQsIGFyZ3VtZW50cykgJiYgKCF0aGlzLnBhcmVudCB8fCAoX3RoaXMkcGFyZW50ID0gdGhpcy5wYXJlbnQpLmRvVmFsaWRhdGUuYXBwbHkoX3RoaXMkcGFyZW50LCBhcmd1bWVudHMpKTsKCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICJkb0NvbW1pdCIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGRvQ29tbWl0KCkgewoJICAgICAgdGhpcy5tYXNrZWQuZG9Db21taXQoKTsKCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICJ2YWx1ZSIsCgkgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkgICAgICByZXR1cm4gdGhpcy5tYXNrZWQudmFsdWUgfHwgKHRoaXMuX2lzRmlsbGVkICYmICF0aGlzLmlzT3B0aW9uYWwgPyB0aGlzLnBsYWNlaG9sZGVyQ2hhciA6ICcnKTsKCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICJ1bm1hc2tlZFZhbHVlIiwKCSAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCSAgICAgIHJldHVybiB0aGlzLm1hc2tlZC51bm1hc2tlZFZhbHVlOwoJICAgIH0KCSAgfSwgewoJICAgIGtleTogImlzQ29tcGxldGUiLAoJICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewoJICAgICAgcmV0dXJuIEJvb2xlYW4odGhpcy5tYXNrZWQudmFsdWUpIHx8IHRoaXMuaXNPcHRpb25hbDsKCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICJzdGF0ZSIsCgkgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkgICAgICByZXR1cm4gewoJICAgICAgICBtYXNrZWQ6IHRoaXMubWFza2VkLnN0YXRlLAoJICAgICAgICBfaXNGaWxsZWQ6IHRoaXMuX2lzRmlsbGVkCgkgICAgICB9OwoJICAgIH0sCgkgICAgc2V0OiBmdW5jdGlvbiBzZXQoc3RhdGUpIHsKCSAgICAgIHRoaXMubWFza2VkLnN0YXRlID0gc3RhdGUubWFza2VkOwoJICAgICAgdGhpcy5faXNGaWxsZWQgPSBzdGF0ZS5faXNGaWxsZWQ7CgkgICAgfQoJICB9XSk7CgoJICByZXR1cm4gUGF0dGVybklucHV0RGVmaW5pdGlvbjsKCX0oKTsKCgl2YXIgUGF0dGVybkZpeGVkRGVmaW5pdGlvbiA9CgkvKiNfX1BVUkVfXyovCglmdW5jdGlvbiAoKSB7CgkgIC8qKiAqLwoKCSAgLyoqICovCgoJICAvKiogKi8KCgkgIC8qKiAqLwoJICBmdW5jdGlvbiBQYXR0ZXJuRml4ZWREZWZpbml0aW9uKG9wdHMpIHsKCSAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUGF0dGVybkZpeGVkRGVmaW5pdGlvbik7CgoJICAgIE9iamVjdC5hc3NpZ24odGhpcywgb3B0cyk7CgkgICAgdGhpcy5fdmFsdWUgPSAnJzsKCSAgfQoKCSAgX2NyZWF0ZUNsYXNzKFBhdHRlcm5GaXhlZERlZmluaXRpb24sIFt7CgkgICAga2V5OiAicmVzZXQiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiByZXNldCgpIHsKCSAgICAgIHRoaXMuX2lzUmF3SW5wdXQgPSBmYWxzZTsKCSAgICAgIHRoaXMuX3ZhbHVlID0gJyc7CgkgICAgfQoJICB9LCB7CgkgICAga2V5OiAicmVtb3ZlIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlKCkgewoJICAgICAgdmFyIGZyb21Qb3MgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IDA7CgkgICAgICB2YXIgdG9Qb3MgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHRoaXMuX3ZhbHVlLmxlbmd0aDsKCSAgICAgIHRoaXMuX3ZhbHVlID0gdGhpcy5fdmFsdWUuc2xpY2UoMCwgZnJvbVBvcykgKyB0aGlzLl92YWx1ZS5zbGljZSh0b1Bvcyk7CgkgICAgICBpZiAoIXRoaXMuX3ZhbHVlKSB0aGlzLl9pc1Jhd0lucHV0ID0gZmFsc2U7CgkgICAgICByZXR1cm4gbmV3IENoYW5nZURldGFpbHMoKTsKCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICJuZWFyZXN0SW5wdXRQb3MiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBuZWFyZXN0SW5wdXRQb3MoY3Vyc29yUG9zKSB7CgkgICAgICB2YXIgZGlyZWN0aW9uID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBESVJFQ1RJT04uTk9ORTsKCSAgICAgIHZhciBtaW5Qb3MgPSAwOwoJICAgICAgdmFyIG1heFBvcyA9IHRoaXMuX3ZhbHVlLmxlbmd0aDsKCgkgICAgICBzd2l0Y2ggKGRpcmVjdGlvbikgewoJICAgICAgICBjYXNlIERJUkVDVElPTi5MRUZUOgoJICAgICAgICBjYXNlIERJUkVDVElPTi5GT1JDRV9MRUZUOgoJICAgICAgICAgIHJldHVybiBtaW5Qb3M7CgoJICAgICAgICBjYXNlIERJUkVDVElPTi5OT05FOgoJICAgICAgICBjYXNlIERJUkVDVElPTi5SSUdIVDoKCSAgICAgICAgY2FzZSBESVJFQ1RJT04uRk9SQ0VfUklHSFQ6CgkgICAgICAgIGRlZmF1bHQ6CgkgICAgICAgICAgcmV0dXJuIG1heFBvczsKCSAgICAgIH0KCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICJleHRyYWN0SW5wdXQiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBleHRyYWN0SW5wdXQoKSB7CgkgICAgICB2YXIgZnJvbVBvcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogMDsKCSAgICAgIHZhciB0b1BvcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogdGhpcy5fdmFsdWUubGVuZ3RoOwoJICAgICAgdmFyIGZsYWdzID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiB7fTsKCSAgICAgIHJldHVybiBmbGFncy5yYXcgJiYgdGhpcy5faXNSYXdJbnB1dCAmJiB0aGlzLl92YWx1ZS5zbGljZShmcm9tUG9zLCB0b1BvcykgfHwgJyc7CgkgICAgfQoJICB9LCB7CgkgICAga2V5OiAiX2FwcGVuZENoYXIiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBfYXBwZW5kQ2hhcihzdHIpIHsKCSAgICAgIHZhciBmbGFncyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CgkgICAgICB2YXIgZGV0YWlscyA9IG5ldyBDaGFuZ2VEZXRhaWxzKCk7CgkgICAgICBpZiAodGhpcy5fdmFsdWUpIHJldHVybiBkZXRhaWxzOwoJICAgICAgdmFyIGFwcGVuZGVkID0gdGhpcy5jaGFyID09PSBzdHJbMF07CgkgICAgICB2YXIgaXNSZXNvbHZlZCA9IGFwcGVuZGVkICYmICh0aGlzLmlzVW5tYXNraW5nIHx8IGZsYWdzLmlucHV0IHx8IGZsYWdzLnJhdykgJiYgIWZsYWdzLnRhaWw7CgkgICAgICBpZiAoaXNSZXNvbHZlZCkgZGV0YWlscy5yYXdJbnNlcnRlZCA9IHRoaXMuY2hhcjsKCSAgICAgIHRoaXMuX3ZhbHVlID0gZGV0YWlscy5pbnNlcnRlZCA9IHRoaXMuY2hhcjsKCSAgICAgIHRoaXMuX2lzUmF3SW5wdXQgPSBpc1Jlc29sdmVkICYmIChmbGFncy5yYXcgfHwgZmxhZ3MuaW5wdXQpOwoJICAgICAgcmV0dXJuIGRldGFpbHM7CgkgICAgfQoJICB9LCB7CgkgICAga2V5OiAiX2FwcGVuZFBsYWNlaG9sZGVyIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gX2FwcGVuZFBsYWNlaG9sZGVyKCkgewoJICAgICAgdmFyIGRldGFpbHMgPSBuZXcgQ2hhbmdlRGV0YWlscygpOwoJICAgICAgaWYgKHRoaXMuX3ZhbHVlKSByZXR1cm4gZGV0YWlsczsKCSAgICAgIHRoaXMuX3ZhbHVlID0gZGV0YWlscy5pbnNlcnRlZCA9IHRoaXMuY2hhcjsKCSAgICAgIHJldHVybiBkZXRhaWxzOwoJICAgIH0KCSAgfSwgewoJICAgIGtleTogImV4dHJhY3RUYWlsIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gZXh0cmFjdFRhaWwoKSB7CgkgICAgICB2YXIgdG9Qb3MgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHRoaXMudmFsdWUubGVuZ3RoOwoJICAgICAgcmV0dXJuIG5ldyBDb250aW51b3VzVGFpbERldGFpbHMoJycpOwoJICAgIH0gLy8gJEZsb3dGaXhNZSBubyBpZGVhcwoKCSAgfSwgewoJICAgIGtleTogImFwcGVuZFRhaWwiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBhcHBlbmRUYWlsKHRhaWwpIHsKCSAgICAgIGlmIChpc1N0cmluZyh0YWlsKSkgdGFpbCA9IG5ldyBDb250aW51b3VzVGFpbERldGFpbHMoU3RyaW5nKHRhaWwpKTsKCSAgICAgIHJldHVybiB0YWlsLmFwcGVuZFRvKHRoaXMpOwoJICAgIH0KCSAgfSwgewoJICAgIGtleTogImFwcGVuZCIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGFwcGVuZChzdHIsIGZsYWdzLCB0YWlsKSB7CgkgICAgICB2YXIgZGV0YWlscyA9IHRoaXMuX2FwcGVuZENoYXIoc3RyLCBmbGFncyk7CgoJICAgICAgaWYgKHRhaWwgIT0gbnVsbCkgewoJICAgICAgICBkZXRhaWxzLnRhaWxTaGlmdCArPSB0aGlzLmFwcGVuZFRhaWwodGFpbCkudGFpbFNoaWZ0OwoJICAgICAgfQoKCSAgICAgIHJldHVybiBkZXRhaWxzOwoJICAgIH0KCSAgfSwgewoJICAgIGtleTogImRvQ29tbWl0IiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gZG9Db21taXQoKSB7fQoJICB9LCB7CgkgICAga2V5OiAidmFsdWUiLAoJICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewoJICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlOwoJICAgIH0KCSAgfSwgewoJICAgIGtleTogInVubWFza2VkVmFsdWUiLAoJICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewoJICAgICAgcmV0dXJuIHRoaXMuaXNVbm1hc2tpbmcgPyB0aGlzLnZhbHVlIDogJyc7CgkgICAgfQoJICB9LCB7CgkgICAga2V5OiAiaXNDb21wbGV0ZSIsCgkgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkgICAgICByZXR1cm4gdHJ1ZTsKCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICJzdGF0ZSIsCgkgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkgICAgICByZXR1cm4gewoJICAgICAgICBfdmFsdWU6IHRoaXMuX3ZhbHVlLAoJICAgICAgICBfaXNSYXdJbnB1dDogdGhpcy5faXNSYXdJbnB1dAoJICAgICAgfTsKCSAgICB9LAoJICAgIHNldDogZnVuY3Rpb24gc2V0KHN0YXRlKSB7CgkgICAgICBPYmplY3QuYXNzaWduKHRoaXMsIHN0YXRlKTsKCSAgICB9CgkgIH1dKTsKCgkgIHJldHVybiBQYXR0ZXJuRml4ZWREZWZpbml0aW9uOwoJfSgpOwoKCXZhciBDaHVua3NUYWlsRGV0YWlscyA9CgkvKiNfX1BVUkVfXyovCglmdW5jdGlvbiAoKSB7CgkgIC8qKiAqLwoJICBmdW5jdGlvbiBDaHVua3NUYWlsRGV0YWlscygpIHsKCSAgICB2YXIgY2h1bmtzID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBbXTsKCSAgICB2YXIgZnJvbSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogMDsKCgkgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENodW5rc1RhaWxEZXRhaWxzKTsKCgkgICAgdGhpcy5jaHVua3MgPSBjaHVua3M7CgkgICAgdGhpcy5mcm9tID0gZnJvbTsKCSAgfQoKCSAgX2NyZWF0ZUNsYXNzKENodW5rc1RhaWxEZXRhaWxzLCBbewoJICAgIGtleTogInRvU3RyaW5nIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gdG9TdHJpbmcoKSB7CgkgICAgICByZXR1cm4gdGhpcy5jaHVua3MubWFwKFN0cmluZykuam9pbignJyk7CgkgICAgfSAvLyAkRmxvd0ZpeE1lIG5vIGlkZWFzCgoJICB9LCB7CgkgICAga2V5OiAiZXh0ZW5kIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gZXh0ZW5kKHRhaWxDaHVuaykgewoJICAgICAgaWYgKCFTdHJpbmcodGFpbENodW5rKSkgcmV0dXJuOwoJICAgICAgaWYgKGlzU3RyaW5nKHRhaWxDaHVuaykpIHRhaWxDaHVuayA9IG5ldyBDb250aW51b3VzVGFpbERldGFpbHMoU3RyaW5nKHRhaWxDaHVuaykpOwoJICAgICAgdmFyIGxhc3RDaHVuayA9IHRoaXMuY2h1bmtzW3RoaXMuY2h1bmtzLmxlbmd0aCAtIDFdOwoJICAgICAgdmFyIGV4dGVuZExhc3QgPSBsYXN0Q2h1bmsgJiYgKCAvLyBpZiBzdG9wcyBhcmUgc2FtZSBvciB0YWlsIGhhcyBubyBzdG9wCgkgICAgICBsYXN0Q2h1bmsuc3RvcCA9PT0gdGFpbENodW5rLnN0b3AgfHwgdGFpbENodW5rLnN0b3AgPT0gbnVsbCkgJiYgLy8gaWYgdGFpbCBjaHVuayBnb2VzIGp1c3QgYWZ0ZXIgbGFzdCBjaHVuawoJICAgICAgdGFpbENodW5rLmZyb20gPT09IGxhc3RDaHVuay5mcm9tICsgbGFzdENodW5rLnRvU3RyaW5nKCkubGVuZ3RoOwoKCSAgICAgIGlmICh0YWlsQ2h1bmsgaW5zdGFuY2VvZiBDb250aW51b3VzVGFpbERldGFpbHMpIHsKCSAgICAgICAgLy8gY2hlY2sgdGhlIGFiaWxpdHkgdG8gZXh0ZW5kIHByZXZpb3VzIGNodW5rCgkgICAgICAgIGlmIChleHRlbmRMYXN0KSB7CgkgICAgICAgICAgLy8gZXh0ZW5kIHByZXZpb3VzIGNodW5rCgkgICAgICAgICAgbGFzdENodW5rLmV4dGVuZCh0YWlsQ2h1bmsudG9TdHJpbmcoKSk7CgkgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgLy8gYXBwZW5kIG5ldyBjaHVuawoJICAgICAgICAgIHRoaXMuY2h1bmtzLnB1c2godGFpbENodW5rKTsKCSAgICAgICAgfQoJICAgICAgfSBlbHNlIGlmICh0YWlsQ2h1bmsgaW5zdGFuY2VvZiBDaHVua3NUYWlsRGV0YWlscykgewoJICAgICAgICBpZiAodGFpbENodW5rLnN0b3AgPT0gbnVsbCkgewoJICAgICAgICAgIC8vIHVud3JhcCBmbG9hdGluZyBjaHVua3MgdG8gcGFyZW50LCBrZWVwaW5nIGBmcm9tYCBwb3MKCSAgICAgICAgICB2YXIgZmlyc3RUYWlsQ2h1bms7CgoJICAgICAgICAgIHdoaWxlICh0YWlsQ2h1bmsuY2h1bmtzLmxlbmd0aCAmJiB0YWlsQ2h1bmsuY2h1bmtzWzBdLnN0b3AgPT0gbnVsbCkgewoJICAgICAgICAgICAgZmlyc3RUYWlsQ2h1bmsgPSB0YWlsQ2h1bmsuY2h1bmtzLnNoaWZ0KCk7CgkgICAgICAgICAgICBmaXJzdFRhaWxDaHVuay5mcm9tICs9IHRhaWxDaHVuay5mcm9tOwoJICAgICAgICAgICAgdGhpcy5leHRlbmQoZmlyc3RUYWlsQ2h1bmspOwoJICAgICAgICAgIH0KCSAgICAgICAgfSAvLyBpZiB0YWlsIGNodW5rIHN0aWxsIGhhcyB2YWx1ZQoKCgkgICAgICAgIGlmICh0YWlsQ2h1bmsudG9TdHJpbmcoKSkgewoJICAgICAgICAgIC8vIGlmIGNodW5rcyBjb250YWlucyBzdG9wcywgdGhlbiBwb3B1cCBzdG9wIHRvIGNvbnRhaW5lcgoJICAgICAgICAgIHRhaWxDaHVuay5zdG9wID0gdGFpbENodW5rLmJsb2NrSW5kZXg7CgkgICAgICAgICAgdGhpcy5jaHVua3MucHVzaCh0YWlsQ2h1bmspOwoJICAgICAgICB9CgkgICAgICB9CgkgICAgfQoJICB9LCB7CgkgICAga2V5OiAiYXBwZW5kVG8iLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBhcHBlbmRUbyhtYXNrZWQpIHsKCSAgICAgIC8vICRGbG93Rml4TWUKCSAgICAgIGlmICghKG1hc2tlZCBpbnN0YW5jZW9mIElNYXNrLk1hc2tlZFBhdHRlcm4pKSB7CgkgICAgICAgIHZhciB0YWlsID0gbmV3IENvbnRpbnVvdXNUYWlsRGV0YWlscyh0aGlzLnRvU3RyaW5nKCkpOwoJICAgICAgICByZXR1cm4gdGFpbC5hcHBlbmRUbyhtYXNrZWQpOwoJICAgICAgfQoKCSAgICAgIHZhciBkZXRhaWxzID0gbmV3IENoYW5nZURldGFpbHMoKTsKCgkgICAgICBmb3IgKHZhciBjaSA9IDA7IGNpIDwgdGhpcy5jaHVua3MubGVuZ3RoICYmICFkZXRhaWxzLnNraXA7ICsrY2kpIHsKCSAgICAgICAgdmFyIGNodW5rID0gdGhpcy5jaHVua3NbY2ldOwoKCSAgICAgICAgdmFyIGxhc3RCbG9ja0l0ZXIgPSBtYXNrZWQuX21hcFBvc1RvQmxvY2sobWFza2VkLnZhbHVlLmxlbmd0aCk7CgoJICAgICAgICB2YXIgc3RvcCA9IGNodW5rLnN0b3A7CgkgICAgICAgIHZhciBjaHVua0Jsb2NrID0gdm9pZCAwOwoKCSAgICAgICAgaWYgKHN0b3AgIT0gbnVsbCAmJiAoIC8vIGlmIGJsb2NrIG5vdCBmb3VuZCBvciBzdG9wIGlzIGJlaGluZCBsYXN0QmxvY2sKCSAgICAgICAgIWxhc3RCbG9ja0l0ZXIgfHwgbGFzdEJsb2NrSXRlci5pbmRleCA8PSBzdG9wKSkgewoJICAgICAgICAgIGlmIChjaHVuayBpbnN0YW5jZW9mIENodW5rc1RhaWxEZXRhaWxzIHx8IC8vIGZvciBjb250aW51b3VzIGJsb2NrIGFsc28gY2hlY2sgaWYgc3RvcCBpcyBleGlzdAoJICAgICAgICAgIG1hc2tlZC5fc3RvcHMuaW5kZXhPZihzdG9wKSA+PSAwKSB7CgkgICAgICAgICAgICBkZXRhaWxzLmFnZ3JlZ2F0ZShtYXNrZWQuX2FwcGVuZFBsYWNlaG9sZGVyKHN0b3ApKTsKCSAgICAgICAgICB9CgoJICAgICAgICAgIGNodW5rQmxvY2sgPSBjaHVuayBpbnN0YW5jZW9mIENodW5rc1RhaWxEZXRhaWxzICYmIG1hc2tlZC5fYmxvY2tzW3N0b3BdOwoJICAgICAgICB9CgoJICAgICAgICBpZiAoY2h1bmtCbG9jaykgewoJICAgICAgICAgIHZhciB0YWlsRGV0YWlscyA9IGNodW5rQmxvY2suYXBwZW5kVGFpbChjaHVuayk7CgkgICAgICAgICAgdGFpbERldGFpbHMuc2tpcCA9IGZhbHNlOyAvLyBhbHdheXMgaWdub3JlIHNraXAsIGl0IHdpbGwgYmUgc2V0IG9uIGxhc3QKCgkgICAgICAgICAgZGV0YWlscy5hZ2dyZWdhdGUodGFpbERldGFpbHMpOwoJICAgICAgICAgIG1hc2tlZC5fdmFsdWUgKz0gdGFpbERldGFpbHMuaW5zZXJ0ZWQ7IC8vIGdldCBub3QgaW5zZXJ0ZWQgY2hhcnMKCgkgICAgICAgICAgdmFyIHJlbWFpbkNoYXJzID0gY2h1bmsudG9TdHJpbmcoKS5zbGljZSh0YWlsRGV0YWlscy5yYXdJbnNlcnRlZC5sZW5ndGgpOwoJICAgICAgICAgIGlmIChyZW1haW5DaGFycykgZGV0YWlscy5hZ2dyZWdhdGUobWFza2VkLmFwcGVuZChyZW1haW5DaGFycywgewoJICAgICAgICAgICAgdGFpbDogdHJ1ZQoJICAgICAgICAgIH0pKTsKCSAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICBkZXRhaWxzLmFnZ3JlZ2F0ZShtYXNrZWQuYXBwZW5kKGNodW5rLnRvU3RyaW5nKCksIHsKCSAgICAgICAgICAgIHRhaWw6IHRydWUKCSAgICAgICAgICB9KSk7CgkgICAgICAgIH0KCSAgICAgIH0KCSAgICAgIHJldHVybiBkZXRhaWxzOwoJICAgIH0KCSAgfSwgewoJICAgIGtleTogInNoaWZ0QmVmb3JlIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gc2hpZnRCZWZvcmUocG9zKSB7CgkgICAgICBpZiAodGhpcy5mcm9tID49IHBvcyB8fCAhdGhpcy5jaHVua3MubGVuZ3RoKSByZXR1cm4gJyc7CgkgICAgICB2YXIgY2h1bmtTaGlmdFBvcyA9IHBvcyAtIHRoaXMuZnJvbTsKCSAgICAgIHZhciBjaSA9IDA7CgoJICAgICAgd2hpbGUgKGNpIDwgdGhpcy5jaHVua3MubGVuZ3RoKSB7CgkgICAgICAgIHZhciBjaHVuayA9IHRoaXMuY2h1bmtzW2NpXTsKCSAgICAgICAgdmFyIHNoaWZ0Q2hhciA9IGNodW5rLnNoaWZ0QmVmb3JlKGNodW5rU2hpZnRQb3MpOwoKCSAgICAgICAgaWYgKGNodW5rLnRvU3RyaW5nKCkpIHsKCSAgICAgICAgICAvLyBjaHVuayBzdGlsbCBjb250YWlucyB2YWx1ZQoJICAgICAgICAgIC8vIGJ1dCBub3Qgc2hpZnRlZCAtIG1lYW5zIG5vIG1vcmUgYXZhaWxhYmxlIGNoYXJzIHRvIHNoaWZ0CgkgICAgICAgICAgaWYgKCFzaGlmdENoYXIpIGJyZWFrOwoJICAgICAgICAgICsrY2k7CgkgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgLy8gY2xlYW4gaWYgY2h1bmsgaGFzIG5vIHZhbHVlCgkgICAgICAgICAgdGhpcy5jaHVua3Muc3BsaWNlKGNpLCAxKTsKCSAgICAgICAgfQoKCSAgICAgICAgaWYgKHNoaWZ0Q2hhcikgcmV0dXJuIHNoaWZ0Q2hhcjsKCSAgICAgIH0KCgkgICAgICByZXR1cm4gJyc7CgkgICAgfQoJICB9LCB7CgkgICAga2V5OiAic3RhdGUiLAoJICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewoJICAgICAgcmV0dXJuIHsKCSAgICAgICAgY2h1bmtzOiB0aGlzLmNodW5rcy5tYXAoZnVuY3Rpb24gKGMpIHsKCSAgICAgICAgICByZXR1cm4gYy5zdGF0ZTsKCSAgICAgICAgfSksCgkgICAgICAgIGZyb206IHRoaXMuZnJvbSwKCSAgICAgICAgc3RvcDogdGhpcy5zdG9wLAoJICAgICAgICBibG9ja0luZGV4OiB0aGlzLmJsb2NrSW5kZXgKCSAgICAgIH07CgkgICAgfSwKCSAgICBzZXQ6IGZ1bmN0aW9uIHNldChzdGF0ZSkgewoJICAgICAgdmFyIGNodW5rcyA9IHN0YXRlLmNodW5rcywKCSAgICAgICAgICBwcm9wcyA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllcyhzdGF0ZSwgWyJjaHVua3MiXSk7CgoJICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLCBwcm9wcyk7CgkgICAgICB0aGlzLmNodW5rcyA9IGNodW5rcy5tYXAoZnVuY3Rpb24gKGNzdGF0ZSkgewoJICAgICAgICB2YXIgY2h1bmsgPSAiY2h1bmtzIiBpbiBjc3RhdGUgPyBuZXcgQ2h1bmtzVGFpbERldGFpbHMoKSA6IG5ldyBDb250aW51b3VzVGFpbERldGFpbHMoKTsgLy8gJEZsb3dGaXhNZSBhbHJlYWR5IGNoZWNrZWQgYWJvdmUKCgkgICAgICAgIGNodW5rLnN0YXRlID0gY3N0YXRlOwoJICAgICAgICByZXR1cm4gY2h1bms7CgkgICAgICB9KTsKCSAgICB9CgkgIH1dKTsKCgkgIHJldHVybiBDaHVua3NUYWlsRGV0YWlsczsKCX0oKTsKCgkvKiogTWFza2luZyBieSBSZWdFeHAgKi8KCgl2YXIgTWFza2VkUmVnRXhwID0KCS8qI19fUFVSRV9fKi8KCWZ1bmN0aW9uIChfTWFza2VkKSB7CgkgIF9pbmhlcml0cyhNYXNrZWRSZWdFeHAsIF9NYXNrZWQpOwoKCSAgZnVuY3Rpb24gTWFza2VkUmVnRXhwKCkgewoJICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBNYXNrZWRSZWdFeHApOwoKCSAgICByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKE1hc2tlZFJlZ0V4cCkuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CgkgIH0KCgkgIF9jcmVhdGVDbGFzcyhNYXNrZWRSZWdFeHAsIFt7CgkgICAga2V5OiAiX3VwZGF0ZSIsCgoJICAgIC8qKgoJICAgICAgQG92ZXJyaWRlCgkgICAgICBAcGFyYW0ge09iamVjdH0gb3B0cwoJICAgICovCgkgICAgdmFsdWU6IGZ1bmN0aW9uIF91cGRhdGUob3B0cykgewoJICAgICAgaWYgKG9wdHMubWFzaykgb3B0cy52YWxpZGF0ZSA9IGZ1bmN0aW9uICh2YWx1ZSkgewoJICAgICAgICByZXR1cm4gdmFsdWUuc2VhcmNoKG9wdHMubWFzaykgPj0gMDsKCSAgICAgIH07CgoJICAgICAgX2dldChfZ2V0UHJvdG90eXBlT2YoTWFza2VkUmVnRXhwLnByb3RvdHlwZSksICJfdXBkYXRlIiwgdGhpcykuY2FsbCh0aGlzLCBvcHRzKTsKCSAgICB9CgkgIH1dKTsKCgkgIHJldHVybiBNYXNrZWRSZWdFeHA7Cgl9KE1hc2tlZCk7CglJTWFzay5NYXNrZWRSZWdFeHAgPSBNYXNrZWRSZWdFeHA7CgoJLyoqCgkgIFBhdHRlcm4gbWFzawoJICBAcGFyYW0ge09iamVjdH0gb3B0cwoJICBAcGFyYW0ge09iamVjdH0gb3B0cy5ibG9ja3MKCSAgQHBhcmFtIHtPYmplY3R9IG9wdHMuZGVmaW5pdGlvbnMKCSAgQHBhcmFtIHtzdHJpbmd9IG9wdHMucGxhY2Vob2xkZXJDaGFyCgkgIEBwYXJhbSB7Ym9vbGVhbn0gb3B0cy5sYXp5CgkqLwoJdmFyIE1hc2tlZFBhdHRlcm4gPQoJLyojX19QVVJFX18qLwoJZnVuY3Rpb24gKF9NYXNrZWQpIHsKCSAgX2luaGVyaXRzKE1hc2tlZFBhdHRlcm4sIF9NYXNrZWQpOwoKCSAgLyoqICovCgoJICAvKiogKi8KCgkgIC8qKiBTaW5nbGUgY2hhciBmb3IgZW1wdHkgaW5wdXQgKi8KCgkgIC8qKiBTaG93IHBsYWNlaG9sZGVyIG9ubHkgd2hlbiBuZWVkZWQgKi8KCSAgZnVuY3Rpb24gTWFza2VkUGF0dGVybigpIHsKCSAgICB2YXIgb3B0cyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307CgoJICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBNYXNrZWRQYXR0ZXJuKTsKCgkgICAgLy8gVE9ETyB0eXBlICRTaGFwZTxNYXNrZWRQYXR0ZXJuT3B0aW9ucz49e30gZG9lcyBub3Qgd29yawoJICAgIG9wdHMuZGVmaW5pdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX0lOUFVUX0RFRklOSVRJT05TLCBvcHRzLmRlZmluaXRpb25zKTsKCSAgICByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKE1hc2tlZFBhdHRlcm4pLmNhbGwodGhpcywgT2JqZWN0LmFzc2lnbih7fSwgTWFza2VkUGF0dGVybi5ERUZBVUxUUywge30sIG9wdHMpKSk7CgkgIH0KCSAgLyoqCgkgICAgQG92ZXJyaWRlCgkgICAgQHBhcmFtIHtPYmplY3R9IG9wdHMKCSAgKi8KCgoJICBfY3JlYXRlQ2xhc3MoTWFza2VkUGF0dGVybiwgW3sKCSAgICBrZXk6ICJfdXBkYXRlIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gX3VwZGF0ZSgpIHsKCSAgICAgIHZhciBvcHRzID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKCSAgICAgIG9wdHMuZGVmaW5pdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmRlZmluaXRpb25zLCBvcHRzLmRlZmluaXRpb25zKTsKCgkgICAgICBfZ2V0KF9nZXRQcm90b3R5cGVPZihNYXNrZWRQYXR0ZXJuLnByb3RvdHlwZSksICJfdXBkYXRlIiwgdGhpcykuY2FsbCh0aGlzLCBvcHRzKTsKCgkgICAgICB0aGlzLl9yZWJ1aWxkTWFzaygpOwoJICAgIH0KCSAgICAvKiogKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJfcmVidWlsZE1hc2siLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVidWlsZE1hc2soKSB7CgkgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKCSAgICAgIHZhciBkZWZzID0gdGhpcy5kZWZpbml0aW9uczsKCSAgICAgIHRoaXMuX2Jsb2NrcyA9IFtdOwoJICAgICAgdGhpcy5fc3RvcHMgPSBbXTsKCSAgICAgIHRoaXMuX21hc2tlZEJsb2NrcyA9IHt9OwoJICAgICAgdmFyIHBhdHRlcm4gPSB0aGlzLm1hc2s7CgkgICAgICBpZiAoIXBhdHRlcm4gfHwgIWRlZnMpIHJldHVybjsKCSAgICAgIHZhciB1bm1hc2tpbmdCbG9jayA9IGZhbHNlOwoJICAgICAgdmFyIG9wdGlvbmFsQmxvY2sgPSBmYWxzZTsKCgkgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhdHRlcm4ubGVuZ3RoOyArK2kpIHsKCSAgICAgICAgaWYgKHRoaXMuYmxvY2tzKSB7CgkgICAgICAgICAgdmFyIF9yZXQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICB2YXIgcCA9IHBhdHRlcm4uc2xpY2UoaSk7CgkgICAgICAgICAgICB2YXIgYk5hbWVzID0gT2JqZWN0LmtleXMoX3RoaXMuYmxvY2tzKS5maWx0ZXIoZnVuY3Rpb24gKGJOYW1lKSB7CgkgICAgICAgICAgICAgIHJldHVybiBwLmluZGV4T2YoYk5hbWUpID09PSAwOwoJICAgICAgICAgICAgfSk7IC8vIG9yZGVyIGJ5IGtleSBsZW5ndGgKCgkgICAgICAgICAgICBiTmFtZXMuc29ydChmdW5jdGlvbiAoYSwgYikgewoJICAgICAgICAgICAgICByZXR1cm4gYi5sZW5ndGggLSBhLmxlbmd0aDsKCSAgICAgICAgICAgIH0pOyAvLyB1c2UgYmxvY2sgbmFtZSB3aXRoIG1heCBsZW5ndGgKCgkgICAgICAgICAgICB2YXIgYk5hbWUgPSBiTmFtZXNbMF07CgoJICAgICAgICAgICAgaWYgKGJOYW1lKSB7CgkgICAgICAgICAgICAgIHZhciBtYXNrZWRCbG9jayA9IGNyZWF0ZU1hc2soT2JqZWN0LmFzc2lnbih7CgkgICAgICAgICAgICAgICAgcGFyZW50OiBfdGhpcywKCSAgICAgICAgICAgICAgICBsYXp5OiBfdGhpcy5sYXp5LAoJICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyQ2hhcjogX3RoaXMucGxhY2Vob2xkZXJDaGFyLAoJICAgICAgICAgICAgICAgIG92ZXJ3cml0ZTogX3RoaXMub3ZlcndyaXRlCgkgICAgICAgICAgICAgIH0sIF90aGlzLmJsb2Nrc1tiTmFtZV0pKTsKCgkgICAgICAgICAgICAgIGlmIChtYXNrZWRCbG9jaykgewoJICAgICAgICAgICAgICAgIF90aGlzLl9ibG9ja3MucHVzaChtYXNrZWRCbG9jayk7IC8vIHN0b3JlIGJsb2NrIGluZGV4CgoKCSAgICAgICAgICAgICAgICBpZiAoIV90aGlzLl9tYXNrZWRCbG9ja3NbYk5hbWVdKSBfdGhpcy5fbWFza2VkQmxvY2tzW2JOYW1lXSA9IFtdOwoKCSAgICAgICAgICAgICAgICBfdGhpcy5fbWFza2VkQmxvY2tzW2JOYW1lXS5wdXNoKF90aGlzLl9ibG9ja3MubGVuZ3RoIC0gMSk7CgkgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgIGkgKz0gYk5hbWUubGVuZ3RoIC0gMTsKCSAgICAgICAgICAgICAgcmV0dXJuICJjb250aW51ZSI7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgfSgpOwoKCSAgICAgICAgICBpZiAoX3JldCA9PT0gImNvbnRpbnVlIikgY29udGludWU7CgkgICAgICAgIH0KCgkgICAgICAgIHZhciBjaGFyID0gcGF0dGVybltpXTsKCgkgICAgICAgIHZhciBfaXNJbnB1dCA9IGNoYXIgaW4gZGVmczsKCgkgICAgICAgIGlmIChjaGFyID09PSBNYXNrZWRQYXR0ZXJuLlNUT1BfQ0hBUikgewoJICAgICAgICAgIHRoaXMuX3N0b3BzLnB1c2godGhpcy5fYmxvY2tzLmxlbmd0aCk7CgoJICAgICAgICAgIGNvbnRpbnVlOwoJICAgICAgICB9CgoJICAgICAgICBpZiAoY2hhciA9PT0gJ3snIHx8IGNoYXIgPT09ICd9JykgewoJICAgICAgICAgIHVubWFza2luZ0Jsb2NrID0gIXVubWFza2luZ0Jsb2NrOwoJICAgICAgICAgIGNvbnRpbnVlOwoJICAgICAgICB9CgoJICAgICAgICBpZiAoY2hhciA9PT0gJ1snIHx8IGNoYXIgPT09ICddJykgewoJICAgICAgICAgIG9wdGlvbmFsQmxvY2sgPSAhb3B0aW9uYWxCbG9jazsKCSAgICAgICAgICBjb250aW51ZTsKCSAgICAgICAgfQoKCSAgICAgICAgaWYgKGNoYXIgPT09IE1hc2tlZFBhdHRlcm4uRVNDQVBFX0NIQVIpIHsKCSAgICAgICAgICArK2k7CgkgICAgICAgICAgY2hhciA9IHBhdHRlcm5baV07CgkgICAgICAgICAgaWYgKCFjaGFyKSBicmVhazsKCSAgICAgICAgICBfaXNJbnB1dCA9IGZhbHNlOwoJICAgICAgICB9CgoJICAgICAgICB2YXIgZGVmID0gX2lzSW5wdXQgPyBuZXcgUGF0dGVybklucHV0RGVmaW5pdGlvbih7CgkgICAgICAgICAgcGFyZW50OiB0aGlzLAoJICAgICAgICAgIGxhenk6IHRoaXMubGF6eSwKCSAgICAgICAgICBwbGFjZWhvbGRlckNoYXI6IHRoaXMucGxhY2Vob2xkZXJDaGFyLAoJICAgICAgICAgIG1hc2s6IGRlZnNbY2hhcl0sCgkgICAgICAgICAgaXNPcHRpb25hbDogb3B0aW9uYWxCbG9jawoJICAgICAgICB9KSA6IG5ldyBQYXR0ZXJuRml4ZWREZWZpbml0aW9uKHsKCSAgICAgICAgICBjaGFyOiBjaGFyLAoJICAgICAgICAgIGlzVW5tYXNraW5nOiB1bm1hc2tpbmdCbG9jawoJICAgICAgICB9KTsKCgkgICAgICAgIHRoaXMuX2Jsb2Nrcy5wdXNoKGRlZik7CgkgICAgICB9CgkgICAgfQoJICAgIC8qKgoJICAgICAgQG92ZXJyaWRlCgkgICAgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJyZXNldCIsCgoJICAgIC8qKgoJICAgICAgQG92ZXJyaWRlCgkgICAgKi8KCSAgICB2YWx1ZTogZnVuY3Rpb24gcmVzZXQoKSB7CgkgICAgICBfZ2V0KF9nZXRQcm90b3R5cGVPZihNYXNrZWRQYXR0ZXJuLnByb3RvdHlwZSksICJyZXNldCIsIHRoaXMpLmNhbGwodGhpcyk7CgoJICAgICAgdGhpcy5fYmxvY2tzLmZvckVhY2goZnVuY3Rpb24gKGIpIHsKCSAgICAgICAgcmV0dXJuIGIucmVzZXQoKTsKCSAgICAgIH0pOwoJICAgIH0KCSAgICAvKioKCSAgICAgIEBvdmVycmlkZQoJICAgICovCgoJICB9LCB7CgkgICAga2V5OiAiZG9Db21taXQiLAoKCSAgICAvKioKCSAgICAgIEBvdmVycmlkZQoJICAgICovCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGRvQ29tbWl0KCkgewoJICAgICAgdGhpcy5fYmxvY2tzLmZvckVhY2goZnVuY3Rpb24gKGIpIHsKCSAgICAgICAgcmV0dXJuIGIuZG9Db21taXQoKTsKCSAgICAgIH0pOwoKCSAgICAgIF9nZXQoX2dldFByb3RvdHlwZU9mKE1hc2tlZFBhdHRlcm4ucHJvdG90eXBlKSwgImRvQ29tbWl0IiwgdGhpcykuY2FsbCh0aGlzKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICBAb3ZlcnJpZGUKCSAgICAqLwoKCSAgfSwgewoJICAgIGtleTogImFwcGVuZFRhaWwiLAoKCSAgICAvKioKCSAgICAgIEBvdmVycmlkZQoJICAgICovCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGFwcGVuZFRhaWwodGFpbCkgewoJICAgICAgcmV0dXJuIF9nZXQoX2dldFByb3RvdHlwZU9mKE1hc2tlZFBhdHRlcm4ucHJvdG90eXBlKSwgImFwcGVuZFRhaWwiLCB0aGlzKS5jYWxsKHRoaXMsIHRhaWwpLmFnZ3JlZ2F0ZSh0aGlzLl9hcHBlbmRQbGFjZWhvbGRlcigpKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICBAb3ZlcnJpZGUKCSAgICAqLwoKCSAgfSwgewoJICAgIGtleTogIl9hcHBlbmRDaGFyUmF3IiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gX2FwcGVuZENoYXJSYXcoY2gpIHsKCSAgICAgIHZhciBmbGFncyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CgkgICAgICBjaCA9IHRoaXMuZG9QcmVwYXJlKGNoLCBmbGFncyk7CgoJICAgICAgdmFyIGJsb2NrSXRlciA9IHRoaXMuX21hcFBvc1RvQmxvY2sodGhpcy52YWx1ZS5sZW5ndGgpOwoKCSAgICAgIHZhciBkZXRhaWxzID0gbmV3IENoYW5nZURldGFpbHMoKTsKCSAgICAgIGlmICghYmxvY2tJdGVyKSByZXR1cm4gZGV0YWlsczsKCgkgICAgICBmb3IgKHZhciBiaSA9IGJsb2NrSXRlci5pbmRleDs7ICsrYmkpIHsKCSAgICAgICAgdmFyIF9ibG9jayA9IHRoaXMuX2Jsb2Nrc1tiaV07CgkgICAgICAgIGlmICghX2Jsb2NrKSBicmVhazsKCgkgICAgICAgIHZhciBibG9ja0RldGFpbHMgPSBfYmxvY2suX2FwcGVuZENoYXIoY2gsIGZsYWdzKTsKCgkgICAgICAgIHZhciBza2lwID0gYmxvY2tEZXRhaWxzLnNraXA7CgkgICAgICAgIGRldGFpbHMuYWdncmVnYXRlKGJsb2NrRGV0YWlscyk7CgkgICAgICAgIGlmIChza2lwIHx8IGJsb2NrRGV0YWlscy5yYXdJbnNlcnRlZCkgYnJlYWs7IC8vIGdvIG5leHQgY2hhcgoJICAgICAgfQoKCSAgICAgIHJldHVybiBkZXRhaWxzOwoJICAgIH0KCSAgICAvKioKCSAgICAgIEBvdmVycmlkZQoJICAgICovCgoJICB9LCB7CgkgICAga2V5OiAiZXh0cmFjdFRhaWwiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBleHRyYWN0VGFpbCgpIHsKCSAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKCSAgICAgIHZhciBmcm9tUG9zID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAwOwoJICAgICAgdmFyIHRvUG9zID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB0aGlzLnZhbHVlLmxlbmd0aDsKCSAgICAgIHZhciBjaHVua1RhaWwgPSBuZXcgQ2h1bmtzVGFpbERldGFpbHMoKTsKCSAgICAgIGlmIChmcm9tUG9zID09PSB0b1BvcykgcmV0dXJuIGNodW5rVGFpbDsKCgkgICAgICB0aGlzLl9mb3JFYWNoQmxvY2tzSW5SYW5nZShmcm9tUG9zLCB0b1BvcywgZnVuY3Rpb24gKGIsIGJpLCBiRnJvbVBvcywgYlRvUG9zKSB7CgkgICAgICAgIHZhciBibG9ja0NodW5rID0gYi5leHRyYWN0VGFpbChiRnJvbVBvcywgYlRvUG9zKTsKCSAgICAgICAgYmxvY2tDaHVuay5zdG9wID0gX3RoaXMyLl9maW5kU3RvcEJlZm9yZShiaSk7CgkgICAgICAgIGJsb2NrQ2h1bmsuZnJvbSA9IF90aGlzMi5fYmxvY2tTdGFydFBvcyhiaSk7CgkgICAgICAgIGlmIChibG9ja0NodW5rIGluc3RhbmNlb2YgQ2h1bmtzVGFpbERldGFpbHMpIGJsb2NrQ2h1bmsuYmxvY2tJbmRleCA9IGJpOwoJICAgICAgICBjaHVua1RhaWwuZXh0ZW5kKGJsb2NrQ2h1bmspOwoJICAgICAgfSk7CgoJICAgICAgcmV0dXJuIGNodW5rVGFpbDsKCSAgICB9CgkgICAgLyoqCgkgICAgICBAb3ZlcnJpZGUKCSAgICAqLwoKCSAgfSwgewoJICAgIGtleTogImV4dHJhY3RJbnB1dCIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGV4dHJhY3RJbnB1dCgpIHsKCSAgICAgIHZhciBmcm9tUG9zID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAwOwoJICAgICAgdmFyIHRvUG9zID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB0aGlzLnZhbHVlLmxlbmd0aDsKCSAgICAgIHZhciBmbGFncyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDoge307CgkgICAgICBpZiAoZnJvbVBvcyA9PT0gdG9Qb3MpIHJldHVybiAnJzsKCSAgICAgIHZhciBpbnB1dCA9ICcnOwoKCSAgICAgIHRoaXMuX2ZvckVhY2hCbG9ja3NJblJhbmdlKGZyb21Qb3MsIHRvUG9zLCBmdW5jdGlvbiAoYiwgXywgZnJvbVBvcywgdG9Qb3MpIHsKCSAgICAgICAgaW5wdXQgKz0gYi5leHRyYWN0SW5wdXQoZnJvbVBvcywgdG9Qb3MsIGZsYWdzKTsKCSAgICAgIH0pOwoKCSAgICAgIHJldHVybiBpbnB1dDsKCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICJfZmluZFN0b3BCZWZvcmUiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBfZmluZFN0b3BCZWZvcmUoYmxvY2tJbmRleCkgewoJICAgICAgdmFyIHN0b3BCZWZvcmU7CgoJICAgICAgZm9yICh2YXIgc2kgPSAwOyBzaSA8IHRoaXMuX3N0b3BzLmxlbmd0aDsgKytzaSkgewoJICAgICAgICB2YXIgc3RvcCA9IHRoaXMuX3N0b3BzW3NpXTsKCSAgICAgICAgaWYgKHN0b3AgPD0gYmxvY2tJbmRleCkgc3RvcEJlZm9yZSA9IHN0b3A7ZWxzZSBicmVhazsKCSAgICAgIH0KCgkgICAgICByZXR1cm4gc3RvcEJlZm9yZTsKCSAgICB9CgkgICAgLyoqIEFwcGVuZHMgcGxhY2Vob2xkZXIgZGVwZW5kaW5nIG9uIGxhemluZXNzICovCgoJICB9LCB7CgkgICAga2V5OiAiX2FwcGVuZFBsYWNlaG9sZGVyIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gX2FwcGVuZFBsYWNlaG9sZGVyKHRvQmxvY2tJbmRleCkgewoJICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgoJICAgICAgdmFyIGRldGFpbHMgPSBuZXcgQ2hhbmdlRGV0YWlscygpOwoJICAgICAgaWYgKHRoaXMubGF6eSAmJiB0b0Jsb2NrSW5kZXggPT0gbnVsbCkgcmV0dXJuIGRldGFpbHM7CgoJICAgICAgdmFyIHN0YXJ0QmxvY2tJdGVyID0gdGhpcy5fbWFwUG9zVG9CbG9jayh0aGlzLnZhbHVlLmxlbmd0aCk7CgoJICAgICAgaWYgKCFzdGFydEJsb2NrSXRlcikgcmV0dXJuIGRldGFpbHM7CgkgICAgICB2YXIgc3RhcnRCbG9ja0luZGV4ID0gc3RhcnRCbG9ja0l0ZXIuaW5kZXg7CgkgICAgICB2YXIgZW5kQmxvY2tJbmRleCA9IHRvQmxvY2tJbmRleCAhPSBudWxsID8gdG9CbG9ja0luZGV4IDogdGhpcy5fYmxvY2tzLmxlbmd0aDsKCgkgICAgICB0aGlzLl9ibG9ja3Muc2xpY2Uoc3RhcnRCbG9ja0luZGV4LCBlbmRCbG9ja0luZGV4KS5mb3JFYWNoKGZ1bmN0aW9uIChiKSB7CgkgICAgICAgIGlmICghYi5sYXp5IHx8IHRvQmxvY2tJbmRleCAhPSBudWxsKSB7CgkgICAgICAgICAgLy8gJEZsb3dGaXhNZSBgX2Jsb2Nrc2AgbWF5IG5vdCBiZSBwcmVzZW50CgkgICAgICAgICAgdmFyIGFyZ3MgPSBiLl9ibG9ja3MgIT0gbnVsbCA/IFtiLl9ibG9ja3MubGVuZ3RoXSA6IFtdOwoKCSAgICAgICAgICB2YXIgYkRldGFpbHMgPSBiLl9hcHBlbmRQbGFjZWhvbGRlci5hcHBseShiLCBhcmdzKTsKCgkgICAgICAgICAgX3RoaXMzLl92YWx1ZSArPSBiRGV0YWlscy5pbnNlcnRlZDsKCSAgICAgICAgICBkZXRhaWxzLmFnZ3JlZ2F0ZShiRGV0YWlscyk7CgkgICAgICAgIH0KCSAgICAgIH0pOwoKCSAgICAgIHJldHVybiBkZXRhaWxzOwoJICAgIH0KCSAgICAvKiogRmluZHMgYmxvY2sgaW4gcG9zICovCgoJICB9LCB7CgkgICAga2V5OiAiX21hcFBvc1RvQmxvY2siLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBfbWFwUG9zVG9CbG9jayhwb3MpIHsKCSAgICAgIHZhciBhY2NWYWwgPSAnJzsKCgkgICAgICBmb3IgKHZhciBiaSA9IDA7IGJpIDwgdGhpcy5fYmxvY2tzLmxlbmd0aDsgKytiaSkgewoJICAgICAgICB2YXIgX2Jsb2NrMiA9IHRoaXMuX2Jsb2Nrc1tiaV07CgkgICAgICAgIHZhciBibG9ja1N0YXJ0UG9zID0gYWNjVmFsLmxlbmd0aDsKCSAgICAgICAgYWNjVmFsICs9IF9ibG9jazIudmFsdWU7CgoJICAgICAgICBpZiAocG9zIDw9IGFjY1ZhbC5sZW5ndGgpIHsKCSAgICAgICAgICByZXR1cm4gewoJICAgICAgICAgICAgaW5kZXg6IGJpLAoJICAgICAgICAgICAgb2Zmc2V0OiBwb3MgLSBibG9ja1N0YXJ0UG9zCgkgICAgICAgICAgfTsKCSAgICAgICAgfQoJICAgICAgfQoJICAgIH0KCSAgICAvKiogKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJfYmxvY2tTdGFydFBvcyIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIF9ibG9ja1N0YXJ0UG9zKGJsb2NrSW5kZXgpIHsKCSAgICAgIHJldHVybiB0aGlzLl9ibG9ja3Muc2xpY2UoMCwgYmxvY2tJbmRleCkucmVkdWNlKGZ1bmN0aW9uIChwb3MsIGIpIHsKCSAgICAgICAgcmV0dXJuIHBvcyArPSBiLnZhbHVlLmxlbmd0aDsKCSAgICAgIH0sIDApOwoJICAgIH0KCSAgICAvKiogKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJfZm9yRWFjaEJsb2Nrc0luUmFuZ2UiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBfZm9yRWFjaEJsb2Nrc0luUmFuZ2UoZnJvbVBvcykgewoJICAgICAgdmFyIHRvUG9zID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB0aGlzLnZhbHVlLmxlbmd0aDsKCSAgICAgIHZhciBmbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAyID8gYXJndW1lbnRzWzJdIDogdW5kZWZpbmVkOwoKCSAgICAgIHZhciBmcm9tQmxvY2tJdGVyID0gdGhpcy5fbWFwUG9zVG9CbG9jayhmcm9tUG9zKTsKCgkgICAgICBpZiAoZnJvbUJsb2NrSXRlcikgewoJICAgICAgICB2YXIgdG9CbG9ja0l0ZXIgPSB0aGlzLl9tYXBQb3NUb0Jsb2NrKHRvUG9zKTsgLy8gcHJvY2VzcyBmaXJzdCBibG9jawoKCgkgICAgICAgIHZhciBpc1NhbWVCbG9jayA9IHRvQmxvY2tJdGVyICYmIGZyb21CbG9ja0l0ZXIuaW5kZXggPT09IHRvQmxvY2tJdGVyLmluZGV4OwoJICAgICAgICB2YXIgZnJvbUJsb2NrU3RhcnRQb3MgPSBmcm9tQmxvY2tJdGVyLm9mZnNldDsKCSAgICAgICAgdmFyIGZyb21CbG9ja0VuZFBvcyA9IHRvQmxvY2tJdGVyICYmIGlzU2FtZUJsb2NrID8gdG9CbG9ja0l0ZXIub2Zmc2V0IDogdGhpcy5fYmxvY2tzW2Zyb21CbG9ja0l0ZXIuaW5kZXhdLnZhbHVlLmxlbmd0aDsKCSAgICAgICAgZm4odGhpcy5fYmxvY2tzW2Zyb21CbG9ja0l0ZXIuaW5kZXhdLCBmcm9tQmxvY2tJdGVyLmluZGV4LCBmcm9tQmxvY2tTdGFydFBvcywgZnJvbUJsb2NrRW5kUG9zKTsKCgkgICAgICAgIGlmICh0b0Jsb2NrSXRlciAmJiAhaXNTYW1lQmxvY2spIHsKCSAgICAgICAgICAvLyBwcm9jZXNzIGludGVybWVkaWF0ZSBibG9ja3MKCSAgICAgICAgICBmb3IgKHZhciBiaSA9IGZyb21CbG9ja0l0ZXIuaW5kZXggKyAxOyBiaSA8IHRvQmxvY2tJdGVyLmluZGV4OyArK2JpKSB7CgkgICAgICAgICAgICBmbih0aGlzLl9ibG9ja3NbYmldLCBiaSwgMCwgdGhpcy5fYmxvY2tzW2JpXS52YWx1ZS5sZW5ndGgpOwoJICAgICAgICAgIH0gLy8gcHJvY2VzcyBsYXN0IGJsb2NrCgoKCSAgICAgICAgICBmbih0aGlzLl9ibG9ja3NbdG9CbG9ja0l0ZXIuaW5kZXhdLCB0b0Jsb2NrSXRlci5pbmRleCwgMCwgdG9CbG9ja0l0ZXIub2Zmc2V0KTsKCSAgICAgICAgfQoJICAgICAgfQoJICAgIH0KCSAgICAvKioKCSAgICAgIEBvdmVycmlkZQoJICAgICovCgoJICB9LCB7CgkgICAga2V5OiAicmVtb3ZlIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlKCkgewoJICAgICAgdmFyIGZyb21Qb3MgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IDA7CgkgICAgICB2YXIgdG9Qb3MgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHRoaXMudmFsdWUubGVuZ3RoOwoKCSAgICAgIHZhciByZW1vdmVEZXRhaWxzID0gX2dldChfZ2V0UHJvdG90eXBlT2YoTWFza2VkUGF0dGVybi5wcm90b3R5cGUpLCAicmVtb3ZlIiwgdGhpcykuY2FsbCh0aGlzLCBmcm9tUG9zLCB0b1Bvcyk7CgoJICAgICAgdGhpcy5fZm9yRWFjaEJsb2Nrc0luUmFuZ2UoZnJvbVBvcywgdG9Qb3MsIGZ1bmN0aW9uIChiLCBfLCBiRnJvbVBvcywgYlRvUG9zKSB7CgkgICAgICAgIHJlbW92ZURldGFpbHMuYWdncmVnYXRlKGIucmVtb3ZlKGJGcm9tUG9zLCBiVG9Qb3MpKTsKCSAgICAgIH0pOwoKCSAgICAgIHJldHVybiByZW1vdmVEZXRhaWxzOwoJICAgIH0KCSAgICAvKioKCSAgICAgIEBvdmVycmlkZQoJICAgICovCgoJICB9LCB7CgkgICAga2V5OiAibmVhcmVzdElucHV0UG9zIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gbmVhcmVzdElucHV0UG9zKGN1cnNvclBvcykgewoJICAgICAgdmFyIGRpcmVjdGlvbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogRElSRUNUSU9OLk5PTkU7CgkgICAgICAvLyBUT0RPIHJlZmFjdG9yIC0gZXh0cmFjdCBhbGlnbmJsb2NrCgkgICAgICB2YXIgYmVnaW5CbG9ja0RhdGEgPSB0aGlzLl9tYXBQb3NUb0Jsb2NrKGN1cnNvclBvcykgfHwgewoJICAgICAgICBpbmRleDogMCwKCSAgICAgICAgb2Zmc2V0OiAwCgkgICAgICB9OwoJICAgICAgdmFyIGJlZ2luQmxvY2tPZmZzZXQgPSBiZWdpbkJsb2NrRGF0YS5vZmZzZXQsCgkgICAgICAgICAgYmVnaW5CbG9ja0luZGV4ID0gYmVnaW5CbG9ja0RhdGEuaW5kZXg7CgkgICAgICB2YXIgYmVnaW5CbG9jayA9IHRoaXMuX2Jsb2Nrc1tiZWdpbkJsb2NrSW5kZXhdOwoJICAgICAgaWYgKCFiZWdpbkJsb2NrKSByZXR1cm4gY3Vyc29yUG9zOwoJICAgICAgdmFyIGJlZ2luQmxvY2tDdXJzb3JQb3MgPSBiZWdpbkJsb2NrT2Zmc2V0OyAvLyBpZiBwb3NpdGlvbiBpbnNpZGUgYmxvY2sgLSB0cnkgdG8gYWRqdXN0IGl0CgoJICAgICAgaWYgKGJlZ2luQmxvY2tDdXJzb3JQb3MgIT09IDAgJiYgYmVnaW5CbG9ja0N1cnNvclBvcyA8IGJlZ2luQmxvY2sudmFsdWUubGVuZ3RoKSB7CgkgICAgICAgIGJlZ2luQmxvY2tDdXJzb3JQb3MgPSBiZWdpbkJsb2NrLm5lYXJlc3RJbnB1dFBvcyhiZWdpbkJsb2NrT2Zmc2V0LCBmb3JjZURpcmVjdGlvbihkaXJlY3Rpb24pKTsKCSAgICAgIH0KCgkgICAgICB2YXIgY3Vyc29yQXRSaWdodCA9IGJlZ2luQmxvY2tDdXJzb3JQb3MgPT09IGJlZ2luQmxvY2sudmFsdWUubGVuZ3RoOwoJICAgICAgdmFyIGN1cnNvckF0TGVmdCA9IGJlZ2luQmxvY2tDdXJzb3JQb3MgPT09IDA7IC8vICBjdXJzb3IgaXMgSU5TSURFIGZpcnN0IGJsb2NrIChub3QgYXQgYm91bmRzKQoKCSAgICAgIGlmICghY3Vyc29yQXRMZWZ0ICYmICFjdXJzb3JBdFJpZ2h0KSByZXR1cm4gdGhpcy5fYmxvY2tTdGFydFBvcyhiZWdpbkJsb2NrSW5kZXgpICsgYmVnaW5CbG9ja0N1cnNvclBvczsKCSAgICAgIHZhciBzZWFyY2hCbG9ja0luZGV4ID0gY3Vyc29yQXRSaWdodCA/IGJlZ2luQmxvY2tJbmRleCArIDEgOiBiZWdpbkJsb2NrSW5kZXg7CgoJICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gRElSRUNUSU9OLk5PTkUpIHsKCSAgICAgICAgLy8gTk9ORSBkaXJlY3Rpb24gdXNlZCB0byBjYWxjdWxhdGUgc3RhcnQgaW5wdXQgcG9zaXRpb24gaWYgbm8gY2hhcnMgd2VyZSByZW1vdmVkCgkgICAgICAgIC8vIEZPUiBOT05FOgoJICAgICAgICAvLyAtCgkgICAgICAgIC8vIGlucHV0fGFueQoJICAgICAgICAvLyAtPgoJICAgICAgICAvLyAgYW55fGlucHV0CgkgICAgICAgIC8vIDwtCgkgICAgICAgIC8vICBmaWxsZWQtaW5wdXR8YW55CgkgICAgICAgIC8vIGNoZWNrIGlmIGZpcnN0IGJsb2NrIGF0IGxlZnQgaXMgaW5wdXQKCSAgICAgICAgaWYgKHNlYXJjaEJsb2NrSW5kZXggPiAwKSB7CgkgICAgICAgICAgdmFyIGJsb2NrSW5kZXhBdExlZnQgPSBzZWFyY2hCbG9ja0luZGV4IC0gMTsKCSAgICAgICAgICB2YXIgYmxvY2tBdExlZnQgPSB0aGlzLl9ibG9ja3NbYmxvY2tJbmRleEF0TGVmdF07CgkgICAgICAgICAgdmFyIGJsb2NrSW5wdXRQb3MgPSBibG9ja0F0TGVmdC5uZWFyZXN0SW5wdXRQb3MoMCwgRElSRUNUSU9OLk5PTkUpOyAvLyBpcyBpbnB1dAoKCSAgICAgICAgICBpZiAoIWJsb2NrQXRMZWZ0LnZhbHVlLmxlbmd0aCB8fCBibG9ja0lucHV0UG9zICE9PSBibG9ja0F0TGVmdC52YWx1ZS5sZW5ndGgpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLl9ibG9ja1N0YXJ0UG9zKHNlYXJjaEJsb2NrSW5kZXgpOwoJICAgICAgICAgIH0KCSAgICAgICAgfSAvLyAtPgoKCgkgICAgICAgIHZhciBmaXJzdElucHV0QXRSaWdodCA9IHNlYXJjaEJsb2NrSW5kZXg7CgoJICAgICAgICBmb3IgKHZhciBiaSA9IGZpcnN0SW5wdXRBdFJpZ2h0OyBiaSA8IHRoaXMuX2Jsb2Nrcy5sZW5ndGg7ICsrYmkpIHsKCSAgICAgICAgICB2YXIgYmxvY2tBdFJpZ2h0ID0gdGhpcy5fYmxvY2tzW2JpXTsKCgkgICAgICAgICAgdmFyIF9ibG9ja0lucHV0UG9zID0gYmxvY2tBdFJpZ2h0Lm5lYXJlc3RJbnB1dFBvcygwLCBESVJFQ1RJT04uTk9ORSk7CgoJICAgICAgICAgIGlmICghYmxvY2tBdFJpZ2h0LnZhbHVlLmxlbmd0aCB8fCBfYmxvY2tJbnB1dFBvcyAhPT0gYmxvY2tBdFJpZ2h0LnZhbHVlLmxlbmd0aCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Jsb2NrU3RhcnRQb3MoYmkpICsgX2Jsb2NrSW5wdXRQb3M7CgkgICAgICAgICAgfQoJICAgICAgICB9IC8vIDwtCgkgICAgICAgIC8vIGZpbmQgZmlyc3Qgbm9uLWZpeGVkIHN5bWJvbAoKCgkgICAgICAgIGZvciAodmFyIF9iaSA9IHNlYXJjaEJsb2NrSW5kZXggLSAxOyBfYmkgPj0gMDsgLS1fYmkpIHsKCSAgICAgICAgICB2YXIgX2Jsb2NrMyA9IHRoaXMuX2Jsb2Nrc1tfYmldOwoKCSAgICAgICAgICB2YXIgX2Jsb2NrSW5wdXRQb3MyID0gX2Jsb2NrMy5uZWFyZXN0SW5wdXRQb3MoMCwgRElSRUNUSU9OLk5PTkUpOyAvLyBpcyBpbnB1dAoKCgkgICAgICAgICAgaWYgKCFfYmxvY2szLnZhbHVlLmxlbmd0aCB8fCBfYmxvY2tJbnB1dFBvczIgIT09IF9ibG9jazMudmFsdWUubGVuZ3RoKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5fYmxvY2tTdGFydFBvcyhfYmkpICsgX2Jsb2NrMy52YWx1ZS5sZW5ndGg7CgkgICAgICAgICAgfQoJICAgICAgICB9CgoJICAgICAgICByZXR1cm4gY3Vyc29yUG9zOwoJICAgICAgfQoKCSAgICAgIGlmIChkaXJlY3Rpb24gPT09IERJUkVDVElPTi5MRUZUIHx8IGRpcmVjdGlvbiA9PT0gRElSRUNUSU9OLkZPUkNFX0xFRlQpIHsKCSAgICAgICAgLy8gLQoJICAgICAgICAvLyAgYW55fGZpbGxlZC1pbnB1dAoJICAgICAgICAvLyA8LQoJICAgICAgICAvLyAgYW55fGZpcnN0IG5vdCBlbXB0eSBpcyBub3QtbGVuLWFsaWduZWQKCSAgICAgICAgLy8gIG5vdC0wLWFsaWduZWR8YW55CgkgICAgICAgIC8vIC0+CgkgICAgICAgIC8vICBhbnl8bm90LWxlbi1hbGlnbmVkIG9yIGVuZAoJICAgICAgICAvLyBjaGVjayBpZiBmaXJzdCBibG9jayBhdCByaWdodCBpcyBmaWxsZWQgaW5wdXQKCSAgICAgICAgdmFyIGZpcnN0RmlsbGVkQmxvY2tJbmRleEF0UmlnaHQ7CgoJICAgICAgICBmb3IgKHZhciBfYmkyID0gc2VhcmNoQmxvY2tJbmRleDsgX2JpMiA8IHRoaXMuX2Jsb2Nrcy5sZW5ndGg7ICsrX2JpMikgewoJICAgICAgICAgIGlmICh0aGlzLl9ibG9ja3NbX2JpMl0udmFsdWUpIHsKCSAgICAgICAgICAgIGZpcnN0RmlsbGVkQmxvY2tJbmRleEF0UmlnaHQgPSBfYmkyOwoJICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgfQoJICAgICAgICB9CgoJICAgICAgICBpZiAoZmlyc3RGaWxsZWRCbG9ja0luZGV4QXRSaWdodCAhPSBudWxsKSB7CgkgICAgICAgICAgdmFyIGZpbGxlZEJsb2NrID0gdGhpcy5fYmxvY2tzW2ZpcnN0RmlsbGVkQmxvY2tJbmRleEF0UmlnaHRdOwoKCSAgICAgICAgICB2YXIgX2Jsb2NrSW5wdXRQb3MzID0gZmlsbGVkQmxvY2submVhcmVzdElucHV0UG9zKDAsIERJUkVDVElPTi5SSUdIVCk7CgoJICAgICAgICAgIGlmIChfYmxvY2tJbnB1dFBvczMgPT09IDAgJiYgZmlsbGVkQmxvY2sudW5tYXNrZWRWYWx1ZS5sZW5ndGgpIHsKCSAgICAgICAgICAgIC8vIGZpbGxlZCBibG9jayBpcyBpbnB1dAoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Jsb2NrU3RhcnRQb3MoZmlyc3RGaWxsZWRCbG9ja0luZGV4QXRSaWdodCkgKyBfYmxvY2tJbnB1dFBvczM7CgkgICAgICAgICAgfQoJICAgICAgICB9IC8vIDwtCgkgICAgICAgIC8vIGZpbmQgdGhpcyB2YXJzCgoKCSAgICAgICAgdmFyIGZpcnN0RmlsbGVkSW5wdXRCbG9ja0luZGV4ID0gLTE7CgkgICAgICAgIHZhciBmaXJzdEVtcHR5SW5wdXRCbG9ja0luZGV4OyAvLyBUT0RPIGNvbnNpZGVyIG5lc3RlZCBlbXB0eSBpbnB1dHMKCgkgICAgICAgIGZvciAodmFyIF9iaTMgPSBzZWFyY2hCbG9ja0luZGV4IC0gMTsgX2JpMyA+PSAwOyAtLV9iaTMpIHsKCSAgICAgICAgICB2YXIgX2Jsb2NrNCA9IHRoaXMuX2Jsb2Nrc1tfYmkzXTsKCgkgICAgICAgICAgdmFyIF9ibG9ja0lucHV0UG9zNCA9IF9ibG9jazQubmVhcmVzdElucHV0UG9zKF9ibG9jazQudmFsdWUubGVuZ3RoLCBESVJFQ1RJT04uRk9SQ0VfTEVGVCk7CgoJICAgICAgICAgIGlmICghX2Jsb2NrNC52YWx1ZSB8fCBfYmxvY2tJbnB1dFBvczQgIT09IDApIGZpcnN0RW1wdHlJbnB1dEJsb2NrSW5kZXggPSBfYmkzOwoKCSAgICAgICAgICBpZiAoX2Jsb2NrSW5wdXRQb3M0ICE9PSAwKSB7CgkgICAgICAgICAgICBpZiAoX2Jsb2NrSW5wdXRQb3M0ICE9PSBfYmxvY2s0LnZhbHVlLmxlbmd0aCkgewoJICAgICAgICAgICAgICAvLyBhbGlnbmVkIGluc2lkZSBibG9jayAtIHJldHVybiBpbW1lZGlhdGVseQoJICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYmxvY2tTdGFydFBvcyhfYmkzKSArIF9ibG9ja0lucHV0UG9zNDsKCSAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgIC8vIGZvdW5kIGZpbGxlZAoJICAgICAgICAgICAgICBmaXJzdEZpbGxlZElucHV0QmxvY2tJbmRleCA9IF9iaTM7CgkgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgIH0KCSAgICAgICAgfQoKCSAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gRElSRUNUSU9OLkxFRlQpIHsKCSAgICAgICAgICAvLyB0cnkgZmluZCBmaXJzdCBlbXB0eSBpbnB1dCBiZWZvcmUgc3RhcnQgc2VhcmNoaW5nIHBvc2l0aW9uIG9ubHkgd2hlbiBub3QgZm9yY2VkCgkgICAgICAgICAgZm9yICh2YXIgX2JpNCA9IGZpcnN0RmlsbGVkSW5wdXRCbG9ja0luZGV4ICsgMTsgX2JpNCA8PSBNYXRoLm1pbihzZWFyY2hCbG9ja0luZGV4LCB0aGlzLl9ibG9ja3MubGVuZ3RoIC0gMSk7ICsrX2JpNCkgewoJICAgICAgICAgICAgdmFyIF9ibG9jazUgPSB0aGlzLl9ibG9ja3NbX2JpNF07CgoJICAgICAgICAgICAgdmFyIF9ibG9ja0lucHV0UG9zNSA9IF9ibG9jazUubmVhcmVzdElucHV0UG9zKDAsIERJUkVDVElPTi5OT05FKTsKCgkgICAgICAgICAgICB2YXIgYmxvY2tBbGlnbmVkUG9zID0gdGhpcy5fYmxvY2tTdGFydFBvcyhfYmk0KSArIF9ibG9ja0lucHV0UG9zNTsKCgkgICAgICAgICAgICBpZiAoYmxvY2tBbGlnbmVkUG9zID4gY3Vyc29yUG9zKSBicmVhazsgLy8gaWYgYmxvY2sgaXMgbm90IGxhenkgaW5wdXQKCgkgICAgICAgICAgICBpZiAoX2Jsb2NrSW5wdXRQb3M1ICE9PSBfYmxvY2s1LnZhbHVlLmxlbmd0aCkgcmV0dXJuIGJsb2NrQWxpZ25lZFBvczsKCSAgICAgICAgICB9CgkgICAgICAgIH0gLy8gcHJvY2VzcyBvdmVyZmxvdwoKCgkgICAgICAgIGlmIChmaXJzdEZpbGxlZElucHV0QmxvY2tJbmRleCA+PSAwKSB7CgkgICAgICAgICAgcmV0dXJuIHRoaXMuX2Jsb2NrU3RhcnRQb3MoZmlyc3RGaWxsZWRJbnB1dEJsb2NrSW5kZXgpICsgdGhpcy5fYmxvY2tzW2ZpcnN0RmlsbGVkSW5wdXRCbG9ja0luZGV4XS52YWx1ZS5sZW5ndGg7CgkgICAgICAgIH0gLy8gZm9yIGxhenkgaWYgaGFzIGFsaWduZWQgbGVmdCBpbnNpZGUgZml4ZWQgYW5kIGhhcyBjYW1lIHRvIHRoZSBzdGFydCAtIHVzZSBzdGFydCBwb3NpdGlvbgoKCgkgICAgICAgIGlmIChkaXJlY3Rpb24gPT09IERJUkVDVElPTi5GT1JDRV9MRUZUIHx8IHRoaXMubGF6eSAmJiAhdGhpcy5leHRyYWN0SW5wdXQoKSAmJiAhaXNJbnB1dCh0aGlzLl9ibG9ja3Nbc2VhcmNoQmxvY2tJbmRleF0pKSB7CgkgICAgICAgICAgcmV0dXJuIDA7CgkgICAgICAgIH0KCgkgICAgICAgIGlmIChmaXJzdEVtcHR5SW5wdXRCbG9ja0luZGV4ICE9IG51bGwpIHsKCSAgICAgICAgICByZXR1cm4gdGhpcy5fYmxvY2tTdGFydFBvcyhmaXJzdEVtcHR5SW5wdXRCbG9ja0luZGV4KTsKCSAgICAgICAgfSAvLyBmaW5kIGZpcnN0IGlucHV0CgoKCSAgICAgICAgZm9yICh2YXIgX2JpNSA9IHNlYXJjaEJsb2NrSW5kZXg7IF9iaTUgPCB0aGlzLl9ibG9ja3MubGVuZ3RoOyArK19iaTUpIHsKCSAgICAgICAgICB2YXIgX2Jsb2NrNiA9IHRoaXMuX2Jsb2Nrc1tfYmk1XTsKCgkgICAgICAgICAgdmFyIF9ibG9ja0lucHV0UG9zNiA9IF9ibG9jazYubmVhcmVzdElucHV0UG9zKDAsIERJUkVDVElPTi5OT05FKTsgLy8gaXMgaW5wdXQKCgoJICAgICAgICAgIGlmICghX2Jsb2NrNi52YWx1ZS5sZW5ndGggfHwgX2Jsb2NrSW5wdXRQb3M2ICE9PSBfYmxvY2s2LnZhbHVlLmxlbmd0aCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Jsb2NrU3RhcnRQb3MoX2JpNSkgKyBfYmxvY2tJbnB1dFBvczY7CgkgICAgICAgICAgfQoJICAgICAgICB9CgoJICAgICAgICByZXR1cm4gMDsKCSAgICAgIH0KCgkgICAgICBpZiAoZGlyZWN0aW9uID09PSBESVJFQ1RJT04uUklHSFQgfHwgZGlyZWN0aW9uID09PSBESVJFQ1RJT04uRk9SQ0VfUklHSFQpIHsKCSAgICAgICAgLy8gLT4KCSAgICAgICAgLy8gIGFueXxub3QtbGVuLWFsaWduZWQgYW5kIGZpbGxlZAoJICAgICAgICAvLyAgYW55fG5vdC1sZW4tYWxpZ25lZAoJICAgICAgICAvLyA8LQoJICAgICAgICAvLyAgbm90LTAtYWxpZ25lZCBvciBzdGFydHxhbnkKCSAgICAgICAgdmFyIGZpcnN0SW5wdXRCbG9ja0FsaWduZWRJbmRleDsKCSAgICAgICAgdmFyIGZpcnN0SW5wdXRCbG9ja0FsaWduZWRQb3M7CgoJICAgICAgICBmb3IgKHZhciBfYmk2ID0gc2VhcmNoQmxvY2tJbmRleDsgX2JpNiA8IHRoaXMuX2Jsb2Nrcy5sZW5ndGg7ICsrX2JpNikgewoJICAgICAgICAgIHZhciBfYmxvY2s3ID0gdGhpcy5fYmxvY2tzW19iaTZdOwoKCSAgICAgICAgICB2YXIgX2Jsb2NrSW5wdXRQb3M3ID0gX2Jsb2NrNy5uZWFyZXN0SW5wdXRQb3MoMCwgRElSRUNUSU9OLk5PTkUpOwoKCSAgICAgICAgICBpZiAoX2Jsb2NrSW5wdXRQb3M3ICE9PSBfYmxvY2s3LnZhbHVlLmxlbmd0aCkgewoJICAgICAgICAgICAgZmlyc3RJbnB1dEJsb2NrQWxpZ25lZFBvcyA9IHRoaXMuX2Jsb2NrU3RhcnRQb3MoX2JpNikgKyBfYmxvY2tJbnB1dFBvczc7CgkgICAgICAgICAgICBmaXJzdElucHV0QmxvY2tBbGlnbmVkSW5kZXggPSBfYmk2OwoJICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgfQoJICAgICAgICB9CgoJICAgICAgICBpZiAoZmlyc3RJbnB1dEJsb2NrQWxpZ25lZEluZGV4ICE9IG51bGwgJiYgZmlyc3RJbnB1dEJsb2NrQWxpZ25lZFBvcyAhPSBudWxsKSB7CgkgICAgICAgICAgZm9yICh2YXIgX2JpNyA9IGZpcnN0SW5wdXRCbG9ja0FsaWduZWRJbmRleDsgX2JpNyA8IHRoaXMuX2Jsb2Nrcy5sZW5ndGg7ICsrX2JpNykgewoJICAgICAgICAgICAgdmFyIF9ibG9jazggPSB0aGlzLl9ibG9ja3NbX2JpN107CgoJICAgICAgICAgICAgdmFyIF9ibG9ja0lucHV0UG9zOCA9IF9ibG9jazgubmVhcmVzdElucHV0UG9zKDAsIERJUkVDVElPTi5GT1JDRV9SSUdIVCk7CgoJICAgICAgICAgICAgaWYgKF9ibG9ja0lucHV0UG9zOCAhPT0gX2Jsb2NrOC52YWx1ZS5sZW5ndGgpIHsKCSAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Jsb2NrU3RhcnRQb3MoX2JpNykgKyBfYmxvY2tJbnB1dFBvczg7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgfQoKCSAgICAgICAgICByZXR1cm4gZGlyZWN0aW9uID09PSBESVJFQ1RJT04uRk9SQ0VfUklHSFQgPyB0aGlzLnZhbHVlLmxlbmd0aCA6IGZpcnN0SW5wdXRCbG9ja0FsaWduZWRQb3M7CgkgICAgICAgIH0KCgkgICAgICAgIGZvciAodmFyIF9iaTggPSBNYXRoLm1pbihzZWFyY2hCbG9ja0luZGV4LCB0aGlzLl9ibG9ja3MubGVuZ3RoIC0gMSk7IF9iaTggPj0gMDsgLS1fYmk4KSB7CgkgICAgICAgICAgdmFyIF9ibG9jazkgPSB0aGlzLl9ibG9ja3NbX2JpOF07CgoJICAgICAgICAgIHZhciBfYmxvY2tJbnB1dFBvczkgPSBfYmxvY2s5Lm5lYXJlc3RJbnB1dFBvcyhfYmxvY2s5LnZhbHVlLmxlbmd0aCwgRElSRUNUSU9OLkxFRlQpOwoKCSAgICAgICAgICBpZiAoX2Jsb2NrSW5wdXRQb3M5ICE9PSAwKSB7CgkgICAgICAgICAgICB2YXIgYWxpZ25lZFBvcyA9IHRoaXMuX2Jsb2NrU3RhcnRQb3MoX2JpOCkgKyBfYmxvY2tJbnB1dFBvczk7CgoJICAgICAgICAgICAgaWYgKGFsaWduZWRQb3MgPj0gY3Vyc29yUG9zKSByZXR1cm4gYWxpZ25lZFBvczsKCSAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgfQoKCSAgICAgIHJldHVybiBjdXJzb3JQb3M7CgkgICAgfQoJICAgIC8qKiBHZXQgYmxvY2sgYnkgbmFtZSAqLwoKCSAgfSwgewoJICAgIGtleTogIm1hc2tlZEJsb2NrIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gbWFza2VkQmxvY2sobmFtZSkgewoJICAgICAgcmV0dXJuIHRoaXMubWFza2VkQmxvY2tzKG5hbWUpWzBdOwoJICAgIH0KCSAgICAvKiogR2V0IGFsbCBibG9ja3MgYnkgbmFtZSAqLwoKCSAgfSwgewoJICAgIGtleTogIm1hc2tlZEJsb2NrcyIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIG1hc2tlZEJsb2NrcyhuYW1lKSB7CgkgICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCgkgICAgICB2YXIgaW5kaWNlcyA9IHRoaXMuX21hc2tlZEJsb2Nrc1tuYW1lXTsKCSAgICAgIGlmICghaW5kaWNlcykgcmV0dXJuIFtdOwoJICAgICAgcmV0dXJuIGluZGljZXMubWFwKGZ1bmN0aW9uIChnaSkgewoJICAgICAgICByZXR1cm4gX3RoaXM0Ll9ibG9ja3NbZ2ldOwoJICAgICAgfSk7CgkgICAgfQoJICB9LCB7CgkgICAga2V5OiAic3RhdGUiLAoJICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewoJICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIF9nZXQoX2dldFByb3RvdHlwZU9mKE1hc2tlZFBhdHRlcm4ucHJvdG90eXBlKSwgInN0YXRlIiwgdGhpcyksIHsKCSAgICAgICAgX2Jsb2NrczogdGhpcy5fYmxvY2tzLm1hcChmdW5jdGlvbiAoYikgewoJICAgICAgICAgIHJldHVybiBiLnN0YXRlOwoJICAgICAgICB9KQoJICAgICAgfSk7CgkgICAgfSwKCSAgICBzZXQ6IGZ1bmN0aW9uIHNldChzdGF0ZSkgewoJICAgICAgdmFyIF9ibG9ja3MgPSBzdGF0ZS5fYmxvY2tzLAoJICAgICAgICAgIG1hc2tlZFN0YXRlID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKHN0YXRlLCBbIl9ibG9ja3MiXSk7CgoJICAgICAgdGhpcy5fYmxvY2tzLmZvckVhY2goZnVuY3Rpb24gKGIsIGJpKSB7CgkgICAgICAgIHJldHVybiBiLnN0YXRlID0gX2Jsb2Nrc1tiaV07CgkgICAgICB9KTsKCgkgICAgICBfc2V0KF9nZXRQcm90b3R5cGVPZihNYXNrZWRQYXR0ZXJuLnByb3RvdHlwZSksICJzdGF0ZSIsIG1hc2tlZFN0YXRlLCB0aGlzLCB0cnVlKTsKCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICJpc0NvbXBsZXRlIiwKCSAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCSAgICAgIHJldHVybiB0aGlzLl9ibG9ja3MuZXZlcnkoZnVuY3Rpb24gKGIpIHsKCSAgICAgICAgcmV0dXJuIGIuaXNDb21wbGV0ZTsKCSAgICAgIH0pOwoJICAgIH0KCSAgfSwgewoJICAgIGtleTogInVubWFza2VkVmFsdWUiLAoJICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewoJICAgICAgcmV0dXJuIHRoaXMuX2Jsb2Nrcy5yZWR1Y2UoZnVuY3Rpb24gKHN0ciwgYikgewoJICAgICAgICByZXR1cm4gc3RyICs9IGIudW5tYXNrZWRWYWx1ZTsKCSAgICAgIH0sICcnKTsKCSAgICB9LAoJICAgIHNldDogZnVuY3Rpb24gc2V0KHVubWFza2VkVmFsdWUpIHsKCSAgICAgIF9zZXQoX2dldFByb3RvdHlwZU9mKE1hc2tlZFBhdHRlcm4ucHJvdG90eXBlKSwgInVubWFza2VkVmFsdWUiLCB1bm1hc2tlZFZhbHVlLCB0aGlzLCB0cnVlKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICBAb3ZlcnJpZGUKCSAgICAqLwoKCSAgfSwgewoJICAgIGtleTogInZhbHVlIiwKCSAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCSAgICAgIC8vIFRPRE8gcmV0dXJuIF92YWx1ZSB3aGVuIG5vdCBpbiBjaGFuZ2U/CgkgICAgICByZXR1cm4gdGhpcy5fYmxvY2tzLnJlZHVjZShmdW5jdGlvbiAoc3RyLCBiKSB7CgkgICAgICAgIHJldHVybiBzdHIgKz0gYi52YWx1ZTsKCSAgICAgIH0sICcnKTsKCSAgICB9LAoJICAgIHNldDogZnVuY3Rpb24gc2V0KHZhbHVlKSB7CgkgICAgICBfc2V0KF9nZXRQcm90b3R5cGVPZihNYXNrZWRQYXR0ZXJuLnByb3RvdHlwZSksICJ2YWx1ZSIsIHZhbHVlLCB0aGlzLCB0cnVlKTsKCSAgICB9CgkgIH1dKTsKCgkgIHJldHVybiBNYXNrZWRQYXR0ZXJuOwoJfShNYXNrZWQpOwoJTWFza2VkUGF0dGVybi5ERUZBVUxUUyA9IHsKCSAgbGF6eTogdHJ1ZSwKCSAgcGxhY2Vob2xkZXJDaGFyOiAnXycKCX07CglNYXNrZWRQYXR0ZXJuLlNUT1BfQ0hBUiA9ICdgJzsKCU1hc2tlZFBhdHRlcm4uRVNDQVBFX0NIQVIgPSAnXFwnOwoJTWFza2VkUGF0dGVybi5JbnB1dERlZmluaXRpb24gPSBQYXR0ZXJuSW5wdXREZWZpbml0aW9uOwoJTWFza2VkUGF0dGVybi5GaXhlZERlZmluaXRpb24gPSBQYXR0ZXJuRml4ZWREZWZpbml0aW9uOwoKCWZ1bmN0aW9uIGlzSW5wdXQoYmxvY2spIHsKCSAgaWYgKCFibG9jaykgcmV0dXJuIGZhbHNlOwoJICB2YXIgdmFsdWUgPSBibG9jay52YWx1ZTsKCSAgcmV0dXJuICF2YWx1ZSB8fCBibG9jay5uZWFyZXN0SW5wdXRQb3MoMCwgRElSRUNUSU9OLk5PTkUpICE9PSB2YWx1ZS5sZW5ndGg7Cgl9CgoJSU1hc2suTWFza2VkUGF0dGVybiA9IE1hc2tlZFBhdHRlcm47CgoJLyoqIFBhdHRlcm4gd2hpY2ggYWNjZXB0cyByYW5nZXMgKi8KCgl2YXIgTWFza2VkUmFuZ2UgPQoJLyojX19QVVJFX18qLwoJZnVuY3Rpb24gKF9NYXNrZWRQYXR0ZXJuKSB7CgkgIF9pbmhlcml0cyhNYXNrZWRSYW5nZSwgX01hc2tlZFBhdHRlcm4pOwoKCSAgZnVuY3Rpb24gTWFza2VkUmFuZ2UoKSB7CgkgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIE1hc2tlZFJhbmdlKTsKCgkgICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihNYXNrZWRSYW5nZSkuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CgkgIH0KCgkgIF9jcmVhdGVDbGFzcyhNYXNrZWRSYW5nZSwgW3sKCSAgICBrZXk6ICJfdXBkYXRlIiwKCgkgICAgLyoqCgkgICAgICBAb3ZlcnJpZGUKCSAgICAqLwoJICAgIHZhbHVlOiBmdW5jdGlvbiBfdXBkYXRlKG9wdHMpIHsKCSAgICAgIC8vIFRPRE8gdHlwZQoJICAgICAgb3B0cyA9IE9iamVjdC5hc3NpZ24oewoJICAgICAgICB0bzogdGhpcy50byB8fCAwLAoJICAgICAgICBmcm9tOiB0aGlzLmZyb20gfHwgMAoJICAgICAgfSwgb3B0cyk7CgkgICAgICB2YXIgbWF4TGVuZ3RoID0gU3RyaW5nKG9wdHMudG8pLmxlbmd0aDsKCSAgICAgIGlmIChvcHRzLm1heExlbmd0aCAhPSBudWxsKSBtYXhMZW5ndGggPSBNYXRoLm1heChtYXhMZW5ndGgsIG9wdHMubWF4TGVuZ3RoKTsKCSAgICAgIG9wdHMubWF4TGVuZ3RoID0gbWF4TGVuZ3RoOwoJICAgICAgdmFyIGZyb21TdHIgPSBTdHJpbmcob3B0cy5mcm9tKS5wYWRTdGFydChtYXhMZW5ndGgsICcwJyk7CgkgICAgICB2YXIgdG9TdHIgPSBTdHJpbmcob3B0cy50bykucGFkU3RhcnQobWF4TGVuZ3RoLCAnMCcpOwoJICAgICAgdmFyIHNhbWVDaGFyc0NvdW50ID0gMDsKCgkgICAgICB3aGlsZSAoc2FtZUNoYXJzQ291bnQgPCB0b1N0ci5sZW5ndGggJiYgdG9TdHJbc2FtZUNoYXJzQ291bnRdID09PSBmcm9tU3RyW3NhbWVDaGFyc0NvdW50XSkgewoJICAgICAgICArK3NhbWVDaGFyc0NvdW50OwoJICAgICAgfQoKCSAgICAgIG9wdHMubWFzayA9IHRvU3RyLnNsaWNlKDAsIHNhbWVDaGFyc0NvdW50KS5yZXBsYWNlKC8wL2csICdcXDAnKSArICcwJy5yZXBlYXQobWF4TGVuZ3RoIC0gc2FtZUNoYXJzQ291bnQpOwoKCSAgICAgIF9nZXQoX2dldFByb3RvdHlwZU9mKE1hc2tlZFJhbmdlLnByb3RvdHlwZSksICJfdXBkYXRlIiwgdGhpcykuY2FsbCh0aGlzLCBvcHRzKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICBAb3ZlcnJpZGUKCSAgICAqLwoKCSAgfSwgewoJICAgIGtleTogImJvdW5kYXJpZXMiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBib3VuZGFyaWVzKHN0cikgewoJICAgICAgdmFyIG1pbnN0ciA9ICcnOwoJICAgICAgdmFyIG1heHN0ciA9ICcnOwoKCSAgICAgIHZhciBfcmVmID0gc3RyLm1hdGNoKC9eKFxEKikoXGQqKShcRCopLykgfHwgW10sCgkgICAgICAgICAgX3JlZjIgPSBfc2xpY2VkVG9BcnJheShfcmVmLCAzKSwKCSAgICAgICAgICBwbGFjZWhvbGRlciA9IF9yZWYyWzFdLAoJICAgICAgICAgIG51bSA9IF9yZWYyWzJdOwoKCSAgICAgIGlmIChudW0pIHsKCSAgICAgICAgbWluc3RyID0gJzAnLnJlcGVhdChwbGFjZWhvbGRlci5sZW5ndGgpICsgbnVtOwoJICAgICAgICBtYXhzdHIgPSAnOScucmVwZWF0KHBsYWNlaG9sZGVyLmxlbmd0aCkgKyBudW07CgkgICAgICB9CgoJICAgICAgbWluc3RyID0gbWluc3RyLnBhZEVuZCh0aGlzLm1heExlbmd0aCwgJzAnKTsKCSAgICAgIG1heHN0ciA9IG1heHN0ci5wYWRFbmQodGhpcy5tYXhMZW5ndGgsICc5Jyk7CgkgICAgICByZXR1cm4gW21pbnN0ciwgbWF4c3RyXTsKCSAgICB9CgkgICAgLyoqCgkgICAgICBAb3ZlcnJpZGUKCSAgICAqLwoKCSAgfSwgewoJICAgIGtleTogImRvUHJlcGFyZSIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGRvUHJlcGFyZShzdHIpIHsKCSAgICAgIHZhciBmbGFncyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CgkgICAgICBzdHIgPSBfZ2V0KF9nZXRQcm90b3R5cGVPZihNYXNrZWRSYW5nZS5wcm90b3R5cGUpLCAiZG9QcmVwYXJlIiwgdGhpcykuY2FsbCh0aGlzLCBzdHIsIGZsYWdzKS5yZXBsYWNlKC9cRC9nLCAnJyk7CgkgICAgICBpZiAoIXRoaXMuYXV0b2ZpeCkgcmV0dXJuIHN0cjsKCSAgICAgIHZhciBmcm9tU3RyID0gU3RyaW5nKHRoaXMuZnJvbSkucGFkU3RhcnQodGhpcy5tYXhMZW5ndGgsICcwJyk7CgkgICAgICB2YXIgdG9TdHIgPSBTdHJpbmcodGhpcy50bykucGFkU3RhcnQodGhpcy5tYXhMZW5ndGgsICcwJyk7CgkgICAgICB2YXIgdmFsID0gdGhpcy52YWx1ZTsKCSAgICAgIHZhciBwcmVwU3RyID0gJyc7CgoJICAgICAgZm9yICh2YXIgY2kgPSAwOyBjaSA8IHN0ci5sZW5ndGg7ICsrY2kpIHsKCSAgICAgICAgdmFyIG5leHRWYWwgPSB2YWwgKyBwcmVwU3RyICsgc3RyW2NpXTsKCgkgICAgICAgIHZhciBfdGhpcyRib3VuZGFyaWVzID0gdGhpcy5ib3VuZGFyaWVzKG5leHRWYWwpLAoJICAgICAgICAgICAgX3RoaXMkYm91bmRhcmllczIgPSBfc2xpY2VkVG9BcnJheShfdGhpcyRib3VuZGFyaWVzLCAyKSwKCSAgICAgICAgICAgIG1pbnN0ciA9IF90aGlzJGJvdW5kYXJpZXMyWzBdLAoJICAgICAgICAgICAgbWF4c3RyID0gX3RoaXMkYm91bmRhcmllczJbMV07CgoJICAgICAgICBpZiAoTnVtYmVyKG1heHN0cikgPCB0aGlzLmZyb20pIHByZXBTdHIgKz0gZnJvbVN0cltuZXh0VmFsLmxlbmd0aCAtIDFdO2Vsc2UgaWYgKE51bWJlcihtaW5zdHIpID4gdGhpcy50bykgcHJlcFN0ciArPSB0b1N0cltuZXh0VmFsLmxlbmd0aCAtIDFdO2Vsc2UgcHJlcFN0ciArPSBzdHJbY2ldOwoJICAgICAgfQoKCSAgICAgIHJldHVybiBwcmVwU3RyOwoJICAgIH0KCSAgICAvKioKCSAgICAgIEBvdmVycmlkZQoJICAgICovCgoJICB9LCB7CgkgICAga2V5OiAiZG9WYWxpZGF0ZSIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGRvVmFsaWRhdGUoKSB7CgkgICAgICB2YXIgX2dldDI7CgoJICAgICAgdmFyIHN0ciA9IHRoaXMudmFsdWU7CgkgICAgICB2YXIgZmlyc3ROb25aZXJvID0gc3RyLnNlYXJjaCgvW14wXS8pOwoJICAgICAgaWYgKGZpcnN0Tm9uWmVybyA9PT0gLTEgJiYgc3RyLmxlbmd0aCA8PSB0aGlzLl9tYXRjaEZyb20pIHJldHVybiB0cnVlOwoKCSAgICAgIHZhciBfdGhpcyRib3VuZGFyaWVzMyA9IHRoaXMuYm91bmRhcmllcyhzdHIpLAoJICAgICAgICAgIF90aGlzJGJvdW5kYXJpZXM0ID0gX3NsaWNlZFRvQXJyYXkoX3RoaXMkYm91bmRhcmllczMsIDIpLAoJICAgICAgICAgIG1pbnN0ciA9IF90aGlzJGJvdW5kYXJpZXM0WzBdLAoJICAgICAgICAgIG1heHN0ciA9IF90aGlzJGJvdW5kYXJpZXM0WzFdOwoKCSAgICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4pLCBfa2V5ID0gMDsgX2tleSA8IF9sZW47IF9rZXkrKykgewoJICAgICAgICBhcmdzW19rZXldID0gYXJndW1lbnRzW19rZXldOwoJICAgICAgfQoKCSAgICAgIHJldHVybiB0aGlzLmZyb20gPD0gTnVtYmVyKG1heHN0cikgJiYgTnVtYmVyKG1pbnN0cikgPD0gdGhpcy50byAmJiAoX2dldDIgPSBfZ2V0KF9nZXRQcm90b3R5cGVPZihNYXNrZWRSYW5nZS5wcm90b3R5cGUpLCAiZG9WYWxpZGF0ZSIsIHRoaXMpKS5jYWxsLmFwcGx5KF9nZXQyLCBbdGhpc10uY29uY2F0KGFyZ3MpKTsKCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICJfbWF0Y2hGcm9tIiwKCgkgICAgLyoqCgkgICAgICBPcHRpb25hbGx5IHNldHMgbWF4IGxlbmd0aCBvZiBwYXR0ZXJuLgoJICAgICAgVXNlZCB3aGVuIHBhdHRlcm4gbGVuZ3RoIGlzIGxvbmdlciB0aGVuIGB0b2AgcGFyYW0gbGVuZ3RoLiBQYWRzIHplcm9zIGF0IHN0YXJ0IGluIHRoaXMgY2FzZS4KCSAgICAqLwoKCSAgICAvKiogTWluIGJvdW5kICovCgoJICAgIC8qKiBNYXggYm91bmQgKi8KCgkgICAgLyoqICovCgkgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkgICAgICByZXR1cm4gdGhpcy5tYXhMZW5ndGggLSBTdHJpbmcodGhpcy5mcm9tKS5sZW5ndGg7CgkgICAgfQoJICB9LCB7CgkgICAga2V5OiAiaXNDb21wbGV0ZSIsCgkgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkgICAgICByZXR1cm4gX2dldChfZ2V0UHJvdG90eXBlT2YoTWFza2VkUmFuZ2UucHJvdG90eXBlKSwgImlzQ29tcGxldGUiLCB0aGlzKSAmJiBCb29sZWFuKHRoaXMudmFsdWUpOwoJICAgIH0KCSAgfV0pOwoKCSAgcmV0dXJuIE1hc2tlZFJhbmdlOwoJfShNYXNrZWRQYXR0ZXJuKTsKCUlNYXNrLk1hc2tlZFJhbmdlID0gTWFza2VkUmFuZ2U7CgoJLyoqIERhdGUgbWFzayAqLwoKCXZhciBNYXNrZWREYXRlID0KCS8qI19fUFVSRV9fKi8KCWZ1bmN0aW9uIChfTWFza2VkUGF0dGVybikgewoJICBfaW5oZXJpdHMoTWFza2VkRGF0ZSwgX01hc2tlZFBhdHRlcm4pOwoKCSAgLyoqIFBhdHRlcm4gbWFzayBmb3IgZGF0ZSBhY2NvcmRpbmcgdG8ge0BsaW5rIE1hc2tlZERhdGUjZm9ybWF0fSAqLwoKCSAgLyoqIFN0YXJ0IGRhdGUgKi8KCgkgIC8qKiBFbmQgZGF0ZSAqLwoKCSAgLyoqICovCgoJICAvKioKCSAgICBAcGFyYW0ge09iamVjdH0gb3B0cwoJICAqLwoJICBmdW5jdGlvbiBNYXNrZWREYXRlKG9wdHMpIHsKCSAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgTWFza2VkRGF0ZSk7CgoJICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoTWFza2VkRGF0ZSkuY2FsbCh0aGlzLCBPYmplY3QuYXNzaWduKHt9LCBNYXNrZWREYXRlLkRFRkFVTFRTLCB7fSwgb3B0cykpKTsKCSAgfQoJICAvKioKCSAgICBAb3ZlcnJpZGUKCSAgKi8KCgoJICBfY3JlYXRlQ2xhc3MoTWFza2VkRGF0ZSwgW3sKCSAgICBrZXk6ICJfdXBkYXRlIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gX3VwZGF0ZShvcHRzKSB7CgkgICAgICBpZiAob3B0cy5tYXNrID09PSBEYXRlKSBkZWxldGUgb3B0cy5tYXNrOwoJICAgICAgaWYgKG9wdHMucGF0dGVybikgb3B0cy5tYXNrID0gb3B0cy5wYXR0ZXJuOwoJICAgICAgdmFyIGJsb2NrcyA9IG9wdHMuYmxvY2tzOwoJICAgICAgb3B0cy5ibG9ja3MgPSBPYmplY3QuYXNzaWduKHt9LCBNYXNrZWREYXRlLkdFVF9ERUZBVUxUX0JMT0NLUygpKTsgLy8gYWRqdXN0IHllYXIgYmxvY2sKCgkgICAgICBpZiAob3B0cy5taW4pIG9wdHMuYmxvY2tzLlkuZnJvbSA9IG9wdHMubWluLmdldEZ1bGxZZWFyKCk7CgkgICAgICBpZiAob3B0cy5tYXgpIG9wdHMuYmxvY2tzLlkudG8gPSBvcHRzLm1heC5nZXRGdWxsWWVhcigpOwoKCSAgICAgIGlmIChvcHRzLm1pbiAmJiBvcHRzLm1heCAmJiBvcHRzLmJsb2Nrcy5ZLmZyb20gPT09IG9wdHMuYmxvY2tzLlkudG8pIHsKCSAgICAgICAgb3B0cy5ibG9ja3MubS5mcm9tID0gb3B0cy5taW4uZ2V0TW9udGgoKSArIDE7CgkgICAgICAgIG9wdHMuYmxvY2tzLm0udG8gPSBvcHRzLm1heC5nZXRNb250aCgpICsgMTsKCgkgICAgICAgIGlmIChvcHRzLmJsb2Nrcy5tLmZyb20gPT09IG9wdHMuYmxvY2tzLm0udG8pIHsKCSAgICAgICAgICBvcHRzLmJsb2Nrcy5kLmZyb20gPSBvcHRzLm1pbi5nZXREYXRlKCk7CgkgICAgICAgICAgb3B0cy5ibG9ja3MuZC50byA9IG9wdHMubWF4LmdldERhdGUoKTsKCSAgICAgICAgfQoJICAgICAgfQoKCSAgICAgIE9iamVjdC5hc3NpZ24ob3B0cy5ibG9ja3MsIGJsb2Nrcyk7IC8vIGFkZCBhdXRvZml4CgoJICAgICAgT2JqZWN0LmtleXMob3B0cy5ibG9ja3MpLmZvckVhY2goZnVuY3Rpb24gKGJrKSB7CgkgICAgICAgIHZhciBiID0gb3B0cy5ibG9ja3NbYmtdOwoJICAgICAgICBpZiAoISgnYXV0b2ZpeCcgaW4gYikpIGIuYXV0b2ZpeCA9IG9wdHMuYXV0b2ZpeDsKCSAgICAgIH0pOwoKCSAgICAgIF9nZXQoX2dldFByb3RvdHlwZU9mKE1hc2tlZERhdGUucHJvdG90eXBlKSwgIl91cGRhdGUiLCB0aGlzKS5jYWxsKHRoaXMsIG9wdHMpOwoJICAgIH0KCSAgICAvKioKCSAgICAgIEBvdmVycmlkZQoJICAgICovCgoJICB9LCB7CgkgICAga2V5OiAiZG9WYWxpZGF0ZSIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGRvVmFsaWRhdGUoKSB7CgkgICAgICB2YXIgX2dldDI7CgoJICAgICAgdmFyIGRhdGUgPSB0aGlzLmRhdGU7CgoJICAgICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbiksIF9rZXkgPSAwOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7CgkgICAgICAgIGFyZ3NbX2tleV0gPSBhcmd1bWVudHNbX2tleV07CgkgICAgICB9CgoJICAgICAgcmV0dXJuIChfZ2V0MiA9IF9nZXQoX2dldFByb3RvdHlwZU9mKE1hc2tlZERhdGUucHJvdG90eXBlKSwgImRvVmFsaWRhdGUiLCB0aGlzKSkuY2FsbC5hcHBseShfZ2V0MiwgW3RoaXNdLmNvbmNhdChhcmdzKSkgJiYgKCF0aGlzLmlzQ29tcGxldGUgfHwgdGhpcy5pc0RhdGVFeGlzdCh0aGlzLnZhbHVlKSAmJiBkYXRlICE9IG51bGwgJiYgKHRoaXMubWluID09IG51bGwgfHwgdGhpcy5taW4gPD0gZGF0ZSkgJiYgKHRoaXMubWF4ID09IG51bGwgfHwgZGF0ZSA8PSB0aGlzLm1heCkpOwoJICAgIH0KCSAgICAvKiogQ2hlY2tzIGlmIGRhdGUgaXMgZXhpc3RzICovCgoJICB9LCB7CgkgICAga2V5OiAiaXNEYXRlRXhpc3QiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBpc0RhdGVFeGlzdChzdHIpIHsKCSAgICAgIHJldHVybiB0aGlzLmZvcm1hdCh0aGlzLnBhcnNlKHN0ciwgdGhpcyksIHRoaXMpLmluZGV4T2Yoc3RyKSA+PSAwOwoJICAgIH0KCSAgICAvKiogUGFyc2VkIERhdGUgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJkYXRlIiwKCSAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCSAgICAgIHJldHVybiB0aGlzLnR5cGVkVmFsdWU7CgkgICAgfSwKCSAgICBzZXQ6IGZ1bmN0aW9uIHNldChkYXRlKSB7CgkgICAgICB0aGlzLnR5cGVkVmFsdWUgPSBkYXRlOwoJICAgIH0KCSAgICAvKioKCSAgICAgIEBvdmVycmlkZQoJICAgICovCgoJICB9LCB7CgkgICAga2V5OiAidHlwZWRWYWx1ZSIsCgkgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkgICAgICByZXR1cm4gdGhpcy5pc0NvbXBsZXRlID8gX2dldChfZ2V0UHJvdG90eXBlT2YoTWFza2VkRGF0ZS5wcm90b3R5cGUpLCAidHlwZWRWYWx1ZSIsIHRoaXMpIDogbnVsbDsKCSAgICB9LAoJICAgIHNldDogZnVuY3Rpb24gc2V0KHZhbHVlKSB7CgkgICAgICBfc2V0KF9nZXRQcm90b3R5cGVPZihNYXNrZWREYXRlLnByb3RvdHlwZSksICJ0eXBlZFZhbHVlIiwgdmFsdWUsIHRoaXMsIHRydWUpOwoJICAgIH0KCSAgfV0pOwoKCSAgcmV0dXJuIE1hc2tlZERhdGU7Cgl9KE1hc2tlZFBhdHRlcm4pOwoJTWFza2VkRGF0ZS5ERUZBVUxUUyA9IHsKCSAgcGF0dGVybjogJ2R7Ln1gbXsufWBZJywKCSAgZm9ybWF0OiBmdW5jdGlvbiBmb3JtYXQoZGF0ZSkgewoJICAgIHZhciBkYXkgPSBTdHJpbmcoZGF0ZS5nZXREYXRlKCkpLnBhZFN0YXJ0KDIsICcwJyk7CgkgICAgdmFyIG1vbnRoID0gU3RyaW5nKGRhdGUuZ2V0TW9udGgoKSArIDEpLnBhZFN0YXJ0KDIsICcwJyk7CgkgICAgdmFyIHllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCk7CgkgICAgcmV0dXJuIFtkYXksIG1vbnRoLCB5ZWFyXS5qb2luKCcuJyk7CgkgIH0sCgkgIHBhcnNlOiBmdW5jdGlvbiBwYXJzZShzdHIpIHsKCSAgICB2YXIgX3N0ciRzcGxpdCA9IHN0ci5zcGxpdCgnLicpLAoJICAgICAgICBfc3RyJHNwbGl0MiA9IF9zbGljZWRUb0FycmF5KF9zdHIkc3BsaXQsIDMpLAoJICAgICAgICBkYXkgPSBfc3RyJHNwbGl0MlswXSwKCSAgICAgICAgbW9udGggPSBfc3RyJHNwbGl0MlsxXSwKCSAgICAgICAgeWVhciA9IF9zdHIkc3BsaXQyWzJdOwoKCSAgICByZXR1cm4gbmV3IERhdGUoeWVhciwgbW9udGggLSAxLCBkYXkpOwoJICB9Cgl9OwoKCU1hc2tlZERhdGUuR0VUX0RFRkFVTFRfQkxPQ0tTID0gZnVuY3Rpb24gKCkgewoJICByZXR1cm4gewoJICAgIGQ6IHsKCSAgICAgIG1hc2s6IE1hc2tlZFJhbmdlLAoJICAgICAgZnJvbTogMSwKCSAgICAgIHRvOiAzMSwKCSAgICAgIG1heExlbmd0aDogMgoJICAgIH0sCgkgICAgbTogewoJICAgICAgbWFzazogTWFza2VkUmFuZ2UsCgkgICAgICBmcm9tOiAxLAoJICAgICAgdG86IDEyLAoJICAgICAgbWF4TGVuZ3RoOiAyCgkgICAgfSwKCSAgICBZOiB7CgkgICAgICBtYXNrOiBNYXNrZWRSYW5nZSwKCSAgICAgIGZyb206IDE5MDAsCgkgICAgICB0bzogOTk5OQoJICAgIH0KCSAgfTsKCX07CgoJSU1hc2suTWFza2VkRGF0ZSA9IE1hc2tlZERhdGU7CgoJLyoqCgkgIEdlbmVyaWMgZWxlbWVudCBBUEkgdG8gdXNlIHdpdGggbWFzawoJICBAaW50ZXJmYWNlCgkqLwoJdmFyIE1hc2tFbGVtZW50ID0KCS8qI19fUFVSRV9fKi8KCWZ1bmN0aW9uICgpIHsKCSAgZnVuY3Rpb24gTWFza0VsZW1lbnQoKSB7CgkgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIE1hc2tFbGVtZW50KTsKCSAgfQoKCSAgX2NyZWF0ZUNsYXNzKE1hc2tFbGVtZW50LCBbewoJICAgIGtleTogInNlbGVjdCIsCgoJICAgIC8qKiBTYWZlbHkgc2V0cyBlbGVtZW50IHNlbGVjdGlvbiAqLwoJICAgIHZhbHVlOiBmdW5jdGlvbiBzZWxlY3Qoc3RhcnQsIGVuZCkgewoJICAgICAgaWYgKHN0YXJ0ID09IG51bGwgfHwgZW5kID09IG51bGwgfHwgc3RhcnQgPT09IHRoaXMuc2VsZWN0aW9uU3RhcnQgJiYgZW5kID09PSB0aGlzLnNlbGVjdGlvbkVuZCkgcmV0dXJuOwoKCSAgICAgIHRyeSB7CgkgICAgICAgIHRoaXMuX3Vuc2FmZVNlbGVjdChzdGFydCwgZW5kKTsKCSAgICAgIH0gY2F0Y2ggKGUpIHt9CgkgICAgfQoJICAgIC8qKiBTaG91bGQgYmUgb3ZlcnJpZGVuIGluIHN1YmNsYXNzZXMgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJfdW5zYWZlU2VsZWN0IiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gX3Vuc2FmZVNlbGVjdChzdGFydCwgZW5kKSB7fQoJICAgIC8qKiBTaG91bGQgYmUgb3ZlcnJpZGVuIGluIHN1YmNsYXNzZXMgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJiaW5kRXZlbnRzIiwKCgkgICAgLyoqIFNob3VsZCBiZSBvdmVycmlkZW4gaW4gc3ViY2xhc3NlcyAqLwoJICAgIHZhbHVlOiBmdW5jdGlvbiBiaW5kRXZlbnRzKGhhbmRsZXJzKSB7fQoJICAgIC8qKiBTaG91bGQgYmUgb3ZlcnJpZGVuIGluIHN1YmNsYXNzZXMgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJ1bmJpbmRFdmVudHMiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiB1bmJpbmRFdmVudHMoKSB7fQoJICB9LCB7CgkgICAga2V5OiAic2VsZWN0aW9uU3RhcnQiLAoKCSAgICAvKiogKi8KCgkgICAgLyoqICovCgoJICAgIC8qKiAqLwoKCSAgICAvKiogU2FmZWx5IHJldHVybnMgc2VsZWN0aW9uIHN0YXJ0ICovCgkgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkgICAgICB2YXIgc3RhcnQ7CgoJICAgICAgdHJ5IHsKCSAgICAgICAgc3RhcnQgPSB0aGlzLl91bnNhZmVTZWxlY3Rpb25TdGFydDsKCSAgICAgIH0gY2F0Y2ggKGUpIHt9CgoJICAgICAgcmV0dXJuIHN0YXJ0ICE9IG51bGwgPyBzdGFydCA6IHRoaXMudmFsdWUubGVuZ3RoOwoJICAgIH0KCSAgICAvKiogU2FmZWx5IHJldHVybnMgc2VsZWN0aW9uIGVuZCAqLwoKCSAgfSwgewoJICAgIGtleTogInNlbGVjdGlvbkVuZCIsCgkgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkgICAgICB2YXIgZW5kOwoKCSAgICAgIHRyeSB7CgkgICAgICAgIGVuZCA9IHRoaXMuX3Vuc2FmZVNlbGVjdGlvbkVuZDsKCSAgICAgIH0gY2F0Y2ggKGUpIHt9CgoJICAgICAgcmV0dXJuIGVuZCAhPSBudWxsID8gZW5kIDogdGhpcy52YWx1ZS5sZW5ndGg7CgkgICAgfQoJICB9LCB7CgkgICAga2V5OiAiaXNBY3RpdmUiLAoJICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewoJICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH0KCSAgfV0pOwoKCSAgcmV0dXJuIE1hc2tFbGVtZW50OwoJfSgpOwoJSU1hc2suTWFza0VsZW1lbnQgPSBNYXNrRWxlbWVudDsKCgkvKiogQnJpZGdlIGJldHdlZW4gSFRNTEVsZW1lbnQgYW5kIHtAbGluayBNYXNrZWR9ICovCgoJdmFyIEhUTUxNYXNrRWxlbWVudCA9CgkvKiNfX1BVUkVfXyovCglmdW5jdGlvbiAoX01hc2tFbGVtZW50KSB7CgkgIF9pbmhlcml0cyhIVE1MTWFza0VsZW1lbnQsIF9NYXNrRWxlbWVudCk7CgoJICAvKiogTWFwcGluZyBiZXR3ZWVuIEhUTUxFbGVtZW50IGV2ZW50cyBhbmQgbWFzayBpbnRlcm5hbCBldmVudHMgKi8KCgkgIC8qKiBIVE1MRWxlbWVudCB0byB1c2UgbWFzayBvbiAqLwoKCSAgLyoqCgkgICAgQHBhcmFtIHtIVE1MSW5wdXRFbGVtZW50fEhUTUxUZXh0QXJlYUVsZW1lbnR9IGlucHV0CgkgICovCgkgIGZ1bmN0aW9uIEhUTUxNYXNrRWxlbWVudChpbnB1dCkgewoJICAgIHZhciBfdGhpczsKCgkgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEhUTUxNYXNrRWxlbWVudCk7CgoJICAgIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKEhUTUxNYXNrRWxlbWVudCkuY2FsbCh0aGlzKSk7CgkgICAgX3RoaXMuaW5wdXQgPSBpbnB1dDsKCSAgICBfdGhpcy5faGFuZGxlcnMgPSB7fTsKCSAgICByZXR1cm4gX3RoaXM7CgkgIH0KCSAgLyoqICovCgkgIC8vICRGbG93Rml4TWUgaHR0cHM6Ly9naXRodWIuY29tL2ZhY2Vib29rL2Zsb3cvaXNzdWVzLzI4MzkKCgoJICBfY3JlYXRlQ2xhc3MoSFRNTE1hc2tFbGVtZW50LCBbewoJICAgIGtleTogIl91bnNhZmVTZWxlY3QiLAoKCSAgICAvKioKCSAgICAgIFNldHMgSFRNTEVsZW1lbnQgc2VsZWN0aW9uCgkgICAgICBAb3ZlcnJpZGUKCSAgICAqLwoJICAgIHZhbHVlOiBmdW5jdGlvbiBfdW5zYWZlU2VsZWN0KHN0YXJ0LCBlbmQpIHsKCSAgICAgIHRoaXMuaW5wdXQuc2V0U2VsZWN0aW9uUmFuZ2Uoc3RhcnQsIGVuZCk7CgkgICAgfQoJICAgIC8qKgoJICAgICAgSFRNTEVsZW1lbnQgdmFsdWUKCSAgICAgIEBvdmVycmlkZQoJICAgICovCgoJICB9LCB7CgkgICAga2V5OiAiYmluZEV2ZW50cyIsCgoJICAgIC8qKgoJICAgICAgQmluZHMgSFRNTEVsZW1lbnQgZXZlbnRzIHRvIG1hc2sgaW50ZXJuYWwgZXZlbnRzCgkgICAgICBAb3ZlcnJpZGUKCSAgICAqLwoJICAgIHZhbHVlOiBmdW5jdGlvbiBiaW5kRXZlbnRzKGhhbmRsZXJzKSB7CgkgICAgICB2YXIgX3RoaXMyID0gdGhpczsKCgkgICAgICBPYmplY3Qua2V5cyhoYW5kbGVycykuZm9yRWFjaChmdW5jdGlvbiAoZXZlbnQpIHsKCSAgICAgICAgcmV0dXJuIF90aGlzMi5fdG9nZ2xlRXZlbnRIYW5kbGVyKEhUTUxNYXNrRWxlbWVudC5FVkVOVFNfTUFQW2V2ZW50XSwgaGFuZGxlcnNbZXZlbnRdKTsKCSAgICAgIH0pOwoJICAgIH0KCSAgICAvKioKCSAgICAgIFVuYmluZHMgSFRNTEVsZW1lbnQgZXZlbnRzIHRvIG1hc2sgaW50ZXJuYWwgZXZlbnRzCgkgICAgICBAb3ZlcnJpZGUKCSAgICAqLwoKCSAgfSwgewoJICAgIGtleTogInVuYmluZEV2ZW50cyIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIHVuYmluZEV2ZW50cygpIHsKCSAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKCSAgICAgIE9iamVjdC5rZXlzKHRoaXMuX2hhbmRsZXJzKS5mb3JFYWNoKGZ1bmN0aW9uIChldmVudCkgewoJICAgICAgICByZXR1cm4gX3RoaXMzLl90b2dnbGVFdmVudEhhbmRsZXIoZXZlbnQpOwoJICAgICAgfSk7CgkgICAgfQoJICAgIC8qKiAqLwoKCSAgfSwgewoJICAgIGtleTogIl90b2dnbGVFdmVudEhhbmRsZXIiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBfdG9nZ2xlRXZlbnRIYW5kbGVyKGV2ZW50LCBoYW5kbGVyKSB7CgkgICAgICBpZiAodGhpcy5faGFuZGxlcnNbZXZlbnRdKSB7CgkgICAgICAgIHRoaXMuaW5wdXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudCwgdGhpcy5faGFuZGxlcnNbZXZlbnRdKTsKCSAgICAgICAgZGVsZXRlIHRoaXMuX2hhbmRsZXJzW2V2ZW50XTsKCSAgICAgIH0KCgkgICAgICBpZiAoaGFuZGxlcikgewoJICAgICAgICB0aGlzLmlucHV0LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnQsIGhhbmRsZXIpOwoJICAgICAgICB0aGlzLl9oYW5kbGVyc1tldmVudF0gPSBoYW5kbGVyOwoJICAgICAgfQoJICAgIH0KCSAgfSwgewoJICAgIGtleTogInJvb3RFbGVtZW50IiwKCSAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCSAgICAgIHJldHVybiB0aGlzLmlucHV0LmdldFJvb3ROb2RlID8gdGhpcy5pbnB1dC5nZXRSb290Tm9kZSgpIDogZG9jdW1lbnQ7CgkgICAgfQoJICAgIC8qKgoJICAgICAgSXMgZWxlbWVudCBpbiBmb2N1cwoJICAgICAgQHJlYWRvbmx5CgkgICAgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJpc0FjdGl2ZSIsCgkgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkgICAgICAvLyRGbG93Rml4TWUKCSAgICAgIHJldHVybiB0aGlzLmlucHV0ID09PSB0aGlzLnJvb3RFbGVtZW50LmFjdGl2ZUVsZW1lbnQ7CgkgICAgfQoJICAgIC8qKgoJICAgICAgUmV0dXJucyBIVE1MRWxlbWVudCBzZWxlY3Rpb24gc3RhcnQKCSAgICAgIEBvdmVycmlkZQoJICAgICovCgoJICB9LCB7CgkgICAga2V5OiAiX3Vuc2FmZVNlbGVjdGlvblN0YXJ0IiwKCSAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCSAgICAgIHJldHVybiB0aGlzLmlucHV0LnNlbGVjdGlvblN0YXJ0OwoJICAgIH0KCSAgICAvKioKCSAgICAgIFJldHVybnMgSFRNTEVsZW1lbnQgc2VsZWN0aW9uIGVuZAoJICAgICAgQG92ZXJyaWRlCgkgICAgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJfdW5zYWZlU2VsZWN0aW9uRW5kIiwKCSAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCSAgICAgIHJldHVybiB0aGlzLmlucHV0LnNlbGVjdGlvbkVuZDsKCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICJ2YWx1ZSIsCgkgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkgICAgICByZXR1cm4gdGhpcy5pbnB1dC52YWx1ZTsKCSAgICB9LAoJICAgIHNldDogZnVuY3Rpb24gc2V0KHZhbHVlKSB7CgkgICAgICB0aGlzLmlucHV0LnZhbHVlID0gdmFsdWU7CgkgICAgfQoJICB9XSk7CgoJICByZXR1cm4gSFRNTE1hc2tFbGVtZW50OwoJfShNYXNrRWxlbWVudCk7CglIVE1MTWFza0VsZW1lbnQuRVZFTlRTX01BUCA9IHsKCSAgc2VsZWN0aW9uQ2hhbmdlOiAna2V5ZG93bicsCgkgIGlucHV0OiAnaW5wdXQnLAoJICBkcm9wOiAnZHJvcCcsCgkgIGNsaWNrOiAnY2xpY2snLAoJICBmb2N1czogJ2ZvY3VzJywKCSAgY29tbWl0OiAnYmx1cicKCX07CglJTWFzay5IVE1MTWFza0VsZW1lbnQgPSBIVE1MTWFza0VsZW1lbnQ7CgoJdmFyIEhUTUxDb250ZW50ZWRpdGFibGVNYXNrRWxlbWVudCA9CgkvKiNfX1BVUkVfXyovCglmdW5jdGlvbiAoX0hUTUxNYXNrRWxlbWVudCkgewoJICBfaW5oZXJpdHMoSFRNTENvbnRlbnRlZGl0YWJsZU1hc2tFbGVtZW50LCBfSFRNTE1hc2tFbGVtZW50KTsKCgkgIGZ1bmN0aW9uIEhUTUxDb250ZW50ZWRpdGFibGVNYXNrRWxlbWVudCgpIHsKCSAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgSFRNTENvbnRlbnRlZGl0YWJsZU1hc2tFbGVtZW50KTsKCgkgICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihIVE1MQ29udGVudGVkaXRhYmxlTWFza0VsZW1lbnQpLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpOwoJICB9CgoJICBfY3JlYXRlQ2xhc3MoSFRNTENvbnRlbnRlZGl0YWJsZU1hc2tFbGVtZW50LCBbewoJICAgIGtleTogIl91bnNhZmVTZWxlY3QiLAoKCSAgICAvKioKCSAgICAgIFNldHMgSFRNTEVsZW1lbnQgc2VsZWN0aW9uCgkgICAgICBAb3ZlcnJpZGUKCSAgICAqLwoJICAgIHZhbHVlOiBmdW5jdGlvbiBfdW5zYWZlU2VsZWN0KHN0YXJ0LCBlbmQpIHsKCSAgICAgIGlmICghdGhpcy5yb290RWxlbWVudC5jcmVhdGVSYW5nZSkgcmV0dXJuOwoJICAgICAgdmFyIHJhbmdlID0gdGhpcy5yb290RWxlbWVudC5jcmVhdGVSYW5nZSgpOwoJICAgICAgcmFuZ2Uuc2V0U3RhcnQodGhpcy5pbnB1dC5maXJzdENoaWxkIHx8IHRoaXMuaW5wdXQsIHN0YXJ0KTsKCSAgICAgIHJhbmdlLnNldEVuZCh0aGlzLmlucHV0Lmxhc3RDaGlsZCB8fCB0aGlzLmlucHV0LCBlbmQpOwoJICAgICAgdmFyIHJvb3QgPSB0aGlzLnJvb3RFbGVtZW50OwoJICAgICAgdmFyIHNlbGVjdGlvbiA9IHJvb3QuZ2V0U2VsZWN0aW9uICYmIHJvb3QuZ2V0U2VsZWN0aW9uKCk7CgoJICAgICAgaWYgKHNlbGVjdGlvbikgewoJICAgICAgICBzZWxlY3Rpb24ucmVtb3ZlQWxsUmFuZ2VzKCk7CgkgICAgICAgIHNlbGVjdGlvbi5hZGRSYW5nZShyYW5nZSk7CgkgICAgICB9CgkgICAgfQoJICAgIC8qKgoJICAgICAgSFRNTEVsZW1lbnQgdmFsdWUKCSAgICAgIEBvdmVycmlkZQoJICAgICovCgoJICB9LCB7CgkgICAga2V5OiAiX3Vuc2FmZVNlbGVjdGlvblN0YXJ0IiwKCgkgICAgLyoqCgkgICAgICBSZXR1cm5zIEhUTUxFbGVtZW50IHNlbGVjdGlvbiBzdGFydAoJICAgICAgQG92ZXJyaWRlCgkgICAgKi8KCSAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCSAgICAgIHZhciByb290ID0gdGhpcy5yb290RWxlbWVudDsKCSAgICAgIHZhciBzZWxlY3Rpb24gPSByb290LmdldFNlbGVjdGlvbiAmJiByb290LmdldFNlbGVjdGlvbigpOwoJICAgICAgcmV0dXJuIHNlbGVjdGlvbiAmJiBzZWxlY3Rpb24uYW5jaG9yT2Zmc2V0OwoJICAgIH0KCSAgICAvKioKCSAgICAgIFJldHVybnMgSFRNTEVsZW1lbnQgc2VsZWN0aW9uIGVuZAoJICAgICAgQG92ZXJyaWRlCgkgICAgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJfdW5zYWZlU2VsZWN0aW9uRW5kIiwKCSAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCSAgICAgIHZhciByb290ID0gdGhpcy5yb290RWxlbWVudDsKCSAgICAgIHZhciBzZWxlY3Rpb24gPSByb290LmdldFNlbGVjdGlvbiAmJiByb290LmdldFNlbGVjdGlvbigpOwoJICAgICAgcmV0dXJuIHNlbGVjdGlvbiAmJiB0aGlzLl91bnNhZmVTZWxlY3Rpb25TdGFydCArIFN0cmluZyhzZWxlY3Rpb24pLmxlbmd0aDsKCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICJ2YWx1ZSIsCgkgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkgICAgICAvLyAkRmxvd0ZpeE1lCgkgICAgICByZXR1cm4gdGhpcy5pbnB1dC50ZXh0Q29udGVudDsKCSAgICB9LAoJICAgIHNldDogZnVuY3Rpb24gc2V0KHZhbHVlKSB7CgkgICAgICB0aGlzLmlucHV0LnRleHRDb250ZW50ID0gdmFsdWU7CgkgICAgfQoJICB9XSk7CgoJICByZXR1cm4gSFRNTENvbnRlbnRlZGl0YWJsZU1hc2tFbGVtZW50OwoJfShIVE1MTWFza0VsZW1lbnQpOwoJSU1hc2suSFRNTENvbnRlbnRlZGl0YWJsZU1hc2tFbGVtZW50ID0gSFRNTENvbnRlbnRlZGl0YWJsZU1hc2tFbGVtZW50OwoKCS8qKiBMaXN0ZW5zIHRvIGVsZW1lbnQgZXZlbnRzIGFuZCBjb250cm9scyBjaGFuZ2VzIGJldHdlZW4gZWxlbWVudCBhbmQge0BsaW5rIE1hc2tlZH0gKi8KCgl2YXIgSW5wdXRNYXNrID0KCS8qI19fUFVSRV9fKi8KCWZ1bmN0aW9uICgpIHsKCSAgLyoqCgkgICAgVmlldyBlbGVtZW50CgkgICAgQHJlYWRvbmx5CgkgICovCgoJICAvKioKCSAgICBJbnRlcm5hbCB7QGxpbmsgTWFza2VkfSBtb2RlbAoJICAgIEByZWFkb25seQoJICAqLwoKCSAgLyoqCgkgICAgQHBhcmFtIHtNYXNrRWxlbWVudHxIVE1MSW5wdXRFbGVtZW50fEhUTUxUZXh0QXJlYUVsZW1lbnR9IGVsCgkgICAgQHBhcmFtIHtPYmplY3R9IG9wdHMKCSAgKi8KCSAgZnVuY3Rpb24gSW5wdXRNYXNrKGVsLCBvcHRzKSB7CgkgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIElucHV0TWFzayk7CgoJICAgIHRoaXMuZWwgPSBlbCBpbnN0YW5jZW9mIE1hc2tFbGVtZW50ID8gZWwgOiBlbC5pc0NvbnRlbnRFZGl0YWJsZSAmJiBlbC50YWdOYW1lICE9PSAnSU5QVVQnICYmIGVsLnRhZ05hbWUgIT09ICdURVhUQVJFQScgPyBuZXcgSFRNTENvbnRlbnRlZGl0YWJsZU1hc2tFbGVtZW50KGVsKSA6IG5ldyBIVE1MTWFza0VsZW1lbnQoZWwpOwoJICAgIHRoaXMubWFza2VkID0gY3JlYXRlTWFzayhvcHRzKTsKCSAgICB0aGlzLl9saXN0ZW5lcnMgPSB7fTsKCSAgICB0aGlzLl92YWx1ZSA9ICcnOwoJICAgIHRoaXMuX3VubWFza2VkVmFsdWUgPSAnJzsKCSAgICB0aGlzLl9zYXZlU2VsZWN0aW9uID0gdGhpcy5fc2F2ZVNlbGVjdGlvbi5iaW5kKHRoaXMpOwoJICAgIHRoaXMuX29uSW5wdXQgPSB0aGlzLl9vbklucHV0LmJpbmQodGhpcyk7CgkgICAgdGhpcy5fb25DaGFuZ2UgPSB0aGlzLl9vbkNoYW5nZS5iaW5kKHRoaXMpOwoJICAgIHRoaXMuX29uRHJvcCA9IHRoaXMuX29uRHJvcC5iaW5kKHRoaXMpOwoJICAgIHRoaXMuX29uRm9jdXMgPSB0aGlzLl9vbkZvY3VzLmJpbmQodGhpcyk7CgkgICAgdGhpcy5fb25DbGljayA9IHRoaXMuX29uQ2xpY2suYmluZCh0aGlzKTsKCSAgICB0aGlzLmFsaWduQ3Vyc29yID0gdGhpcy5hbGlnbkN1cnNvci5iaW5kKHRoaXMpOwoJICAgIHRoaXMuYWxpZ25DdXJzb3JGcmllbmRseSA9IHRoaXMuYWxpZ25DdXJzb3JGcmllbmRseS5iaW5kKHRoaXMpOwoKCSAgICB0aGlzLl9iaW5kRXZlbnRzKCk7IC8vIHJlZnJlc2gKCgoJICAgIHRoaXMudXBkYXRlVmFsdWUoKTsKCgkgICAgdGhpcy5fb25DaGFuZ2UoKTsKCSAgfQoJICAvKiogUmVhZCBvciB1cGRhdGUgbWFzayAqLwoKCgkgIF9jcmVhdGVDbGFzcyhJbnB1dE1hc2ssIFt7CgkgICAga2V5OiAibWFza0VxdWFscyIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIG1hc2tFcXVhbHMobWFzaykgewoJICAgICAgcmV0dXJuIG1hc2sgPT0gbnVsbCB8fCBtYXNrID09PSB0aGlzLm1hc2tlZC5tYXNrIHx8IG1hc2sgPT09IERhdGUgJiYgdGhpcy5tYXNrZWQgaW5zdGFuY2VvZiBNYXNrZWREYXRlOwoJICAgIH0KCSAgfSwgewoJICAgIGtleTogIl9iaW5kRXZlbnRzIiwKCgkgICAgLyoqCgkgICAgICBTdGFydHMgbGlzdGVuaW5nIHRvIGVsZW1lbnQgZXZlbnRzCgkgICAgICBAcHJvdGVjdGVkCgkgICAgKi8KCSAgICB2YWx1ZTogZnVuY3Rpb24gX2JpbmRFdmVudHMoKSB7CgkgICAgICB0aGlzLmVsLmJpbmRFdmVudHMoewoJICAgICAgICBzZWxlY3Rpb25DaGFuZ2U6IHRoaXMuX3NhdmVTZWxlY3Rpb24sCgkgICAgICAgIGlucHV0OiB0aGlzLl9vbklucHV0LAoJICAgICAgICBkcm9wOiB0aGlzLl9vbkRyb3AsCgkgICAgICAgIGNsaWNrOiB0aGlzLl9vbkNsaWNrLAoJICAgICAgICBmb2N1czogdGhpcy5fb25Gb2N1cywKCSAgICAgICAgY29tbWl0OiB0aGlzLl9vbkNoYW5nZQoJICAgICAgfSk7CgkgICAgfQoJICAgIC8qKgoJICAgICAgU3RvcHMgbGlzdGVuaW5nIHRvIGVsZW1lbnQgZXZlbnRzCgkgICAgICBAcHJvdGVjdGVkCgkgICAgICovCgoJICB9LCB7CgkgICAga2V5OiAiX3VuYmluZEV2ZW50cyIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIF91bmJpbmRFdmVudHMoKSB7CgkgICAgICBpZiAodGhpcy5lbCkgdGhpcy5lbC51bmJpbmRFdmVudHMoKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICBGaXJlcyBjdXN0b20gZXZlbnQKCSAgICAgIEBwcm90ZWN0ZWQKCSAgICAgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJfZmlyZUV2ZW50IiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gX2ZpcmVFdmVudChldikgewoJICAgICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbiA+IDEgPyBfbGVuIC0gMSA6IDApLCBfa2V5ID0gMTsgX2tleSA8IF9sZW47IF9rZXkrKykgewoJICAgICAgICBhcmdzW19rZXkgLSAxXSA9IGFyZ3VtZW50c1tfa2V5XTsKCSAgICAgIH0KCgkgICAgICB2YXIgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzW2V2XTsKCSAgICAgIGlmICghbGlzdGVuZXJzKSByZXR1cm47CgkgICAgICBsaXN0ZW5lcnMuZm9yRWFjaChmdW5jdGlvbiAobCkgewoJICAgICAgICByZXR1cm4gbC5hcHBseSh2b2lkIDAsIGFyZ3MpOwoJICAgICAgfSk7CgkgICAgfQoJICAgIC8qKgoJICAgICAgQ3VycmVudCBzZWxlY3Rpb24gc3RhcnQKCSAgICAgIEByZWFkb25seQoJICAgICovCgoJICB9LCB7CgkgICAga2V5OiAiX3NhdmVTZWxlY3Rpb24iLAoKCSAgICAvKioKCSAgICAgIFN0b3JlcyBjdXJyZW50IHNlbGVjdGlvbgoJICAgICAgQHByb3RlY3RlZAoJICAgICovCgkgICAgdmFsdWU6IGZ1bmN0aW9uIF9zYXZlU2VsZWN0aW9uKCkKCSAgICAvKiBldiAqLwoJICAgIHsKCSAgICAgIGlmICh0aGlzLnZhbHVlICE9PSB0aGlzLmVsLnZhbHVlKSB7CgkgICAgICAgIGNvbnNvbGUud2FybignRWxlbWVudCB2YWx1ZSB3YXMgY2hhbmdlZCBvdXRzaWRlIG9mIG1hc2suIFN5bmNyb25pemUgbWFzayB1c2luZyBgbWFzay51cGRhdGVWYWx1ZSgpYCB0byB3b3JrIHByb3Blcmx5LicpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKCSAgICAgIH0KCgkgICAgICB0aGlzLl9zZWxlY3Rpb24gPSB7CgkgICAgICAgIHN0YXJ0OiB0aGlzLnNlbGVjdGlvblN0YXJ0LAoJICAgICAgICBlbmQ6IHRoaXMuY3Vyc29yUG9zCgkgICAgICB9OwoJICAgIH0KCSAgICAvKiogU3luY3Jvbml6ZXMgbW9kZWwgdmFsdWUgZnJvbSB2aWV3ICovCgoJICB9LCB7CgkgICAga2V5OiAidXBkYXRlVmFsdWUiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVWYWx1ZSgpIHsKCSAgICAgIHRoaXMubWFza2VkLnZhbHVlID0gdGhpcy5lbC52YWx1ZTsKCSAgICAgIHRoaXMuX3ZhbHVlID0gdGhpcy5tYXNrZWQudmFsdWU7CgkgICAgfQoJICAgIC8qKiBTeW5jcm9uaXplcyB2aWV3IGZyb20gbW9kZWwgdmFsdWUsIGZpcmVzIGNoYW5nZSBldmVudHMgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJ1cGRhdGVDb250cm9sIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlQ29udHJvbCgpIHsKCSAgICAgIHZhciBuZXdVbm1hc2tlZFZhbHVlID0gdGhpcy5tYXNrZWQudW5tYXNrZWRWYWx1ZTsKCSAgICAgIHZhciBuZXdWYWx1ZSA9IHRoaXMubWFza2VkLnZhbHVlOwoJICAgICAgdmFyIGlzQ2hhbmdlZCA9IHRoaXMudW5tYXNrZWRWYWx1ZSAhPT0gbmV3VW5tYXNrZWRWYWx1ZSB8fCB0aGlzLnZhbHVlICE9PSBuZXdWYWx1ZTsKCSAgICAgIHRoaXMuX3VubWFza2VkVmFsdWUgPSBuZXdVbm1hc2tlZFZhbHVlOwoJICAgICAgdGhpcy5fdmFsdWUgPSBuZXdWYWx1ZTsKCSAgICAgIGlmICh0aGlzLmVsLnZhbHVlICE9PSBuZXdWYWx1ZSkgdGhpcy5lbC52YWx1ZSA9IG5ld1ZhbHVlOwoJICAgICAgaWYgKGlzQ2hhbmdlZCkgdGhpcy5fZmlyZUNoYW5nZUV2ZW50cygpOwoJICAgIH0KCSAgICAvKiogVXBkYXRlcyBvcHRpb25zIHdpdGggZGVlcCBlcXVhbCBjaGVjaywgcmVjcmVhdGVzIEB7bGluayBNYXNrZWR9IG1vZGVsIGlmIG1hc2sgdHlwZSBjaGFuZ2VzICovCgoJICB9LCB7CgkgICAga2V5OiAidXBkYXRlT3B0aW9ucyIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZU9wdGlvbnMob3B0cykgewoJICAgICAgdmFyIG1hc2sgPSBvcHRzLm1hc2ssCgkgICAgICAgICAgcmVzdE9wdHMgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMob3B0cywgWyJtYXNrIl0pOwoKCSAgICAgIHZhciB1cGRhdGVNYXNrID0gIXRoaXMubWFza0VxdWFscyhtYXNrKTsKCSAgICAgIHZhciB1cGRhdGVPcHRzID0gIW9iamVjdEluY2x1ZGVzKHRoaXMubWFza2VkLCByZXN0T3B0cyk7CgkgICAgICBpZiAodXBkYXRlTWFzaykgdGhpcy5tYXNrID0gbWFzazsKCSAgICAgIGlmICh1cGRhdGVPcHRzKSB0aGlzLm1hc2tlZC51cGRhdGVPcHRpb25zKHJlc3RPcHRzKTsKCSAgICAgIGlmICh1cGRhdGVNYXNrIHx8IHVwZGF0ZU9wdHMpIHRoaXMudXBkYXRlQ29udHJvbCgpOwoJICAgIH0KCSAgICAvKiogVXBkYXRlcyBjdXJzb3IgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJ1cGRhdGVDdXJzb3IiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVDdXJzb3IoY3Vyc29yUG9zKSB7CgkgICAgICBpZiAoY3Vyc29yUG9zID09IG51bGwpIHJldHVybjsKCSAgICAgIHRoaXMuY3Vyc29yUG9zID0gY3Vyc29yUG9zOyAvLyBhbHNvIHF1ZXVlIGNoYW5nZSBjdXJzb3IgZm9yIG1vYmlsZSBicm93c2VycwoKCSAgICAgIHRoaXMuX2RlbGF5VXBkYXRlQ3Vyc29yKGN1cnNvclBvcyk7CgkgICAgfQoJICAgIC8qKgoJICAgICAgRGVsYXlzIGN1cnNvciB1cGRhdGUgdG8gc3VwcG9ydCBtb2JpbGUgYnJvd3NlcnMKCSAgICAgIEBwcml2YXRlCgkgICAgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJfZGVsYXlVcGRhdGVDdXJzb3IiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBfZGVsYXlVcGRhdGVDdXJzb3IoY3Vyc29yUG9zKSB7CgkgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKCSAgICAgIHRoaXMuX2Fib3J0VXBkYXRlQ3Vyc29yKCk7CgoJICAgICAgdGhpcy5fY2hhbmdpbmdDdXJzb3JQb3MgPSBjdXJzb3JQb3M7CgkgICAgICB0aGlzLl9jdXJzb3JDaGFuZ2luZyA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewoJICAgICAgICBpZiAoIV90aGlzLmVsKSByZXR1cm47IC8vIGlmIHdhcyBkZXN0cm95ZWQKCgkgICAgICAgIF90aGlzLmN1cnNvclBvcyA9IF90aGlzLl9jaGFuZ2luZ0N1cnNvclBvczsKCgkgICAgICAgIF90aGlzLl9hYm9ydFVwZGF0ZUN1cnNvcigpOwoJICAgICAgfSwgMTApOwoJICAgIH0KCSAgICAvKioKCSAgICAgIEZpcmVzIGN1c3RvbSBldmVudHMKCSAgICAgIEBwcm90ZWN0ZWQKCSAgICAqLwoKCSAgfSwgewoJICAgIGtleTogIl9maXJlQ2hhbmdlRXZlbnRzIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gX2ZpcmVDaGFuZ2VFdmVudHMoKSB7CgkgICAgICB0aGlzLl9maXJlRXZlbnQoJ2FjY2VwdCcsIHRoaXMuX2lucHV0RXZlbnQpOwoKCSAgICAgIGlmICh0aGlzLm1hc2tlZC5pc0NvbXBsZXRlKSB0aGlzLl9maXJlRXZlbnQoJ2NvbXBsZXRlJywgdGhpcy5faW5wdXRFdmVudCk7CgkgICAgfQoJICAgIC8qKgoJICAgICAgQWJvcnRzIGRlbGF5ZWQgY3Vyc29yIHVwZGF0ZQoJICAgICAgQHByaXZhdGUKCSAgICAqLwoKCSAgfSwgewoJICAgIGtleTogIl9hYm9ydFVwZGF0ZUN1cnNvciIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIF9hYm9ydFVwZGF0ZUN1cnNvcigpIHsKCSAgICAgIGlmICh0aGlzLl9jdXJzb3JDaGFuZ2luZykgewoJICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5fY3Vyc29yQ2hhbmdpbmcpOwoJICAgICAgICBkZWxldGUgdGhpcy5fY3Vyc29yQ2hhbmdpbmc7CgkgICAgICB9CgkgICAgfQoJICAgIC8qKiBBbGlnbnMgY3Vyc29yIHRvIG5lYXJlc3QgYXZhaWxhYmxlIHBvc2l0aW9uICovCgoJICB9LCB7CgkgICAga2V5OiAiYWxpZ25DdXJzb3IiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBhbGlnbkN1cnNvcigpIHsKCSAgICAgIHRoaXMuY3Vyc29yUG9zID0gdGhpcy5tYXNrZWQubmVhcmVzdElucHV0UG9zKHRoaXMuY3Vyc29yUG9zLCBESVJFQ1RJT04uTEVGVCk7CgkgICAgfQoJICAgIC8qKiBBbGlnbnMgY3Vyc29yIG9ubHkgaWYgc2VsZWN0aW9uIGlzIGVtcHR5ICovCgoJICB9LCB7CgkgICAga2V5OiAiYWxpZ25DdXJzb3JGcmllbmRseSIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGFsaWduQ3Vyc29yRnJpZW5kbHkoKSB7CgkgICAgICBpZiAodGhpcy5zZWxlY3Rpb25TdGFydCAhPT0gdGhpcy5jdXJzb3JQb3MpIHJldHVybjsgLy8gc2tpcCBpZiByYW5nZSBpcyBzZWxlY3RlZAoKCSAgICAgIHRoaXMuYWxpZ25DdXJzb3IoKTsKCSAgICB9CgkgICAgLyoqIEFkZHMgbGlzdGVuZXIgb24gY3VzdG9tIGV2ZW50ICovCgoJICB9LCB7CgkgICAga2V5OiAib24iLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBvbihldiwgaGFuZGxlcikgewoJICAgICAgaWYgKCF0aGlzLl9saXN0ZW5lcnNbZXZdKSB0aGlzLl9saXN0ZW5lcnNbZXZdID0gW107CgoJICAgICAgdGhpcy5fbGlzdGVuZXJzW2V2XS5wdXNoKGhhbmRsZXIpOwoKCSAgICAgIHJldHVybiB0aGlzOwoJICAgIH0KCSAgICAvKiogUmVtb3ZlcyBjdXN0b20gZXZlbnQgbGlzdGVuZXIgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJvZmYiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBvZmYoZXYsIGhhbmRsZXIpIHsKCSAgICAgIGlmICghdGhpcy5fbGlzdGVuZXJzW2V2XSkgcmV0dXJuIHRoaXM7CgoJICAgICAgaWYgKCFoYW5kbGVyKSB7CgkgICAgICAgIGRlbGV0ZSB0aGlzLl9saXN0ZW5lcnNbZXZdOwoJICAgICAgICByZXR1cm4gdGhpczsKCSAgICAgIH0KCgkgICAgICB2YXIgaEluZGV4ID0gdGhpcy5fbGlzdGVuZXJzW2V2XS5pbmRleE9mKGhhbmRsZXIpOwoKCSAgICAgIGlmIChoSW5kZXggPj0gMCkgdGhpcy5fbGlzdGVuZXJzW2V2XS5zcGxpY2UoaEluZGV4LCAxKTsKCSAgICAgIHJldHVybiB0aGlzOwoJICAgIH0KCSAgICAvKiogSGFuZGxlcyB2aWV3IGlucHV0IGV2ZW50ICovCgoJICB9LCB7CgkgICAga2V5OiAiX29uSW5wdXQiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBfb25JbnB1dChlKSB7CgkgICAgICB0aGlzLl9pbnB1dEV2ZW50ID0gZTsKCgkgICAgICB0aGlzLl9hYm9ydFVwZGF0ZUN1cnNvcigpOyAvLyBmaXggc3RyYW5nZSBJRSBiZWhhdmlvcgoKCgkgICAgICBpZiAoIXRoaXMuX3NlbGVjdGlvbikgcmV0dXJuIHRoaXMudXBkYXRlVmFsdWUoKTsKCSAgICAgIHZhciBkZXRhaWxzID0gbmV3IEFjdGlvbkRldGFpbHMoIC8vIG5ldyBzdGF0ZQoJICAgICAgdGhpcy5lbC52YWx1ZSwgdGhpcy5jdXJzb3JQb3MsIC8vIG9sZCBzdGF0ZQoJICAgICAgdGhpcy52YWx1ZSwgdGhpcy5fc2VsZWN0aW9uKTsKCSAgICAgIHZhciBvbGRSYXdWYWx1ZSA9IHRoaXMubWFza2VkLnJhd0lucHV0VmFsdWU7CgkgICAgICB2YXIgb2Zmc2V0ID0gdGhpcy5tYXNrZWQuc3BsaWNlKGRldGFpbHMuc3RhcnRDaGFuZ2VQb3MsIGRldGFpbHMucmVtb3ZlZC5sZW5ndGgsIGRldGFpbHMuaW5zZXJ0ZWQsIGRldGFpbHMucmVtb3ZlRGlyZWN0aW9uKS5vZmZzZXQ7IC8vIGZvcmNlIGFsaWduIGluIHJlbW92ZSBkaXJlY3Rpb24gb25seSBpZiBubyBpbnB1dCBjaGFycyB3ZXJlIHJlbW92ZWQKCSAgICAgIC8vIG90aGVyd2lzZSB3ZSBzdGlsbCBuZWVkIHRvIGFsaWduIHdpdGggTk9ORSAodG8gZ2V0IG91dCBmcm9tIGZpeGVkIHN5bWJvbHMgZm9yIGluc3RhbmNlKQoKCSAgICAgIHZhciByZW1vdmVEaXJlY3Rpb24gPSBvbGRSYXdWYWx1ZSA9PT0gdGhpcy5tYXNrZWQucmF3SW5wdXRWYWx1ZSA/IGRldGFpbHMucmVtb3ZlRGlyZWN0aW9uIDogRElSRUNUSU9OLk5PTkU7CgkgICAgICB2YXIgY3Vyc29yUG9zID0gdGhpcy5tYXNrZWQubmVhcmVzdElucHV0UG9zKGRldGFpbHMuc3RhcnRDaGFuZ2VQb3MgKyBvZmZzZXQsIHJlbW92ZURpcmVjdGlvbik7CgkgICAgICB0aGlzLnVwZGF0ZUNvbnRyb2woKTsKCSAgICAgIHRoaXMudXBkYXRlQ3Vyc29yKGN1cnNvclBvcyk7CgkgICAgICBkZWxldGUgdGhpcy5faW5wdXRFdmVudDsKCSAgICB9CgkgICAgLyoqIEhhbmRsZXMgdmlldyBjaGFuZ2UgZXZlbnQgYW5kIGNvbW1pdHMgbW9kZWwgdmFsdWUgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJfb25DaGFuZ2UiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBfb25DaGFuZ2UoKSB7CgkgICAgICBpZiAodGhpcy52YWx1ZSAhPT0gdGhpcy5lbC52YWx1ZSkgewoJICAgICAgICB0aGlzLnVwZGF0ZVZhbHVlKCk7CgkgICAgICB9CgoJICAgICAgdGhpcy5tYXNrZWQuZG9Db21taXQoKTsKCSAgICAgIHRoaXMudXBkYXRlQ29udHJvbCgpOwoKCSAgICAgIHRoaXMuX3NhdmVTZWxlY3Rpb24oKTsKCSAgICB9CgkgICAgLyoqIEhhbmRsZXMgdmlldyBkcm9wIGV2ZW50LCBwcmV2ZW50cyBieSBkZWZhdWx0ICovCgoJICB9LCB7CgkgICAga2V5OiAiX29uRHJvcCIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkRyb3AoZXYpIHsKCSAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7CgkgICAgICBldi5zdG9wUHJvcGFnYXRpb24oKTsKCSAgICB9CgkgICAgLyoqIFJlc3RvcmUgbGFzdCBzZWxlY3Rpb24gb24gZm9jdXMgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJfb25Gb2N1cyIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkZvY3VzKGV2KSB7CgkgICAgICB0aGlzLmFsaWduQ3Vyc29yRnJpZW5kbHkoKTsKCSAgICB9CgkgICAgLyoqIFJlc3RvcmUgbGFzdCBzZWxlY3Rpb24gb24gZm9jdXMgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJfb25DbGljayIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkNsaWNrKGV2KSB7CgkgICAgICB0aGlzLmFsaWduQ3Vyc29yRnJpZW5kbHkoKTsKCSAgICB9CgkgICAgLyoqIFVuYmluZCB2aWV3IGV2ZW50cyBhbmQgcmVtb3ZlcyBlbGVtZW50IHJlZmVyZW5jZSAqLwoKCSAgfSwgewoJICAgIGtleTogImRlc3Ryb3kiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95KCkgewoJICAgICAgdGhpcy5fdW5iaW5kRXZlbnRzKCk7IC8vICRGbG93Rml4TWUgd2h5IG5vdCBkbyBzbz8KCgoJICAgICAgdGhpcy5fbGlzdGVuZXJzLmxlbmd0aCA9IDA7IC8vICRGbG93Rml4TWUKCgkgICAgICBkZWxldGUgdGhpcy5lbDsKCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICJtYXNrIiwKCSAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCSAgICAgIHJldHVybiB0aGlzLm1hc2tlZC5tYXNrOwoJICAgIH0sCgkgICAgc2V0OiBmdW5jdGlvbiBzZXQobWFzaykgewoJICAgICAgaWYgKHRoaXMubWFza0VxdWFscyhtYXNrKSkgcmV0dXJuOwoKCSAgICAgIGlmICghKG1hc2sgaW5zdGFuY2VvZiBJTWFzay5NYXNrZWQpICYmIHRoaXMubWFza2VkLmNvbnN0cnVjdG9yID09PSBtYXNrZWRDbGFzcyhtYXNrKSkgewoJICAgICAgICB0aGlzLm1hc2tlZC51cGRhdGVPcHRpb25zKHsKCSAgICAgICAgICBtYXNrOiBtYXNrCgkgICAgICAgIH0pOwoJICAgICAgICByZXR1cm47CgkgICAgICB9CgoJICAgICAgdmFyIG1hc2tlZCA9IGNyZWF0ZU1hc2soewoJICAgICAgICBtYXNrOiBtYXNrCgkgICAgICB9KTsKCSAgICAgIG1hc2tlZC51bm1hc2tlZFZhbHVlID0gdGhpcy5tYXNrZWQudW5tYXNrZWRWYWx1ZTsKCSAgICAgIHRoaXMubWFza2VkID0gbWFza2VkOwoJICAgIH0KCSAgICAvKiogUmF3IHZhbHVlICovCgoJICB9LCB7CgkgICAga2V5OiAidmFsdWUiLAoJICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewoJICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlOwoJICAgIH0sCgkgICAgc2V0OiBmdW5jdGlvbiBzZXQoc3RyKSB7CgkgICAgICB0aGlzLm1hc2tlZC52YWx1ZSA9IHN0cjsKCSAgICAgIHRoaXMudXBkYXRlQ29udHJvbCgpOwoJICAgICAgdGhpcy5hbGlnbkN1cnNvcigpOwoJICAgIH0KCSAgICAvKiogVW5tYXNrZWQgdmFsdWUgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJ1bm1hc2tlZFZhbHVlIiwKCSAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCSAgICAgIHJldHVybiB0aGlzLl91bm1hc2tlZFZhbHVlOwoJICAgIH0sCgkgICAgc2V0OiBmdW5jdGlvbiBzZXQoc3RyKSB7CgkgICAgICB0aGlzLm1hc2tlZC51bm1hc2tlZFZhbHVlID0gc3RyOwoJICAgICAgdGhpcy51cGRhdGVDb250cm9sKCk7CgkgICAgICB0aGlzLmFsaWduQ3Vyc29yKCk7CgkgICAgfQoJICAgIC8qKiBUeXBlZCB1bm1hc2tlZCB2YWx1ZSAqLwoKCSAgfSwgewoJICAgIGtleTogInR5cGVkVmFsdWUiLAoJICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewoJICAgICAgcmV0dXJuIHRoaXMubWFza2VkLnR5cGVkVmFsdWU7CgkgICAgfSwKCSAgICBzZXQ6IGZ1bmN0aW9uIHNldCh2YWwpIHsKCSAgICAgIHRoaXMubWFza2VkLnR5cGVkVmFsdWUgPSB2YWw7CgkgICAgICB0aGlzLnVwZGF0ZUNvbnRyb2woKTsKCSAgICAgIHRoaXMuYWxpZ25DdXJzb3IoKTsKCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICJzZWxlY3Rpb25TdGFydCIsCgkgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkgICAgICByZXR1cm4gdGhpcy5fY3Vyc29yQ2hhbmdpbmcgPyB0aGlzLl9jaGFuZ2luZ0N1cnNvclBvcyA6IHRoaXMuZWwuc2VsZWN0aW9uU3RhcnQ7CgkgICAgfQoJICAgIC8qKiBDdXJyZW50IGN1cnNvciBwb3NpdGlvbiAqLwoKCSAgfSwgewoJICAgIGtleTogImN1cnNvclBvcyIsCgkgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkgICAgICByZXR1cm4gdGhpcy5fY3Vyc29yQ2hhbmdpbmcgPyB0aGlzLl9jaGFuZ2luZ0N1cnNvclBvcyA6IHRoaXMuZWwuc2VsZWN0aW9uRW5kOwoJICAgIH0sCgkgICAgc2V0OiBmdW5jdGlvbiBzZXQocG9zKSB7CgkgICAgICBpZiAoIXRoaXMuZWwgfHwgIXRoaXMuZWwuaXNBY3RpdmUpIHJldHVybjsKCSAgICAgIHRoaXMuZWwuc2VsZWN0KHBvcywgcG9zKTsKCgkgICAgICB0aGlzLl9zYXZlU2VsZWN0aW9uKCk7CgkgICAgfQoJICB9XSk7CgoJICByZXR1cm4gSW5wdXRNYXNrOwoJfSgpOwoJSU1hc2suSW5wdXRNYXNrID0gSW5wdXRNYXNrOwoKCS8qKiBQYXR0ZXJuIHdoaWNoIHZhbGlkYXRlcyBlbnVtIHZhbHVlcyAqLwoKCXZhciBNYXNrZWRFbnVtID0KCS8qI19fUFVSRV9fKi8KCWZ1bmN0aW9uIChfTWFza2VkUGF0dGVybikgewoJICBfaW5oZXJpdHMoTWFza2VkRW51bSwgX01hc2tlZFBhdHRlcm4pOwoKCSAgZnVuY3Rpb24gTWFza2VkRW51bSgpIHsKCSAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgTWFza2VkRW51bSk7CgoJICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoTWFza2VkRW51bSkuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CgkgIH0KCgkgIF9jcmVhdGVDbGFzcyhNYXNrZWRFbnVtLCBbewoJICAgIGtleTogIl91cGRhdGUiLAoKCSAgICAvKioKCSAgICAgIEBvdmVycmlkZQoJICAgICAgQHBhcmFtIHtPYmplY3R9IG9wdHMKCSAgICAqLwoJICAgIHZhbHVlOiBmdW5jdGlvbiBfdXBkYXRlKG9wdHMpIHsKCSAgICAgIC8vIFRPRE8gdHlwZQoJICAgICAgaWYgKG9wdHMuZW51bSkgb3B0cy5tYXNrID0gJyonLnJlcGVhdChvcHRzLmVudW1bMF0ubGVuZ3RoKTsKCgkgICAgICBfZ2V0KF9nZXRQcm90b3R5cGVPZihNYXNrZWRFbnVtLnByb3RvdHlwZSksICJfdXBkYXRlIiwgdGhpcykuY2FsbCh0aGlzLCBvcHRzKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICBAb3ZlcnJpZGUKCSAgICAqLwoKCSAgfSwgewoJICAgIGtleTogImRvVmFsaWRhdGUiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBkb1ZhbGlkYXRlKCkgewoJICAgICAgdmFyIF90aGlzID0gdGhpcywKCSAgICAgICAgICBfZ2V0MjsKCgkgICAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHsKCSAgICAgICAgYXJnc1tfa2V5XSA9IGFyZ3VtZW50c1tfa2V5XTsKCSAgICAgIH0KCgkgICAgICByZXR1cm4gdGhpcy5lbnVtLnNvbWUoZnVuY3Rpb24gKGUpIHsKCSAgICAgICAgcmV0dXJuIGUuaW5kZXhPZihfdGhpcy51bm1hc2tlZFZhbHVlKSA+PSAwOwoJICAgICAgfSkgJiYgKF9nZXQyID0gX2dldChfZ2V0UHJvdG90eXBlT2YoTWFza2VkRW51bS5wcm90b3R5cGUpLCAiZG9WYWxpZGF0ZSIsIHRoaXMpKS5jYWxsLmFwcGx5KF9nZXQyLCBbdGhpc10uY29uY2F0KGFyZ3MpKTsKCSAgICB9CgkgIH1dKTsKCgkgIHJldHVybiBNYXNrZWRFbnVtOwoJfShNYXNrZWRQYXR0ZXJuKTsKCUlNYXNrLk1hc2tlZEVudW0gPSBNYXNrZWRFbnVtOwoKCS8qKgoJICBOdW1iZXIgbWFzawoJICBAcGFyYW0ge09iamVjdH0gb3B0cwoJICBAcGFyYW0ge3N0cmluZ30gb3B0cy5yYWRpeCAtIFNpbmdsZSBjaGFyCgkgIEBwYXJhbSB7c3RyaW5nfSBvcHRzLnRob3VzYW5kc1NlcGFyYXRvciAtIFNpbmdsZSBjaGFyCgkgIEBwYXJhbSB7QXJyYXk8c3RyaW5nPn0gb3B0cy5tYXBUb1JhZGl4IC0gQXJyYXkgb2Ygc2luZ2xlIGNoYXJzCgkgIEBwYXJhbSB7bnVtYmVyfSBvcHRzLm1pbgoJICBAcGFyYW0ge251bWJlcn0gb3B0cy5tYXgKCSAgQHBhcmFtIHtudW1iZXJ9IG9wdHMuc2NhbGUgLSBEaWdpdHMgYWZ0ZXIgcG9pbnQKCSAgQHBhcmFtIHtib29sZWFufSBvcHRzLnNpZ25lZCAtIEFsbG93IG5lZ2F0aXZlCgkgIEBwYXJhbSB7Ym9vbGVhbn0gb3B0cy5ub3JtYWxpemVaZXJvcyAtIEZsYWcgdG8gcmVtb3ZlIGxlYWRpbmcgYW5kIHRyYWlsaW5nIHplcm9zIGluIHRoZSBlbmQgb2YgZWRpdGluZwoJICBAcGFyYW0ge2Jvb2xlYW59IG9wdHMucGFkRnJhY3Rpb25hbFplcm9zIC0gRmxhZyB0byBwYWQgdHJhaWxpbmcgemVyb3MgYWZ0ZXIgcG9pbnQgaW4gdGhlIGVuZCBvZiBlZGl0aW5nCgkqLwoJdmFyIE1hc2tlZE51bWJlciA9CgkvKiNfX1BVUkVfXyovCglmdW5jdGlvbiAoX01hc2tlZCkgewoJICBfaW5oZXJpdHMoTWFza2VkTnVtYmVyLCBfTWFza2VkKTsKCgkgIC8qKiBTaW5nbGUgY2hhciAqLwoKCSAgLyoqIFNpbmdsZSBjaGFyICovCgoJICAvKiogQXJyYXkgb2Ygc2luZ2xlIGNoYXJzICovCgoJICAvKiogKi8KCgkgIC8qKiAqLwoKCSAgLyoqIERpZ2l0cyBhZnRlciBwb2ludCAqLwoKCSAgLyoqICovCgoJICAvKiogRmxhZyB0byByZW1vdmUgbGVhZGluZyBhbmQgdHJhaWxpbmcgemVyb3MgaW4gdGhlIGVuZCBvZiBlZGl0aW5nICovCgoJICAvKiogRmxhZyB0byBwYWQgdHJhaWxpbmcgemVyb3MgYWZ0ZXIgcG9pbnQgaW4gdGhlIGVuZCBvZiBlZGl0aW5nICovCgkgIGZ1bmN0aW9uIE1hc2tlZE51bWJlcihvcHRzKSB7CgkgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIE1hc2tlZE51bWJlcik7CgoJICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoTWFza2VkTnVtYmVyKS5jYWxsKHRoaXMsIE9iamVjdC5hc3NpZ24oe30sIE1hc2tlZE51bWJlci5ERUZBVUxUUywge30sIG9wdHMpKSk7CgkgIH0KCSAgLyoqCgkgICAgQG92ZXJyaWRlCgkgICovCgoKCSAgX2NyZWF0ZUNsYXNzKE1hc2tlZE51bWJlciwgW3sKCSAgICBrZXk6ICJfdXBkYXRlIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gX3VwZGF0ZShvcHRzKSB7CgkgICAgICBfZ2V0KF9nZXRQcm90b3R5cGVPZihNYXNrZWROdW1iZXIucHJvdG90eXBlKSwgIl91cGRhdGUiLCB0aGlzKS5jYWxsKHRoaXMsIG9wdHMpOwoKCSAgICAgIHRoaXMuX3VwZGF0ZVJlZ0V4cHMoKTsKCSAgICB9CgkgICAgLyoqICovCgoJICB9LCB7CgkgICAga2V5OiAiX3VwZGF0ZVJlZ0V4cHMiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBfdXBkYXRlUmVnRXhwcygpIHsKCSAgICAgIC8vIHVzZSBkaWZmZXJlbnQgcmVnZXhwIHRvIHByb2Nlc3MgdXNlciBpbnB1dCAobW9yZSBzdHJpY3QsIGlucHV0IHN1ZmZpeCkgYW5kIHRhaWwgc2hpZnRpbmcKCSAgICAgIHZhciBzdGFydCA9ICdeJyArICh0aGlzLmFsbG93TmVnYXRpdmUgPyAnWyt8XFwtXT8nIDogJycpOwoJICAgICAgdmFyIG1pZElucHV0ID0gJygwfChbMS05XStcXGQqKSk/JzsKCSAgICAgIHZhciBtaWQgPSAnXFxkKic7CgkgICAgICB2YXIgZW5kID0gKHRoaXMuc2NhbGUgPyAnKCcgKyBlc2NhcGVSZWdFeHAodGhpcy5yYWRpeCkgKyAnXFxkezAsJyArIHRoaXMuc2NhbGUgKyAnfSk/JyA6ICcnKSArICckJzsKCSAgICAgIHRoaXMuX251bWJlclJlZ0V4cElucHV0ID0gbmV3IFJlZ0V4cChzdGFydCArIG1pZElucHV0ICsgZW5kKTsKCSAgICAgIHRoaXMuX251bWJlclJlZ0V4cCA9IG5ldyBSZWdFeHAoc3RhcnQgKyBtaWQgKyBlbmQpOwoJICAgICAgdGhpcy5fbWFwVG9SYWRpeFJlZ0V4cCA9IG5ldyBSZWdFeHAoJ1snICsgdGhpcy5tYXBUb1JhZGl4Lm1hcChlc2NhcGVSZWdFeHApLmpvaW4oJycpICsgJ10nLCAnZycpOwoJICAgICAgdGhpcy5fdGhvdXNhbmRzU2VwYXJhdG9yUmVnRXhwID0gbmV3IFJlZ0V4cChlc2NhcGVSZWdFeHAodGhpcy50aG91c2FuZHNTZXBhcmF0b3IpLCAnZycpOwoJICAgIH0KCSAgICAvKiogKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJfcmVtb3ZlVGhvdXNhbmRzU2VwYXJhdG9ycyIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIF9yZW1vdmVUaG91c2FuZHNTZXBhcmF0b3JzKHZhbHVlKSB7CgkgICAgICByZXR1cm4gdmFsdWUucmVwbGFjZSh0aGlzLl90aG91c2FuZHNTZXBhcmF0b3JSZWdFeHAsICcnKTsKCSAgICB9CgkgICAgLyoqICovCgoJICB9LCB7CgkgICAga2V5OiAiX2luc2VydFRob3VzYW5kc1NlcGFyYXRvcnMiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBfaW5zZXJ0VGhvdXNhbmRzU2VwYXJhdG9ycyh2YWx1ZSkgewoJICAgICAgLy8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjkwMTEwMi9ob3ctdG8tcHJpbnQtYS1udW1iZXItd2l0aC1jb21tYXMtYXMtdGhvdXNhbmRzLXNlcGFyYXRvcnMtaW4tamF2YXNjcmlwdAoJICAgICAgdmFyIHBhcnRzID0gdmFsdWUuc3BsaXQodGhpcy5yYWRpeCk7CgkgICAgICBwYXJ0c1swXSA9IHBhcnRzWzBdLnJlcGxhY2UoL1xCKD89KFxkezN9KSsoPyFcZCkpL2csIHRoaXMudGhvdXNhbmRzU2VwYXJhdG9yKTsKCSAgICAgIHJldHVybiBwYXJ0cy5qb2luKHRoaXMucmFkaXgpOwoJICAgIH0KCSAgICAvKioKCSAgICAgIEBvdmVycmlkZQoJICAgICovCgoJICB9LCB7CgkgICAga2V5OiAiZG9QcmVwYXJlIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gZG9QcmVwYXJlKHN0cikgewoJICAgICAgdmFyIF9nZXQyOwoKCSAgICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4gPiAxID8gX2xlbiAtIDEgOiAwKSwgX2tleSA9IDE7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHsKCSAgICAgICAgYXJnc1tfa2V5IC0gMV0gPSBhcmd1bWVudHNbX2tleV07CgkgICAgICB9CgoJICAgICAgcmV0dXJuIChfZ2V0MiA9IF9nZXQoX2dldFByb3RvdHlwZU9mKE1hc2tlZE51bWJlci5wcm90b3R5cGUpLCAiZG9QcmVwYXJlIiwgdGhpcykpLmNhbGwuYXBwbHkoX2dldDIsIFt0aGlzLCB0aGlzLl9yZW1vdmVUaG91c2FuZHNTZXBhcmF0b3JzKHN0ci5yZXBsYWNlKHRoaXMuX21hcFRvUmFkaXhSZWdFeHAsIHRoaXMucmFkaXgpKV0uY29uY2F0KGFyZ3MpKTsKCSAgICB9CgkgICAgLyoqICovCgoJICB9LCB7CgkgICAga2V5OiAiX3NlcGFyYXRvcnNDb3VudCIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIF9zZXBhcmF0b3JzQ291bnQodG8pIHsKCSAgICAgIHZhciBleHRlbmRPblNlcGFyYXRvcnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwoJICAgICAgdmFyIGNvdW50ID0gMDsKCgkgICAgICBmb3IgKHZhciBwb3MgPSAwOyBwb3MgPCB0bzsgKytwb3MpIHsKCSAgICAgICAgaWYgKHRoaXMuX3ZhbHVlLmluZGV4T2YodGhpcy50aG91c2FuZHNTZXBhcmF0b3IsIHBvcykgPT09IHBvcykgewoJICAgICAgICAgICsrY291bnQ7CgkgICAgICAgICAgaWYgKGV4dGVuZE9uU2VwYXJhdG9ycykgdG8gKz0gdGhpcy50aG91c2FuZHNTZXBhcmF0b3IubGVuZ3RoOwoJICAgICAgICB9CgkgICAgICB9CgoJICAgICAgcmV0dXJuIGNvdW50OwoJICAgIH0KCSAgICAvKiogKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJfc2VwYXJhdG9yc0NvdW50RnJvbVNsaWNlIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gX3NlcGFyYXRvcnNDb3VudEZyb21TbGljZSgpIHsKCSAgICAgIHZhciBzbGljZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogdGhpcy5fdmFsdWU7CgkgICAgICByZXR1cm4gdGhpcy5fc2VwYXJhdG9yc0NvdW50KHRoaXMuX3JlbW92ZVRob3VzYW5kc1NlcGFyYXRvcnMoc2xpY2UpLmxlbmd0aCwgdHJ1ZSk7CgkgICAgfQoJICAgIC8qKgoJICAgICAgQG92ZXJyaWRlCgkgICAgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJleHRyYWN0SW5wdXQiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBleHRyYWN0SW5wdXQoKSB7CgkgICAgICB2YXIgZnJvbVBvcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogMDsKCSAgICAgIHZhciB0b1BvcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogdGhpcy52YWx1ZS5sZW5ndGg7CgkgICAgICB2YXIgZmxhZ3MgPSBhcmd1bWVudHMubGVuZ3RoID4gMiA/IGFyZ3VtZW50c1syXSA6IHVuZGVmaW5lZDsKCgkgICAgICB2YXIgX3RoaXMkX2FkanVzdFJhbmdlV2l0ID0gdGhpcy5fYWRqdXN0UmFuZ2VXaXRoU2VwYXJhdG9ycyhmcm9tUG9zLCB0b1Bvcyk7CgoJICAgICAgdmFyIF90aGlzJF9hZGp1c3RSYW5nZVdpdDIgPSBfc2xpY2VkVG9BcnJheShfdGhpcyRfYWRqdXN0UmFuZ2VXaXQsIDIpOwoKCSAgICAgIGZyb21Qb3MgPSBfdGhpcyRfYWRqdXN0UmFuZ2VXaXQyWzBdOwoJICAgICAgdG9Qb3MgPSBfdGhpcyRfYWRqdXN0UmFuZ2VXaXQyWzFdOwoJICAgICAgcmV0dXJuIHRoaXMuX3JlbW92ZVRob3VzYW5kc1NlcGFyYXRvcnMoX2dldChfZ2V0UHJvdG90eXBlT2YoTWFza2VkTnVtYmVyLnByb3RvdHlwZSksICJleHRyYWN0SW5wdXQiLCB0aGlzKS5jYWxsKHRoaXMsIGZyb21Qb3MsIHRvUG9zLCBmbGFncykpOwoJICAgIH0KCSAgICAvKioKCSAgICAgIEBvdmVycmlkZQoJICAgICovCgoJICB9LCB7CgkgICAga2V5OiAiX2FwcGVuZENoYXJSYXciLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBfYXBwZW5kQ2hhclJhdyhjaCkgewoJICAgICAgdmFyIGZsYWdzID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsKCSAgICAgIGlmICghdGhpcy50aG91c2FuZHNTZXBhcmF0b3IpIHJldHVybiBfZ2V0KF9nZXRQcm90b3R5cGVPZihNYXNrZWROdW1iZXIucHJvdG90eXBlKSwgIl9hcHBlbmRDaGFyUmF3IiwgdGhpcykuY2FsbCh0aGlzLCBjaCwgZmxhZ3MpOwoJICAgICAgdmFyIHByZXZCZWZvcmVUYWlsVmFsdWUgPSBmbGFncy50YWlsICYmIGZsYWdzLl9iZWZvcmVUYWlsU3RhdGUgPyBmbGFncy5fYmVmb3JlVGFpbFN0YXRlLl92YWx1ZSA6IHRoaXMuX3ZhbHVlOwoKCSAgICAgIHZhciBwcmV2QmVmb3JlVGFpbFNlcGFyYXRvcnNDb3VudCA9IHRoaXMuX3NlcGFyYXRvcnNDb3VudEZyb21TbGljZShwcmV2QmVmb3JlVGFpbFZhbHVlKTsKCgkgICAgICB0aGlzLl92YWx1ZSA9IHRoaXMuX3JlbW92ZVRob3VzYW5kc1NlcGFyYXRvcnModGhpcy52YWx1ZSk7CgoJICAgICAgdmFyIGFwcGVuZERldGFpbHMgPSBfZ2V0KF9nZXRQcm90b3R5cGVPZihNYXNrZWROdW1iZXIucHJvdG90eXBlKSwgIl9hcHBlbmRDaGFyUmF3IiwgdGhpcykuY2FsbCh0aGlzLCBjaCwgZmxhZ3MpOwoKCSAgICAgIHRoaXMuX3ZhbHVlID0gdGhpcy5faW5zZXJ0VGhvdXNhbmRzU2VwYXJhdG9ycyh0aGlzLl92YWx1ZSk7CgkgICAgICB2YXIgYmVmb3JlVGFpbFZhbHVlID0gZmxhZ3MudGFpbCAmJiBmbGFncy5fYmVmb3JlVGFpbFN0YXRlID8gZmxhZ3MuX2JlZm9yZVRhaWxTdGF0ZS5fdmFsdWUgOiB0aGlzLl92YWx1ZTsKCgkgICAgICB2YXIgYmVmb3JlVGFpbFNlcGFyYXRvcnNDb3VudCA9IHRoaXMuX3NlcGFyYXRvcnNDb3VudEZyb21TbGljZShiZWZvcmVUYWlsVmFsdWUpOwoKCSAgICAgIGFwcGVuZERldGFpbHMudGFpbFNoaWZ0ICs9IChiZWZvcmVUYWlsU2VwYXJhdG9yc0NvdW50IC0gcHJldkJlZm9yZVRhaWxTZXBhcmF0b3JzQ291bnQpICogdGhpcy50aG91c2FuZHNTZXBhcmF0b3IubGVuZ3RoOwoJICAgICAgYXBwZW5kRGV0YWlscy5za2lwID0gIWFwcGVuZERldGFpbHMucmF3SW5zZXJ0ZWQgJiYgY2ggPT09IHRoaXMudGhvdXNhbmRzU2VwYXJhdG9yOwoJICAgICAgcmV0dXJuIGFwcGVuZERldGFpbHM7CgkgICAgfQoJICAgIC8qKiAqLwoKCSAgfSwgewoJICAgIGtleTogIl9maW5kU2VwYXJhdG9yQXJvdW5kIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gX2ZpbmRTZXBhcmF0b3JBcm91bmQocG9zKSB7CgkgICAgICBpZiAodGhpcy50aG91c2FuZHNTZXBhcmF0b3IpIHsKCSAgICAgICAgdmFyIHNlYXJjaEZyb20gPSBwb3MgLSB0aGlzLnRob3VzYW5kc1NlcGFyYXRvci5sZW5ndGggKyAxOwoJICAgICAgICB2YXIgc2VwYXJhdG9yUG9zID0gdGhpcy52YWx1ZS5pbmRleE9mKHRoaXMudGhvdXNhbmRzU2VwYXJhdG9yLCBzZWFyY2hGcm9tKTsKCSAgICAgICAgaWYgKHNlcGFyYXRvclBvcyA8PSBwb3MpIHJldHVybiBzZXBhcmF0b3JQb3M7CgkgICAgICB9CgoJICAgICAgcmV0dXJuIC0xOwoJICAgIH0KCSAgfSwgewoJICAgIGtleTogIl9hZGp1c3RSYW5nZVdpdGhTZXBhcmF0b3JzIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gX2FkanVzdFJhbmdlV2l0aFNlcGFyYXRvcnMoZnJvbSwgdG8pIHsKCSAgICAgIHZhciBzZXBhcmF0b3JBcm91bmRGcm9tUG9zID0gdGhpcy5fZmluZFNlcGFyYXRvckFyb3VuZChmcm9tKTsKCgkgICAgICBpZiAoc2VwYXJhdG9yQXJvdW5kRnJvbVBvcyA+PSAwKSBmcm9tID0gc2VwYXJhdG9yQXJvdW5kRnJvbVBvczsKCgkgICAgICB2YXIgc2VwYXJhdG9yQXJvdW5kVG9Qb3MgPSB0aGlzLl9maW5kU2VwYXJhdG9yQXJvdW5kKHRvKTsKCgkgICAgICBpZiAoc2VwYXJhdG9yQXJvdW5kVG9Qb3MgPj0gMCkgdG8gPSBzZXBhcmF0b3JBcm91bmRUb1BvcyArIHRoaXMudGhvdXNhbmRzU2VwYXJhdG9yLmxlbmd0aDsKCSAgICAgIHJldHVybiBbZnJvbSwgdG9dOwoJICAgIH0KCSAgICAvKioKCSAgICAgIEBvdmVycmlkZQoJICAgICovCgoJICB9LCB7CgkgICAga2V5OiAicmVtb3ZlIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlKCkgewoJICAgICAgdmFyIGZyb21Qb3MgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IDA7CgkgICAgICB2YXIgdG9Qb3MgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHRoaXMudmFsdWUubGVuZ3RoOwoKCSAgICAgIHZhciBfdGhpcyRfYWRqdXN0UmFuZ2VXaXQzID0gdGhpcy5fYWRqdXN0UmFuZ2VXaXRoU2VwYXJhdG9ycyhmcm9tUG9zLCB0b1Bvcyk7CgoJICAgICAgdmFyIF90aGlzJF9hZGp1c3RSYW5nZVdpdDQgPSBfc2xpY2VkVG9BcnJheShfdGhpcyRfYWRqdXN0UmFuZ2VXaXQzLCAyKTsKCgkgICAgICBmcm9tUG9zID0gX3RoaXMkX2FkanVzdFJhbmdlV2l0NFswXTsKCSAgICAgIHRvUG9zID0gX3RoaXMkX2FkanVzdFJhbmdlV2l0NFsxXTsKCSAgICAgIHZhciB2YWx1ZUJlZm9yZVBvcyA9IHRoaXMudmFsdWUuc2xpY2UoMCwgZnJvbVBvcyk7CgkgICAgICB2YXIgdmFsdWVBZnRlclBvcyA9IHRoaXMudmFsdWUuc2xpY2UodG9Qb3MpOwoKCSAgICAgIHZhciBwcmV2QmVmb3JlVGFpbFNlcGFyYXRvcnNDb3VudCA9IHRoaXMuX3NlcGFyYXRvcnNDb3VudCh2YWx1ZUJlZm9yZVBvcy5sZW5ndGgpOwoKCSAgICAgIHRoaXMuX3ZhbHVlID0gdGhpcy5faW5zZXJ0VGhvdXNhbmRzU2VwYXJhdG9ycyh0aGlzLl9yZW1vdmVUaG91c2FuZHNTZXBhcmF0b3JzKHZhbHVlQmVmb3JlUG9zICsgdmFsdWVBZnRlclBvcykpOwoKCSAgICAgIHZhciBiZWZvcmVUYWlsU2VwYXJhdG9yc0NvdW50ID0gdGhpcy5fc2VwYXJhdG9yc0NvdW50RnJvbVNsaWNlKHZhbHVlQmVmb3JlUG9zKTsKCgkgICAgICByZXR1cm4gbmV3IENoYW5nZURldGFpbHMoewoJICAgICAgICB0YWlsU2hpZnQ6IChiZWZvcmVUYWlsU2VwYXJhdG9yc0NvdW50IC0gcHJldkJlZm9yZVRhaWxTZXBhcmF0b3JzQ291bnQpICogdGhpcy50aG91c2FuZHNTZXBhcmF0b3IubGVuZ3RoCgkgICAgICB9KTsKCSAgICB9CgkgICAgLyoqCgkgICAgICBAb3ZlcnJpZGUKCSAgICAqLwoKCSAgfSwgewoJICAgIGtleTogIm5lYXJlc3RJbnB1dFBvcyIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIG5lYXJlc3RJbnB1dFBvcyhjdXJzb3JQb3MsIGRpcmVjdGlvbikgewoJICAgICAgaWYgKCF0aGlzLnRob3VzYW5kc1NlcGFyYXRvcikgcmV0dXJuIGN1cnNvclBvczsKCgkgICAgICBzd2l0Y2ggKGRpcmVjdGlvbikgewoJICAgICAgICBjYXNlIERJUkVDVElPTi5OT05FOgoJICAgICAgICBjYXNlIERJUkVDVElPTi5MRUZUOgoJICAgICAgICBjYXNlIERJUkVDVElPTi5GT1JDRV9MRUZUOgoJICAgICAgICAgIHsKCSAgICAgICAgICAgIHZhciBzZXBhcmF0b3JBdExlZnRQb3MgPSB0aGlzLl9maW5kU2VwYXJhdG9yQXJvdW5kKGN1cnNvclBvcyAtIDEpOwoKCSAgICAgICAgICAgIGlmIChzZXBhcmF0b3JBdExlZnRQb3MgPj0gMCkgewoJICAgICAgICAgICAgICB2YXIgc2VwYXJhdG9yQXRMZWZ0RW5kUG9zID0gc2VwYXJhdG9yQXRMZWZ0UG9zICsgdGhpcy50aG91c2FuZHNTZXBhcmF0b3IubGVuZ3RoOwoKCSAgICAgICAgICAgICAgaWYgKGN1cnNvclBvcyA8IHNlcGFyYXRvckF0TGVmdEVuZFBvcyB8fCB0aGlzLnZhbHVlLmxlbmd0aCA8PSBzZXBhcmF0b3JBdExlZnRFbmRQb3MgfHwgZGlyZWN0aW9uID09PSBESVJFQ1RJT04uRk9SQ0VfTEVGVCkgewoJICAgICAgICAgICAgICAgIHJldHVybiBzZXBhcmF0b3JBdExlZnRQb3M7CgkgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICB9CgoJICAgICAgICBjYXNlIERJUkVDVElPTi5SSUdIVDoKCSAgICAgICAgY2FzZSBESVJFQ1RJT04uRk9SQ0VfUklHSFQ6CgkgICAgICAgICAgewoJICAgICAgICAgICAgdmFyIHNlcGFyYXRvckF0UmlnaHRQb3MgPSB0aGlzLl9maW5kU2VwYXJhdG9yQXJvdW5kKGN1cnNvclBvcyk7CgoJICAgICAgICAgICAgaWYgKHNlcGFyYXRvckF0UmlnaHRQb3MgPj0gMCkgewoJICAgICAgICAgICAgICByZXR1cm4gc2VwYXJhdG9yQXRSaWdodFBvcyArIHRoaXMudGhvdXNhbmRzU2VwYXJhdG9yLmxlbmd0aDsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICB9CgkgICAgICB9CgoJICAgICAgcmV0dXJuIGN1cnNvclBvczsKCSAgICB9CgkgICAgLyoqCgkgICAgICBAb3ZlcnJpZGUKCSAgICAqLwoKCSAgfSwgewoJICAgIGtleTogImRvVmFsaWRhdGUiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBkb1ZhbGlkYXRlKGZsYWdzKSB7CgkgICAgICB2YXIgcmVnZXhwID0gZmxhZ3MuaW5wdXQgPyB0aGlzLl9udW1iZXJSZWdFeHBJbnB1dCA6IHRoaXMuX251bWJlclJlZ0V4cDsgLy8gdmFsaWRhdGUgYXMgc3RyaW5nCgoJICAgICAgdmFyIHZhbGlkID0gcmVnZXhwLnRlc3QodGhpcy5fcmVtb3ZlVGhvdXNhbmRzU2VwYXJhdG9ycyh0aGlzLnZhbHVlKSk7CgoJICAgICAgaWYgKHZhbGlkKSB7CgkgICAgICAgIC8vIHZhbGlkYXRlIGFzIG51bWJlcgoJICAgICAgICB2YXIgbnVtYmVyID0gdGhpcy5udW1iZXI7CgkgICAgICAgIHZhbGlkID0gdmFsaWQgJiYgIWlzTmFOKG51bWJlcikgJiYgKCAvLyBjaGVjayBtaW4gYm91bmQgZm9yIG5lZ2F0aXZlIHZhbHVlcwoJICAgICAgICB0aGlzLm1pbiA9PSBudWxsIHx8IHRoaXMubWluID49IDAgfHwgdGhpcy5taW4gPD0gdGhpcy5udW1iZXIpICYmICggLy8gY2hlY2sgbWF4IGJvdW5kIGZvciBwb3NpdGl2ZSB2YWx1ZXMKCSAgICAgICAgdGhpcy5tYXggPT0gbnVsbCB8fCB0aGlzLm1heCA8PSAwIHx8IHRoaXMubnVtYmVyIDw9IHRoaXMubWF4KTsKCSAgICAgIH0KCgkgICAgICByZXR1cm4gdmFsaWQgJiYgX2dldChfZ2V0UHJvdG90eXBlT2YoTWFza2VkTnVtYmVyLnByb3RvdHlwZSksICJkb1ZhbGlkYXRlIiwgdGhpcykuY2FsbCh0aGlzLCBmbGFncyk7CgkgICAgfQoJICAgIC8qKgoJICAgICAgQG92ZXJyaWRlCgkgICAgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJkb0NvbW1pdCIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGRvQ29tbWl0KCkgewoJICAgICAgaWYgKHRoaXMudmFsdWUpIHsKCSAgICAgICAgdmFyIG51bWJlciA9IHRoaXMubnVtYmVyOwoJICAgICAgICB2YXIgdmFsaWRudW0gPSBudW1iZXI7IC8vIGNoZWNrIGJvdW5kcwoKCSAgICAgICAgaWYgKHRoaXMubWluICE9IG51bGwpIHZhbGlkbnVtID0gTWF0aC5tYXgodmFsaWRudW0sIHRoaXMubWluKTsKCSAgICAgICAgaWYgKHRoaXMubWF4ICE9IG51bGwpIHZhbGlkbnVtID0gTWF0aC5taW4odmFsaWRudW0sIHRoaXMubWF4KTsKCSAgICAgICAgaWYgKHZhbGlkbnVtICE9PSBudW1iZXIpIHRoaXMudW5tYXNrZWRWYWx1ZSA9IFN0cmluZyh2YWxpZG51bSk7CgkgICAgICAgIHZhciBmb3JtYXR0ZWQgPSB0aGlzLnZhbHVlOwoJICAgICAgICBpZiAodGhpcy5ub3JtYWxpemVaZXJvcykgZm9ybWF0dGVkID0gdGhpcy5fbm9ybWFsaXplWmVyb3MoZm9ybWF0dGVkKTsKCSAgICAgICAgaWYgKHRoaXMucGFkRnJhY3Rpb25hbFplcm9zKSBmb3JtYXR0ZWQgPSB0aGlzLl9wYWRGcmFjdGlvbmFsWmVyb3MoZm9ybWF0dGVkKTsKCSAgICAgICAgdGhpcy5fdmFsdWUgPSBmb3JtYXR0ZWQ7CgkgICAgICB9CgoJICAgICAgX2dldChfZ2V0UHJvdG90eXBlT2YoTWFza2VkTnVtYmVyLnByb3RvdHlwZSksICJkb0NvbW1pdCIsIHRoaXMpLmNhbGwodGhpcyk7CgkgICAgfQoJICAgIC8qKiAqLwoKCSAgfSwgewoJICAgIGtleTogIl9ub3JtYWxpemVaZXJvcyIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIF9ub3JtYWxpemVaZXJvcyh2YWx1ZSkgewoJICAgICAgdmFyIHBhcnRzID0gdGhpcy5fcmVtb3ZlVGhvdXNhbmRzU2VwYXJhdG9ycyh2YWx1ZSkuc3BsaXQodGhpcy5yYWRpeCk7IC8vIHJlbW92ZSBsZWFkaW5nIHplcm9zCgoKCSAgICAgIHBhcnRzWzBdID0gcGFydHNbMF0ucmVwbGFjZSgvXihcRCopKDAqKShcZCopLywgZnVuY3Rpb24gKG1hdGNoLCBzaWduLCB6ZXJvcywgbnVtKSB7CgkgICAgICAgIHJldHVybiBzaWduICsgbnVtOwoJICAgICAgfSk7IC8vIGFkZCBsZWFkaW5nIHplcm8KCgkgICAgICBpZiAodmFsdWUubGVuZ3RoICYmICEvXGQkLy50ZXN0KHBhcnRzWzBdKSkgcGFydHNbMF0gPSBwYXJ0c1swXSArICcwJzsKCgkgICAgICBpZiAocGFydHMubGVuZ3RoID4gMSkgewoJICAgICAgICBwYXJ0c1sxXSA9IHBhcnRzWzFdLnJlcGxhY2UoLzAqJC8sICcnKTsgLy8gcmVtb3ZlIHRyYWlsaW5nIHplcm9zCgoJICAgICAgICBpZiAoIXBhcnRzWzFdLmxlbmd0aCkgcGFydHMubGVuZ3RoID0gMTsgLy8gcmVtb3ZlIGZyYWN0aW9uYWwKCSAgICAgIH0KCgkgICAgICByZXR1cm4gdGhpcy5faW5zZXJ0VGhvdXNhbmRzU2VwYXJhdG9ycyhwYXJ0cy5qb2luKHRoaXMucmFkaXgpKTsKCSAgICB9CgkgICAgLyoqICovCgoJICB9LCB7CgkgICAga2V5OiAiX3BhZEZyYWN0aW9uYWxaZXJvcyIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIF9wYWRGcmFjdGlvbmFsWmVyb3ModmFsdWUpIHsKCSAgICAgIGlmICghdmFsdWUpIHJldHVybiB2YWx1ZTsKCSAgICAgIHZhciBwYXJ0cyA9IHZhbHVlLnNwbGl0KHRoaXMucmFkaXgpOwoJICAgICAgaWYgKHBhcnRzLmxlbmd0aCA8IDIpIHBhcnRzLnB1c2goJycpOwoJICAgICAgcGFydHNbMV0gPSBwYXJ0c1sxXS5wYWRFbmQodGhpcy5zY2FsZSwgJzAnKTsKCSAgICAgIHJldHVybiBwYXJ0cy5qb2luKHRoaXMucmFkaXgpOwoJICAgIH0KCSAgICAvKioKCSAgICAgIEBvdmVycmlkZQoJICAgICovCgoJICB9LCB7CgkgICAga2V5OiAidW5tYXNrZWRWYWx1ZSIsCgkgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkgICAgICByZXR1cm4gdGhpcy5fcmVtb3ZlVGhvdXNhbmRzU2VwYXJhdG9ycyh0aGlzLl9ub3JtYWxpemVaZXJvcyh0aGlzLnZhbHVlKSkucmVwbGFjZSh0aGlzLnJhZGl4LCAnLicpOwoJICAgIH0sCgkgICAgc2V0OiBmdW5jdGlvbiBzZXQodW5tYXNrZWRWYWx1ZSkgewoJICAgICAgX3NldChfZ2V0UHJvdG90eXBlT2YoTWFza2VkTnVtYmVyLnByb3RvdHlwZSksICJ1bm1hc2tlZFZhbHVlIiwgdW5tYXNrZWRWYWx1ZS5yZXBsYWNlKCcuJywgdGhpcy5yYWRpeCksIHRoaXMsIHRydWUpOwoJICAgIH0KCSAgICAvKioKCSAgICAgIEBvdmVycmlkZQoJICAgICovCgoJICB9LCB7CgkgICAga2V5OiAidHlwZWRWYWx1ZSIsCgkgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkgICAgICByZXR1cm4gTnVtYmVyKHRoaXMudW5tYXNrZWRWYWx1ZSk7CgkgICAgfSwKCSAgICBzZXQ6IGZ1bmN0aW9uIHNldChuKSB7CgkgICAgICBfc2V0KF9nZXRQcm90b3R5cGVPZihNYXNrZWROdW1iZXIucHJvdG90eXBlKSwgInVubWFza2VkVmFsdWUiLCBTdHJpbmcobiksIHRoaXMsIHRydWUpOwoJICAgIH0KCSAgICAvKiogUGFyc2VkIE51bWJlciAqLwoKCSAgfSwgewoJICAgIGtleTogIm51bWJlciIsCgkgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkgICAgICByZXR1cm4gdGhpcy50eXBlZFZhbHVlOwoJICAgIH0sCgkgICAgc2V0OiBmdW5jdGlvbiBzZXQobnVtYmVyKSB7CgkgICAgICB0aGlzLnR5cGVkVmFsdWUgPSBudW1iZXI7CgkgICAgfQoJICAgIC8qKgoJICAgICAgSXMgbmVnYXRpdmUgYWxsb3dlZAoJICAgICAgQHJlYWRvbmx5CgkgICAgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJhbGxvd05lZ2F0aXZlIiwKCSAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCSAgICAgIHJldHVybiB0aGlzLnNpZ25lZCB8fCB0aGlzLm1pbiAhPSBudWxsICYmIHRoaXMubWluIDwgMCB8fCB0aGlzLm1heCAhPSBudWxsICYmIHRoaXMubWF4IDwgMDsKCSAgICB9CgkgIH1dKTsKCgkgIHJldHVybiBNYXNrZWROdW1iZXI7Cgl9KE1hc2tlZCk7CglNYXNrZWROdW1iZXIuREVGQVVMVFMgPSB7CgkgIHJhZGl4OiAnLCcsCgkgIHRob3VzYW5kc1NlcGFyYXRvcjogJycsCgkgIG1hcFRvUmFkaXg6IFsnLiddLAoJICBzY2FsZTogMiwKCSAgc2lnbmVkOiBmYWxzZSwKCSAgbm9ybWFsaXplWmVyb3M6IHRydWUsCgkgIHBhZEZyYWN0aW9uYWxaZXJvczogZmFsc2UKCX07CglJTWFzay5NYXNrZWROdW1iZXIgPSBNYXNrZWROdW1iZXI7CgoJLyoqIE1hc2tpbmcgYnkgY3VzdG9tIEZ1bmN0aW9uICovCgoJdmFyIE1hc2tlZEZ1bmN0aW9uID0KCS8qI19fUFVSRV9fKi8KCWZ1bmN0aW9uIChfTWFza2VkKSB7CgkgIF9pbmhlcml0cyhNYXNrZWRGdW5jdGlvbiwgX01hc2tlZCk7CgoJICBmdW5jdGlvbiBNYXNrZWRGdW5jdGlvbigpIHsKCSAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgTWFza2VkRnVuY3Rpb24pOwoKCSAgICByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKE1hc2tlZEZ1bmN0aW9uKS5hcHBseSh0aGlzLCBhcmd1bWVudHMpKTsKCSAgfQoKCSAgX2NyZWF0ZUNsYXNzKE1hc2tlZEZ1bmN0aW9uLCBbewoJICAgIGtleTogIl91cGRhdGUiLAoKCSAgICAvKioKCSAgICAgIEBvdmVycmlkZQoJICAgICAgQHBhcmFtIHtPYmplY3R9IG9wdHMKCSAgICAqLwoJICAgIHZhbHVlOiBmdW5jdGlvbiBfdXBkYXRlKG9wdHMpIHsKCSAgICAgIGlmIChvcHRzLm1hc2spIG9wdHMudmFsaWRhdGUgPSBvcHRzLm1hc2s7CgoJICAgICAgX2dldChfZ2V0UHJvdG90eXBlT2YoTWFza2VkRnVuY3Rpb24ucHJvdG90eXBlKSwgIl91cGRhdGUiLCB0aGlzKS5jYWxsKHRoaXMsIG9wdHMpOwoJICAgIH0KCSAgfV0pOwoKCSAgcmV0dXJuIE1hc2tlZEZ1bmN0aW9uOwoJfShNYXNrZWQpOwoJSU1hc2suTWFza2VkRnVuY3Rpb24gPSBNYXNrZWRGdW5jdGlvbjsKCgkvKiogRHluYW1pYyBtYXNrIGZvciBjaG9vc2luZyBhcHJvcHJpYXRlIG1hc2sgaW4gcnVuLXRpbWUgKi8KCXZhciBNYXNrZWREeW5hbWljID0KCS8qI19fUFVSRV9fKi8KCWZ1bmN0aW9uIChfTWFza2VkKSB7CgkgIF9pbmhlcml0cyhNYXNrZWREeW5hbWljLCBfTWFza2VkKTsKCgkgIC8qKiBDdXJyZW50bHkgY2hvc2VuIG1hc2sgKi8KCgkgIC8qKiBDb21wbGlsZWQge0BsaW5rIE1hc2tlZH0gb3B0aW9ucyAqLwoKCSAgLyoqIENob29zZXMge0BsaW5rIE1hc2tlZH0gZGVwZW5kaW5nIG9uIGlucHV0IHZhbHVlICovCgoJICAvKioKCSAgICBAcGFyYW0ge09iamVjdH0gb3B0cwoJICAqLwoJICBmdW5jdGlvbiBNYXNrZWREeW5hbWljKG9wdHMpIHsKCSAgICB2YXIgX3RoaXM7CgoJICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBNYXNrZWREeW5hbWljKTsKCgkgICAgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoTWFza2VkRHluYW1pYykuY2FsbCh0aGlzLCBPYmplY3QuYXNzaWduKHt9LCBNYXNrZWREeW5hbWljLkRFRkFVTFRTLCB7fSwgb3B0cykpKTsKCSAgICBfdGhpcy5jdXJyZW50TWFzayA9IG51bGw7CgkgICAgcmV0dXJuIF90aGlzOwoJICB9CgkgIC8qKgoJICAgIEBvdmVycmlkZQoJICAqLwoKCgkgIF9jcmVhdGVDbGFzcyhNYXNrZWREeW5hbWljLCBbewoJICAgIGtleTogIl91cGRhdGUiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBfdXBkYXRlKG9wdHMpIHsKCSAgICAgIF9nZXQoX2dldFByb3RvdHlwZU9mKE1hc2tlZER5bmFtaWMucHJvdG90eXBlKSwgIl91cGRhdGUiLCB0aGlzKS5jYWxsKHRoaXMsIG9wdHMpOwoKCSAgICAgIGlmICgnbWFzaycgaW4gb3B0cykgewoJICAgICAgICAvLyBtYXNrIGNvdWxkIGJlIHRvdGFsbHkgZHluYW1pYyB3aXRoIG9ubHkgYGRpc3BhdGNoYCBvcHRpb24KCSAgICAgICAgdGhpcy5jb21waWxlZE1hc2tzID0gQXJyYXkuaXNBcnJheShvcHRzLm1hc2spID8gb3B0cy5tYXNrLm1hcChmdW5jdGlvbiAobSkgewoJICAgICAgICAgIHJldHVybiBjcmVhdGVNYXNrKG0pOwoJICAgICAgICB9KSA6IFtdOwoJICAgICAgfQoJICAgIH0KCSAgICAvKioKCSAgICAgIEBvdmVycmlkZQoJICAgICovCgoJICB9LCB7CgkgICAga2V5OiAiX2FwcGVuZENoYXJSYXciLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBfYXBwZW5kQ2hhclJhdygpIHsKCSAgICAgIHZhciBkZXRhaWxzID0gdGhpcy5fYXBwbHlEaXNwYXRjaC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoKCSAgICAgIGlmICh0aGlzLmN1cnJlbnRNYXNrKSB7CgkgICAgICAgIHZhciBfdGhpcyRjdXJyZW50TWFzazsKCgkgICAgICAgIGRldGFpbHMuYWdncmVnYXRlKChfdGhpcyRjdXJyZW50TWFzayA9IHRoaXMuY3VycmVudE1hc2spLl9hcHBlbmRDaGFyLmFwcGx5KF90aGlzJGN1cnJlbnRNYXNrLCBhcmd1bWVudHMpKTsKCSAgICAgIH0KCgkgICAgICByZXR1cm4gZGV0YWlsczsKCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICJfYXBwbHlEaXNwYXRjaCIsCgkgICAgdmFsdWU6IGZ1bmN0aW9uIF9hcHBseURpc3BhdGNoKCkgewoJICAgICAgdmFyIGFwcGVuZGVkID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAnJzsKCSAgICAgIHZhciBmbGFncyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CgkgICAgICB2YXIgcHJldlZhbHVlQmVmb3JlVGFpbCA9IGZsYWdzLnRhaWwgJiYgZmxhZ3MuX2JlZm9yZVRhaWxTdGF0ZSAhPSBudWxsID8gZmxhZ3MuX2JlZm9yZVRhaWxTdGF0ZS5fdmFsdWUgOiB0aGlzLnZhbHVlOwoJICAgICAgdmFyIGlucHV0VmFsdWUgPSB0aGlzLnJhd0lucHV0VmFsdWU7CgkgICAgICB2YXIgaW5zZXJ0VmFsdWUgPSBmbGFncy50YWlsICYmIGZsYWdzLl9iZWZvcmVUYWlsU3RhdGUgIT0gbnVsbCA/IC8vICRGbG93Rml4TWUgLSB0aXJlZCB0byBmaWdodCB3aXRoIHR5cGUgc3lzdGVtCgkgICAgICBmbGFncy5fYmVmb3JlVGFpbFN0YXRlLl9yYXdJbnB1dFZhbHVlIDogaW5wdXRWYWx1ZTsKCSAgICAgIHZhciB0YWlsVmFsdWUgPSBpbnB1dFZhbHVlLnNsaWNlKGluc2VydFZhbHVlLmxlbmd0aCk7CgkgICAgICB2YXIgcHJldk1hc2sgPSB0aGlzLmN1cnJlbnRNYXNrOwoJICAgICAgdmFyIGRldGFpbHMgPSBuZXcgQ2hhbmdlRGV0YWlscygpOwoJICAgICAgdmFyIHByZXZNYXNrU3RhdGUgPSBwcmV2TWFzayAmJiBwcmV2TWFzay5zdGF0ZTsgLy8gY2xvbmUgZmxhZ3MgdG8gcHJldmVudCBvdmVyd3JpdGluZyBgX2JlZm9yZVRhaWxTdGF0ZWAKCgkgICAgICB0aGlzLmN1cnJlbnRNYXNrID0gdGhpcy5kb0Rpc3BhdGNoKGFwcGVuZGVkLCBPYmplY3QuYXNzaWduKHt9LCBmbGFncykpOyAvLyByZXN0b3JlIHN0YXRlIGFmdGVyIGRpc3BhdGNoCgoJICAgICAgaWYgKHRoaXMuY3VycmVudE1hc2spIHsKCSAgICAgICAgaWYgKHRoaXMuY3VycmVudE1hc2sgIT09IHByZXZNYXNrKSB7CgkgICAgICAgICAgLy8gaWYgbWFzayBjaGFuZ2VkIHJlYXBwbHkgaW5wdXQKCSAgICAgICAgICB0aGlzLmN1cnJlbnRNYXNrLnJlc2V0KCk7IC8vICRGbG93Rml4TWUgLSBpdCdzIG9rLCB3ZSBkb24ndCBjaGFuZ2UgY3VycmVudCBtYXNrIGFib3ZlCgoJICAgICAgICAgIHZhciBkID0gdGhpcy5jdXJyZW50TWFzay5hcHBlbmQoaW5zZXJ0VmFsdWUsIHsKCSAgICAgICAgICAgIHJhdzogdHJ1ZQoJICAgICAgICAgIH0pOwoJICAgICAgICAgIGRldGFpbHMudGFpbFNoaWZ0ID0gZC5pbnNlcnRlZC5sZW5ndGggLSBwcmV2VmFsdWVCZWZvcmVUYWlsLmxlbmd0aDsKCgkgICAgICAgICAgaWYgKHRhaWxWYWx1ZSkgewoJICAgICAgICAgICAgLy8gJEZsb3dGaXhNZSAtIGl0J3Mgb2ssIHdlIGRvbid0IGNoYW5nZSBjdXJyZW50IG1hc2sgYWJvdmUKCSAgICAgICAgICAgIGRldGFpbHMudGFpbFNoaWZ0ICs9IHRoaXMuY3VycmVudE1hc2suYXBwZW5kKHRhaWxWYWx1ZSwgewoJICAgICAgICAgICAgICByYXc6IHRydWUsCgkgICAgICAgICAgICAgIHRhaWw6IHRydWUKCSAgICAgICAgICAgIH0pLnRhaWxTaGlmdDsKCSAgICAgICAgICB9CgkgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgLy8gRGlzcGF0Y2ggY2FuIGRvIHNvbWV0aGluZyBiYWQgd2l0aCBzdGF0ZSwgc28KCSAgICAgICAgICAvLyByZXN0b3JlIHByZXYgbWFzayBzdGF0ZQoJICAgICAgICAgIHRoaXMuY3VycmVudE1hc2suc3RhdGUgPSBwcmV2TWFza1N0YXRlOwoJICAgICAgICB9CgkgICAgICB9CgoJICAgICAgcmV0dXJuIGRldGFpbHM7CgkgICAgfQoJICB9LCB7CgkgICAga2V5OiAiX2FwcGVuZFBsYWNlaG9sZGVyIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gX2FwcGVuZFBsYWNlaG9sZGVyKCkgewoJICAgICAgdmFyIGRldGFpbHMgPSB0aGlzLl9hcHBseURpc3BhdGNoLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgoJICAgICAgaWYgKHRoaXMuY3VycmVudE1hc2spIHsKCSAgICAgICAgZGV0YWlscy5hZ2dyZWdhdGUodGhpcy5jdXJyZW50TWFzay5fYXBwZW5kUGxhY2Vob2xkZXIoKSk7CgkgICAgICB9CgoJICAgICAgcmV0dXJuIGRldGFpbHM7CgkgICAgfQoJICAgIC8qKgoJICAgICAgQG92ZXJyaWRlCgkgICAgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJkb0Rpc3BhdGNoIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gZG9EaXNwYXRjaChhcHBlbmRlZCkgewoJICAgICAgdmFyIGZsYWdzID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsKCSAgICAgIHJldHVybiB0aGlzLmRpc3BhdGNoKGFwcGVuZGVkLCB0aGlzLCBmbGFncyk7CgkgICAgfQoJICAgIC8qKgoJICAgICAgQG92ZXJyaWRlCgkgICAgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJkb1ZhbGlkYXRlIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gZG9WYWxpZGF0ZSgpIHsKCSAgICAgIHZhciBfZ2V0MiwgX3RoaXMkY3VycmVudE1hc2syOwoKCSAgICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4pLCBfa2V5ID0gMDsgX2tleSA8IF9sZW47IF9rZXkrKykgewoJICAgICAgICBhcmdzW19rZXldID0gYXJndW1lbnRzW19rZXldOwoJICAgICAgfQoKCSAgICAgIHJldHVybiAoX2dldDIgPSBfZ2V0KF9nZXRQcm90b3R5cGVPZihNYXNrZWREeW5hbWljLnByb3RvdHlwZSksICJkb1ZhbGlkYXRlIiwgdGhpcykpLmNhbGwuYXBwbHkoX2dldDIsIFt0aGlzXS5jb25jYXQoYXJncykpICYmICghdGhpcy5jdXJyZW50TWFzayB8fCAoX3RoaXMkY3VycmVudE1hc2syID0gdGhpcy5jdXJyZW50TWFzaykuZG9WYWxpZGF0ZS5hcHBseShfdGhpcyRjdXJyZW50TWFzazIsIGFyZ3MpKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICBAb3ZlcnJpZGUKCSAgICAqLwoKCSAgfSwgewoJICAgIGtleTogInJlc2V0IiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gcmVzZXQoKSB7CgkgICAgICBpZiAodGhpcy5jdXJyZW50TWFzaykgdGhpcy5jdXJyZW50TWFzay5yZXNldCgpOwoJICAgICAgdGhpcy5jb21waWxlZE1hc2tzLmZvckVhY2goZnVuY3Rpb24gKG0pIHsKCSAgICAgICAgcmV0dXJuIG0ucmVzZXQoKTsKCSAgICAgIH0pOwoJICAgIH0KCSAgICAvKioKCSAgICAgIEBvdmVycmlkZQoJICAgICovCgoJICB9LCB7CgkgICAga2V5OiAicmVtb3ZlIiwKCgkgICAgLyoqCgkgICAgICBAb3ZlcnJpZGUKCSAgICAqLwoJICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmUoKSB7CgkgICAgICB2YXIgZGV0YWlscyA9IG5ldyBDaGFuZ2VEZXRhaWxzKCk7CgoJICAgICAgaWYgKHRoaXMuY3VycmVudE1hc2spIHsKCSAgICAgICAgdmFyIF90aGlzJGN1cnJlbnRNYXNrMzsKCgkgICAgICAgIGRldGFpbHMuYWdncmVnYXRlKChfdGhpcyRjdXJyZW50TWFzazMgPSB0aGlzLmN1cnJlbnRNYXNrKS5yZW1vdmUuYXBwbHkoX3RoaXMkY3VycmVudE1hc2szLCBhcmd1bWVudHMpKSAvLyB1cGRhdGUgd2l0aCBkaXNwYXRjaAoJICAgICAgICAuYWdncmVnYXRlKHRoaXMuX2FwcGx5RGlzcGF0Y2goKSk7CgkgICAgICB9CgoJICAgICAgcmV0dXJuIGRldGFpbHM7CgkgICAgfQoJICAgIC8qKgoJICAgICAgQG92ZXJyaWRlCgkgICAgKi8KCgkgIH0sIHsKCSAgICBrZXk6ICJleHRyYWN0SW5wdXQiLAoKCSAgICAvKioKCSAgICAgIEBvdmVycmlkZQoJICAgICovCgkgICAgdmFsdWU6IGZ1bmN0aW9uIGV4dHJhY3RJbnB1dCgpIHsKCSAgICAgIHZhciBfdGhpcyRjdXJyZW50TWFzazQ7CgoJICAgICAgcmV0dXJuIHRoaXMuY3VycmVudE1hc2sgPyAoX3RoaXMkY3VycmVudE1hc2s0ID0gdGhpcy5jdXJyZW50TWFzaykuZXh0cmFjdElucHV0LmFwcGx5KF90aGlzJGN1cnJlbnRNYXNrNCwgYXJndW1lbnRzKSA6ICcnOwoJICAgIH0KCSAgICAvKioKCSAgICAgIEBvdmVycmlkZQoJICAgICovCgoJICB9LCB7CgkgICAga2V5OiAiZXh0cmFjdFRhaWwiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBleHRyYWN0VGFpbCgpIHsKCSAgICAgIHZhciBfdGhpcyRjdXJyZW50TWFzazUsIF9nZXQzOwoKCSAgICAgIGZvciAodmFyIF9sZW4yID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuMiksIF9rZXkyID0gMDsgX2tleTIgPCBfbGVuMjsgX2tleTIrKykgewoJICAgICAgICBhcmdzW19rZXkyXSA9IGFyZ3VtZW50c1tfa2V5Ml07CgkgICAgICB9CgoJICAgICAgcmV0dXJuIHRoaXMuY3VycmVudE1hc2sgPyAoX3RoaXMkY3VycmVudE1hc2s1ID0gdGhpcy5jdXJyZW50TWFzaykuZXh0cmFjdFRhaWwuYXBwbHkoX3RoaXMkY3VycmVudE1hc2s1LCBhcmdzKSA6IChfZ2V0MyA9IF9nZXQoX2dldFByb3RvdHlwZU9mKE1hc2tlZER5bmFtaWMucHJvdG90eXBlKSwgImV4dHJhY3RUYWlsIiwgdGhpcykpLmNhbGwuYXBwbHkoX2dldDMsIFt0aGlzXS5jb25jYXQoYXJncykpOwoJICAgIH0KCSAgICAvKioKCSAgICAgIEBvdmVycmlkZQoJICAgICovCgoJICB9LCB7CgkgICAga2V5OiAiZG9Db21taXQiLAoJICAgIHZhbHVlOiBmdW5jdGlvbiBkb0NvbW1pdCgpIHsKCSAgICAgIGlmICh0aGlzLmN1cnJlbnRNYXNrKSB0aGlzLmN1cnJlbnRNYXNrLmRvQ29tbWl0KCk7CgoJICAgICAgX2dldChfZ2V0UHJvdG90eXBlT2YoTWFza2VkRHluYW1pYy5wcm90b3R5cGUpLCAiZG9Db21taXQiLCB0aGlzKS5jYWxsKHRoaXMpOwoJICAgIH0KCSAgICAvKioKCSAgICAgIEBvdmVycmlkZQoJICAgICovCgoJICB9LCB7CgkgICAga2V5OiAibmVhcmVzdElucHV0UG9zIiwKCSAgICB2YWx1ZTogZnVuY3Rpb24gbmVhcmVzdElucHV0UG9zKCkgewoJICAgICAgdmFyIF90aGlzJGN1cnJlbnRNYXNrNiwgX2dldDQ7CgoJICAgICAgZm9yICh2YXIgX2xlbjMgPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4zKSwgX2tleTMgPSAwOyBfa2V5MyA8IF9sZW4zOyBfa2V5MysrKSB7CgkgICAgICAgIGFyZ3NbX2tleTNdID0gYXJndW1lbnRzW19rZXkzXTsKCSAgICAgIH0KCgkgICAgICByZXR1cm4gdGhpcy5jdXJyZW50TWFzayA/IChfdGhpcyRjdXJyZW50TWFzazYgPSB0aGlzLmN1cnJlbnRNYXNrKS5uZWFyZXN0SW5wdXRQb3MuYXBwbHkoX3RoaXMkY3VycmVudE1hc2s2LCBhcmdzKSA6IChfZ2V0NCA9IF9nZXQoX2dldFByb3RvdHlwZU9mKE1hc2tlZER5bmFtaWMucHJvdG90eXBlKSwgIm5lYXJlc3RJbnB1dFBvcyIsIHRoaXMpKS5jYWxsLmFwcGx5KF9nZXQ0LCBbdGhpc10uY29uY2F0KGFyZ3MpKTsKCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICJ2YWx1ZSIsCgkgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkgICAgICByZXR1cm4gdGhpcy5jdXJyZW50TWFzayA/IHRoaXMuY3VycmVudE1hc2sudmFsdWUgOiAnJzsKCSAgICB9LAoJICAgIHNldDogZnVuY3Rpb24gc2V0KHZhbHVlKSB7CgkgICAgICBfc2V0KF9nZXRQcm90b3R5cGVPZihNYXNrZWREeW5hbWljLnByb3RvdHlwZSksICJ2YWx1ZSIsIHZhbHVlLCB0aGlzLCB0cnVlKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICBAb3ZlcnJpZGUKCSAgICAqLwoKCSAgfSwgewoJICAgIGtleTogInVubWFza2VkVmFsdWUiLAoJICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewoJICAgICAgcmV0dXJuIHRoaXMuY3VycmVudE1hc2sgPyB0aGlzLmN1cnJlbnRNYXNrLnVubWFza2VkVmFsdWUgOiAnJzsKCSAgICB9LAoJICAgIHNldDogZnVuY3Rpb24gc2V0KHVubWFza2VkVmFsdWUpIHsKCSAgICAgIF9zZXQoX2dldFByb3RvdHlwZU9mKE1hc2tlZER5bmFtaWMucHJvdG90eXBlKSwgInVubWFza2VkVmFsdWUiLCB1bm1hc2tlZFZhbHVlLCB0aGlzLCB0cnVlKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICBAb3ZlcnJpZGUKCSAgICAqLwoKCSAgfSwgewoJICAgIGtleTogInR5cGVkVmFsdWUiLAoJICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewoJICAgICAgcmV0dXJuIHRoaXMuY3VycmVudE1hc2sgPyB0aGlzLmN1cnJlbnRNYXNrLnR5cGVkVmFsdWUgOiAnJzsKCSAgICB9IC8vIHByb2JhYmx5IHR5cGVkVmFsdWUgc2hvdWxkIG5vdCBiZSB1c2VkIHdpdGggZHluYW1pYwoJICAgICwKCSAgICBzZXQ6IGZ1bmN0aW9uIHNldCh2YWx1ZSkgewoJICAgICAgdmFyIHVubWFza2VkVmFsdWUgPSBTdHJpbmcodmFsdWUpOyAvLyBkb3VibGUgY2hlY2sgaXQKCgkgICAgICBpZiAodGhpcy5jdXJyZW50TWFzaykgewoJICAgICAgICB0aGlzLmN1cnJlbnRNYXNrLnR5cGVkVmFsdWUgPSB2YWx1ZTsKCSAgICAgICAgdW5tYXNrZWRWYWx1ZSA9IHRoaXMuY3VycmVudE1hc2sudW5tYXNrZWRWYWx1ZTsKCSAgICAgIH0KCgkgICAgICB0aGlzLnVubWFza2VkVmFsdWUgPSB1bm1hc2tlZFZhbHVlOwoJICAgIH0KCSAgICAvKioKCSAgICAgIEBvdmVycmlkZQoJICAgICovCgoJICB9LCB7CgkgICAga2V5OiAiaXNDb21wbGV0ZSIsCgkgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkgICAgICByZXR1cm4gISF0aGlzLmN1cnJlbnRNYXNrICYmIHRoaXMuY3VycmVudE1hc2suaXNDb21wbGV0ZTsKCSAgICB9CgkgIH0sIHsKCSAgICBrZXk6ICJzdGF0ZSIsCgkgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgX2dldChfZ2V0UHJvdG90eXBlT2YoTWFza2VkRHluYW1pYy5wcm90b3R5cGUpLCAic3RhdGUiLCB0aGlzKSwgewoJICAgICAgICBfcmF3SW5wdXRWYWx1ZTogdGhpcy5yYXdJbnB1dFZhbHVlLAoJICAgICAgICBjb21waWxlZE1hc2tzOiB0aGlzLmNvbXBpbGVkTWFza3MubWFwKGZ1bmN0aW9uIChtKSB7CgkgICAgICAgICAgcmV0dXJuIG0uc3RhdGU7CgkgICAgICAgIH0pLAoJICAgICAgICBjdXJyZW50TWFza1JlZjogdGhpcy5jdXJyZW50TWFzaywKCSAgICAgICAgY3VycmVudE1hc2s6IHRoaXMuY3VycmVudE1hc2sgJiYgdGhpcy5jdXJyZW50TWFzay5zdGF0ZQoJICAgICAgfSk7CgkgICAgfSwKCSAgICBzZXQ6IGZ1bmN0aW9uIHNldChzdGF0ZSkgewoJICAgICAgdmFyIGNvbXBpbGVkTWFza3MgPSBzdGF0ZS5jb21waWxlZE1hc2tzLAoJICAgICAgICAgIGN1cnJlbnRNYXNrUmVmID0gc3RhdGUuY3VycmVudE1hc2tSZWYsCgkgICAgICAgICAgY3VycmVudE1hc2sgPSBzdGF0ZS5jdXJyZW50TWFzaywKCSAgICAgICAgICBtYXNrZWRTdGF0ZSA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllcyhzdGF0ZSwgWyJjb21waWxlZE1hc2tzIiwgImN1cnJlbnRNYXNrUmVmIiwgImN1cnJlbnRNYXNrIl0pOwoKCSAgICAgIHRoaXMuY29tcGlsZWRNYXNrcy5mb3JFYWNoKGZ1bmN0aW9uIChtLCBtaSkgewoJICAgICAgICByZXR1cm4gbS5zdGF0ZSA9IGNvbXBpbGVkTWFza3NbbWldOwoJICAgICAgfSk7CgoJICAgICAgaWYgKGN1cnJlbnRNYXNrUmVmICE9IG51bGwpIHsKCSAgICAgICAgdGhpcy5jdXJyZW50TWFzayA9IGN1cnJlbnRNYXNrUmVmOwoJICAgICAgICB0aGlzLmN1cnJlbnRNYXNrLnN0YXRlID0gY3VycmVudE1hc2s7CgkgICAgICB9CgoJICAgICAgX3NldChfZ2V0UHJvdG90eXBlT2YoTWFza2VkRHluYW1pYy5wcm90b3R5cGUpLCAic3RhdGUiLCBtYXNrZWRTdGF0ZSwgdGhpcywgdHJ1ZSk7CgkgICAgfQoJICB9LCB7CgkgICAga2V5OiAib3ZlcndyaXRlIiwKCSAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCSAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRNYXNrID8gdGhpcy5jdXJyZW50TWFzay5vdmVyd3JpdGUgOiBfZ2V0KF9nZXRQcm90b3R5cGVPZihNYXNrZWREeW5hbWljLnByb3RvdHlwZSksICJvdmVyd3JpdGUiLCB0aGlzKTsKCSAgICB9LAoJICAgIHNldDogZnVuY3Rpb24gc2V0KG92ZXJ3cml0ZSkgewoJICAgICAgY29uc29sZS53YXJuKCcib3ZlcndyaXRlIiBvcHRpb24gaXMgbm90IGF2YWlsYWJsZSBpbiBkeW5hbWljIG1hc2ssIHVzZSB0aGlzIG9wdGlvbiBpbiBzaWJsaW5ncycpOwoJICAgIH0KCSAgfV0pOwoKCSAgcmV0dXJuIE1hc2tlZER5bmFtaWM7Cgl9KE1hc2tlZCk7CglNYXNrZWREeW5hbWljLkRFRkFVTFRTID0gewoJICBkaXNwYXRjaDogZnVuY3Rpb24gZGlzcGF0Y2goYXBwZW5kZWQsIG1hc2tlZCwgZmxhZ3MpIHsKCSAgICBpZiAoIW1hc2tlZC5jb21waWxlZE1hc2tzLmxlbmd0aCkgcmV0dXJuOwoJICAgIHZhciBpbnB1dFZhbHVlID0gbWFza2VkLnJhd0lucHV0VmFsdWU7IC8vIHNpbXVsYXRlIGlucHV0CgoJICAgIHZhciBpbnB1dHMgPSBtYXNrZWQuY29tcGlsZWRNYXNrcy5tYXAoZnVuY3Rpb24gKG0sIGluZGV4KSB7CgkgICAgICBtLnJlc2V0KCk7CgkgICAgICBtLmFwcGVuZChpbnB1dFZhbHVlLCB7CgkgICAgICAgIHJhdzogdHJ1ZQoJICAgICAgfSk7CgkgICAgICBtLmFwcGVuZChhcHBlbmRlZCwgZmxhZ3MpOwoJICAgICAgdmFyIHdlaWdodCA9IG0ucmF3SW5wdXRWYWx1ZS5sZW5ndGg7CgkgICAgICByZXR1cm4gewoJICAgICAgICB3ZWlnaHQ6IHdlaWdodCwKCSAgICAgICAgaW5kZXg6IGluZGV4CgkgICAgICB9OwoJICAgIH0pOyAvLyBwb3AgbWFza3Mgd2l0aCBsb25nZXIgdmFsdWVzIGZpcnN0CgoJICAgIGlucHV0cy5zb3J0KGZ1bmN0aW9uIChpMSwgaTIpIHsKCSAgICAgIHJldHVybiBpMi53ZWlnaHQgLSBpMS53ZWlnaHQ7CgkgICAgfSk7CgkgICAgcmV0dXJuIG1hc2tlZC5jb21waWxlZE1hc2tzW2lucHV0c1swXS5pbmRleF07CgkgIH0KCX07CglJTWFzay5NYXNrZWREeW5hbWljID0gTWFza2VkRHluYW1pYzsKCgkvKiogTWFzayBwaXBlIHNvdXJjZSBhbmQgZGVzdGluYXRpb24gdHlwZXMgKi8KCgl2YXIgUElQRV9UWVBFID0gewoJICBNQVNLRUQ6ICd2YWx1ZScsCgkgIFVOTUFTS0VEOiAndW5tYXNrZWRWYWx1ZScsCgkgIFRZUEVEOiAndHlwZWRWYWx1ZScKCX07CgkvKiogQ3JlYXRlcyBuZXcgcGlwZSBmdW5jdGlvbiBkZXBlbmRpbmcgb24gbWFzayB0eXBlLCBzb3VyY2UgYW5kIGRlc3RpbmF0aW9uIG9wdGlvbnMgKi8KCglmdW5jdGlvbiBjcmVhdGVQaXBlKG1hc2spIHsKCSAgdmFyIGZyb20gPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IFBJUEVfVFlQRS5NQVNLRUQ7CgkgIHZhciB0byA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogUElQRV9UWVBFLk1BU0tFRDsKCSAgdmFyIG1hc2tlZCA9IGNyZWF0ZU1hc2sobWFzayk7CgkgIHJldHVybiBmdW5jdGlvbiAodmFsdWUpIHsKCSAgICByZXR1cm4gbWFza2VkLnJ1bklzb2xhdGVkKGZ1bmN0aW9uIChtKSB7CgkgICAgICBtW2Zyb21dID0gdmFsdWU7CgkgICAgICByZXR1cm4gbVt0b107CgkgICAgfSk7CgkgIH07Cgl9CgkvKiogUGlwZXMgdmFsdWUgdGhyb3VnaCBtYXNrIGRlcGVuZGluZyBvbiBtYXNrIHR5cGUsIHNvdXJjZSBhbmQgZGVzdGluYXRpb24gb3B0aW9ucyAqLwoKCWZ1bmN0aW9uIHBpcGUodmFsdWUpIHsKCSAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIHBpcGVBcmdzID0gbmV3IEFycmF5KF9sZW4gPiAxID8gX2xlbiAtIDEgOiAwKSwgX2tleSA9IDE7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHsKCSAgICBwaXBlQXJnc1tfa2V5IC0gMV0gPSBhcmd1bWVudHNbX2tleV07CgkgIH0KCgkgIHJldHVybiBjcmVhdGVQaXBlLmFwcGx5KHZvaWQgMCwgcGlwZUFyZ3MpKHZhbHVlKTsKCX0KCUlNYXNrLlBJUEVfVFlQRSA9IFBJUEVfVFlQRTsKCUlNYXNrLmNyZWF0ZVBpcGUgPSBjcmVhdGVQaXBlOwoJSU1hc2sucGlwZSA9IHBpcGU7CgoJdHJ5IHsKCSAgZ2xvYmFsVGhpcy5JTWFzayA9IElNYXNrOwoJfSBjYXRjaCAoZSkge30KCglleHBvcnRzLkhUTUxDb250ZW50ZWRpdGFibGVNYXNrRWxlbWVudCA9IEhUTUxDb250ZW50ZWRpdGFibGVNYXNrRWxlbWVudDsKCWV4cG9ydHMuSFRNTE1hc2tFbGVtZW50ID0gSFRNTE1hc2tFbGVtZW50OwoJZXhwb3J0cy5JbnB1dE1hc2sgPSBJbnB1dE1hc2s7CglleHBvcnRzLk1hc2tFbGVtZW50ID0gTWFza0VsZW1lbnQ7CglleHBvcnRzLk1hc2tlZCA9IE1hc2tlZDsKCWV4cG9ydHMuTWFza2VkRGF0ZSA9IE1hc2tlZERhdGU7CglleHBvcnRzLk1hc2tlZER5bmFtaWMgPSBNYXNrZWREeW5hbWljOwoJZXhwb3J0cy5NYXNrZWRFbnVtID0gTWFza2VkRW51bTsKCWV4cG9ydHMuTWFza2VkRnVuY3Rpb24gPSBNYXNrZWRGdW5jdGlvbjsKCWV4cG9ydHMuTWFza2VkTnVtYmVyID0gTWFza2VkTnVtYmVyOwoJZXhwb3J0cy5NYXNrZWRQYXR0ZXJuID0gTWFza2VkUGF0dGVybjsKCWV4cG9ydHMuTWFza2VkUmFuZ2UgPSBNYXNrZWRSYW5nZTsKCWV4cG9ydHMuTWFza2VkUmVnRXhwID0gTWFza2VkUmVnRXhwOwoJZXhwb3J0cy5QSVBFX1RZUEUgPSBQSVBFX1RZUEU7CglleHBvcnRzLmNyZWF0ZU1hc2sgPSBjcmVhdGVNYXNrOwoJZXhwb3J0cy5jcmVhdGVQaXBlID0gY3JlYXRlUGlwZTsKCWV4cG9ydHMuZGVmYXVsdCA9IElNYXNrOwoJZXhwb3J0cy5waXBlID0gcGlwZTsKCglPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pOwoKfSkpKTsKLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW1hc2suanMubWFw"></script>
    <script>
        const inputs = document.querySelectorAll('[name="phone"]');
        inputs.forEach((element) => {
            const maskOptions = {
                mask: /^[+0-9]+$/
            };
            IMask(element, maskOptions);
        })
    </script>

  
</body></html>